<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ZADORA Lite</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{ background:#fafafa; color:#111827; }
    .container{ max-width:1120px; margin:0 auto; }
    .glass{ backdrop-filter: blur(6px); background: rgba(255,255,255,.85); }
    .modal-bg{ background: rgba(0,0,0,.45); }
  </style>
</head>
<body class="min-h-screen">
  <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
  <header class="sticky top-0 z-40 glass border-b">
    <div class="container px-4 py-3 flex items-center gap-3">
      <div class="font-extrabold text-xl text-rose-600" id="brandName">ZADORA</div>
      <div class="flex-1"></div>

      <!-- Ø¨Ø­Ø« -->
      <div class="hidden md:block w-[420px]">
        <input id="search" placeholder="Ø¥Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬..." class="w-full rounded-xl border px-3 py-2" />
      </div>

      <!-- Ø²Ø± Ø§Ù„Ø³Ù„Ø© -->
      <button id="openCart" class="relative rounded-xl border px-3 py-2 hover:bg-gray-50">
        ğŸ›’ Ø§Ù„Ø³Ù„Ø©
        <span id="cartCount" class="absolute -top-2 -left-2 min-w-[22px] h-[22px] text-xs rounded-full bg-rose-600 text-white px-1 flex items-center justify-center hidden">0</span>
      </button>

      <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
      <button id="openAdmin" class="rounded-xl border px-3 py-2 hover:bg-gray-50">âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
    </div>
    <div class="md:hidden px-4 pb-3">
      <input id="search2" placeholder="Ø¥Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬..." class="w-full rounded-xl border px-3 py-2" />
    </div>
  </header>

  <!-- Ù‡ÙŠØ±Ùˆ -->
  <section class="container px-4 mt-4" id="heroSection"></section>
  <!-- Ù…Ù…ÙŠØ²Ø§Øª -->
  <section class="container px-4 mt-6" id="benefitsSection"></section>
  <!-- Ø£Ù‚Ø³Ø§Ù… -->
  <section class="container px-4 mt-8" id="categoriesSection"></section>
  <!-- Ù…Ù†ØªØ¬Ø§Øª -->
  <section class="container px-4 mt-8" id="productsSection"></section>

  <!-- Ù†Ø´Ø±Ø© Ø¨Ø±ÙŠØ¯ÙŠØ© -->
  <section class="container px-4 mt-10">
    <div class="rounded-2xl bg-neutral-900 text-white overflow-hidden">
      <div class="grid md:grid-cols-2">
        <div class="p-8 md:p-12">
          <h3 class="text-2xl md:text-3xl font-extrabold">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ¬Ø§Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ÙŠØ©</h3>
          <p class="mt-2 text-white/80">Ø®ØµÙˆÙ…Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø¬Ù…Ù„Ø© + Ø¹Ø±ÙˆØ¶ ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø¬Ø§Ù‡Ø²Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ‹Ø§.</p>
          <div class="mt-5 flex items-center gap-2">
            <input class="flex-1 rounded-xl px-3 py-2 text-neutral-900" placeholder="Ø§ÙƒØªØ¨ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" dir="rtl"/>
            <button class="rounded-xl bg-rose-600 px-4 py-2 font-semibold hover:bg-rose-700">Ø§Ø´ØªØ±Ùƒ</button>
          </div>
        </div>
        <div class="relative min-h-[220px]">
          <img src="https://images.unsplash.com/photo-1523275335684-37898b6baf30?q=80&w=1600&auto=format&fit=crop" alt="newsletter" class="absolute inset-0 w-full h-full object-cover opacity-70"/>
        </div>
      </div>
    </div>
  </section>

  <!-- ÙÙˆØªØ± -->
  <footer class="mt-10 border-t">
    <div class="container px-4 py-8 grid md:grid-cols-4 gap-8 text-right">
      <div>
        <div class="font-bold text-lg"><span class="text-rose-600">âœ¦</span> <span id="brandNameFooter">ZADORA</span></div>
        <p class="mt-3 text-sm text-gray-600">Ù…Ù†ØµØ© Ø¬Ù…Ù„Ø© Ù„Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©: Ø­Ø¯ Ø£Ø¯Ù†Ù‰ 12 Ù‚Ø·Ø¹Ø©ØŒ Ø´Ø­Ù† Ø³Ø±ÙŠØ¹ØŒ ÙˆØ¶Ù…Ø§Ù† Ø§Ø³ØªØ¨Ø¯Ø§Ù„.</p>
      </div>
      <div>
        <h4 class="font-semibold mb-2">Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h4>
        <ul class="space-y-1 text-sm text-gray-600">
          <li><a class="hover:underline">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹</a></li>
          <li><a class="hover:underline">Ø§Ù„Ø´Ø­Ù† ÙˆØ§Ù„ØªØ³Ù„ÙŠÙ…</a></li>
          <li><a class="hover:underline">Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹</a></li>
        </ul>
      </div>
      <div>
        <h4 class="font-semibold mb-2">Ø§Ù„Ø´Ø±ÙƒØ©</h4>
        <ul class="space-y-1 text-sm text-gray-600">
          <li><a class="hover:underline">Ù…Ù† Ù†Ø­Ù†</a></li>
          <li><a class="hover:underline">Ø§Ù†Ø¶Ù… ÙƒØªØ§Ø¬Ø±/Ù…ÙˆØ±Ø¯</a></li>
          <li><a class="hover:underline">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a></li>
        </ul>
      </div>
      <div>
        <h4 class="font-semibold mb-2">ØªØ§Ø¨Ø¹Ù†Ø§</h4>
        <ul class="space-y-1 text-sm text-gray-600">
          <li><a class="hover:underline">Facebook</a></li>
          <li><a class="hover:underline">Instagram</a></li>
          <li><a class="hover:underline">TikTok</a></li>
        </ul>
      </div>
    </div>
    <div class="py-4 text-center text-xs text-gray-500">Â© <span id="year"></span> <span id="brandNameCopy">ZADORA</span>. All rights reserved.</div>
  </footer>

  <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
  <div id="adminModal" class="fixed inset-0 hidden z-50 modal-bg">
    <div class="absolute inset-0" id="adminCloseBg"></div>
    <div class="absolute right-0 top-0 bottom-0 w-full md:w-[760px] bg-white rounded-none md:rounded-l-3xl shadow-2xl overflow-y-auto">
      <div class="sticky top-0 glass border-b p-4 flex items-center justify-between">
        <div class="font-bold">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
        <div class="flex items-center gap-2">
          <label class="rounded-xl border px-3 py-2 text-sm cursor-pointer hover:bg-gray-50">
            <input type="file" id="importJson" accept="application/json" class="hidden" /> Ø§Ø³ØªÙŠØ±Ø§Ø¯
          </label>
          <button id="exportJson" class="rounded-xl border px-3 py-2 text-sm hover:bg-gray-50">ØªØµØ¯ÙŠØ±</button>
          <button id="resetAll" class="rounded-xl border px-3 py-2 text-sm hover:bg-gray-50">Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</button>
          <button id="closeAdmin" class="rounded-xl bg-rose-600 text-white px-4 py-2 text-sm">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
      </div>

      <div class="p-4">
        <div class="flex gap-2 mb-4">
          <button data-tab="products" class="tab-btn rounded-xl px-4 py-2 text-sm border">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
          <button data-tab="categories" class="tab-btn rounded-xl px-4 py-2 text-sm border">Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</button>
          <button data-tab="settings" class="tab-btn rounded-xl px-4 py-2 text-sm border">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        </div>

        <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
        <div id="tab-settings" class="tab-pane hidden" dir="rtl">
          <div class="grid md:grid-cols-2 gap-4">
            <div class="space-y-2">
              <label class="text-sm font-medium">Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯</label>
              <input id="brandInput" class="w-full rounded-xl border px-3 py-2" placeholder="ZADORA"/>
              <label class="text-sm font-medium">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù‡ÙŠØ±Ùˆ</label>
              <input id="heroTitleInput" class="w-full rounded-xl border px-3 py-2"/>
              <label class="text-sm font-medium">ÙˆØµÙ Ø§Ù„Ù‡ÙŠØ±Ùˆ</label>
              <textarea id="heroSubInput" class="w-full rounded-xl border px-3 py-2 min-h-[112px]"></textarea>
            </div>
            <div class="space-y-2">
              <div class="text-sm font-medium">ØµÙˆØ±Ø© Ø§Ù„Ù‡ÙŠØ±Ùˆ</div>
              <div class="aspect-[4/3] w-full overflow-hidden rounded-xl border bg-white" id="heroImgWrap">
                <img id="heroImgPreview" class="w-full h-full object-cover" />
              </div>
              <label class="inline-flex items-center gap-2 rounded-xl border px-3 py-2 cursor-pointer hover:bg-gray-50">
                <input id="heroImgInput" type="file" accept="image/*" class="hidden" /> Ø±ÙØ¹ ØµÙˆØ±Ø©
              </label>
            </div>
          </div>
        </div>

        <!-- Ø£Ù‚Ø³Ø§Ù… -->
        <div id="tab-categories" class="tab-pane hidden" dir="rtl">
          <div class="grid md:grid-cols-3 gap-4">
            <div class="space-y-3">
              <input id="catName" class="w-full rounded-xl border px-3 py-2" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…"/>
              <div class="space-y-2">
                <div class="text-sm font-medium">ØµÙˆØ±Ø© Ø§Ù„Ù‚Ø³Ù…</div>
                <div class="aspect-[4/3] w-full overflow-hidden rounded-xl border bg-white">
                  <img id="catImgPreview" class="w-full h-full object-cover" />
                </div>
                <label class="inline-flex items-center gap-2 rounded-xl border px-3 py-2 cursor-pointer hover:bg-gray-50">
                  <input id="catImgInput" type="file" accept="image/*" class="hidden" /> Ø±ÙØ¹ ØµÙˆØ±Ø©
                </label>
              </div>
              <div class="flex gap-2">
                <button id="saveCat" class="flex-1 rounded-xl bg-rose-600 text-white py-2 font-semibold">Ø­ÙØ¸</button>
                <button id="resetCat" class="rounded-xl border px-3">Ø¥Ù„ØºØ§Ø¡</button>
              </div>
            </div>
            <div class="md:col-span-2 grid sm:grid-cols-2 gap-3" id="catsList"></div>
          </div>
        </div>

        <!-- Ù…Ù†ØªØ¬Ø§Øª -->
        <div id="tab-products" class="tab-pane hidden" dir="rtl">
          <div class="grid md:grid-cols-3 gap-4">
            <div class="space-y-3">
              <input id="pTitle" class="w-full rounded-xl border px-3 py-2" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬"/>
              <div class="grid grid-cols-2 gap-2">
                <input id="pPrice" class="rounded-xl border px-3 py-2" placeholder="Ø§Ù„Ø³Ø¹Ø±" type="number"/>
                <input id="pOld" class="rounded-xl border px-3 py-2" placeholder="Ø§Ù„Ø³Ø¹Ø± Ù‚Ø¨Ù„" type="number"/>
              </div>
              <div class="grid grid-cols-3 gap-2">
                <input id="pRating" class="rounded-xl border px-3 py-2" placeholder="ØªÙ‚ÙŠÙŠÙ…" type="number" step="0.1"/>
                <input id="pReviews" class="rounded-xl border px-3 py-2" placeholder="Ù…Ø±Ø§Ø¬Ø¹Ø§Øª" type="number"/>
                <input id="pMinQty" class="rounded-xl border px-3 py-2" placeholder="Ø­Ø¯ Ø£Ø¯Ù†Ù‰" type="number"/>
              </div>
              <input id="pBadge" class="w-full rounded-xl border px-3 py-2" placeholder="Ø´Ø§Ø±Ø© (Ø¬Ø¯ÙŠØ¯/Ø¹Ø±Ø¶ Ø®Ø§Øµ)"/>
              <select id="pCategory" class="w-full rounded-xl border px-3 py-2"></select>
              <div class="space-y-2">
                <div class="text-sm font-medium">ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬</div>
                <div class="aspect-[4/3] w-full overflow-hidden rounded-xl border bg-white">
                  <img id="pImgPreview" class="w-full h-full object-cover" />
                </div>
                <label class="inline-flex items-center gap-2 rounded-xl border px-3 py-2 cursor-pointer hover:bg-gray-50">
                  <input id="pImgInput" type="file" accept="image/*" class="hidden" /> Ø±ÙØ¹ ØµÙˆØ±Ø©
                </label>
              </div>
              <div class="flex gap-2">
                <button id="saveProduct" class="flex-1 rounded-xl bg-rose-600 text-white py-2 font-semibold">Ø¥Ø¶Ø§ÙØ©/ØªØ­Ø¯ÙŠØ«</button>
                <button id="resetProduct" class="rounded-xl border px-3">Ø¥Ù„ØºØ§Ø¡</button>
              </div>
            </div>
            <div class="md:col-span-2 grid sm:grid-cols-2 gap-3" id="productsList"></div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- ÙˆÙŠØ¯Ø¬Øª Ø§Ù„Ø´Ø§Øª -->
  <div id="chatRoot" class="fixed bottom-4 right-4 z-50">
    <button id="chatToggle" class="rounded-full shadow-lg bg-rose-600 text-white w-14 h-14 flex items-center justify-center text-2xl">ğŸ’¬</button>
    <div id="chatPanel" class="hidden mt-3 w-[320px] sm:w-[360px] rounded-2xl shadow-2xl border bg-white overflow-hidden">
      <div class="flex items-center justify-between px-4 py-3 bg-neutral-900 text-white">
        <div class="font-semibold">Ø¯Ø¹Ù… <span id="brandInChat">ZADORA</span></div>
        <button id="chatClose" title="Ø¥ØºÙ„Ø§Ù‚">âœ•</button>
      </div>
      <div id="chatBody" class="h-[320px] overflow-y-auto px-3 py-3 space-y-2 bg-neutral-50"></div>
      <div class="px-3 pb-3">
        <div class="flex flex-wrap gap-2 text-xs mb-2">
          <button class="px-2 py-1 rounded-full border bg-white quick">Ø§Ù„Ø´Ø­Ù†</button>
          <button class="px-2 py-1 rounded-full border bg-white quick">Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹</button>
          <button class="px-2 py-1 rounded-full border bg-white quick">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰</button>
          <button class="px-2 py-1 rounded-full border bg-white quick">Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹</button>
        </div>
        <div class="flex items-center gap-2">
          <input id="chatInput" class="flex-1 rounded-xl border px-3 py-2" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ..." />
          <button id="chatSend" class="rounded-xl bg-rose-600 text-white px-4 py-2">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
        <a id="waBtn" class="block text-center text-sm mt-2 rounded-xl border py-2 hover:bg-gray-50" target="_blank" rel="noopener">ØªÙˆØ§ØµÙ„ ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø¢Ù†</a>
      </div>
    </div>
  </div>

  <!-- Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª -->
  <div id="cartModal" class="fixed inset-0 hidden z-50 modal-bg">
    <div id="cartCloseBg" class="absolute inset-0"></div>
    <div class="absolute right-0 top-0 bottom-0 w-full md:w-[760px] bg-white rounded-none md:rounded-l-3xl shadow-2xl overflow-y-auto">
      <div class="sticky top-0 glass border-b p-4 flex items-center justify-between">
        <div class="font-bold">Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</div>
        <div class="flex items-center gap-2">
          <button id="cartClear" class="rounded-xl border px-3 py-2 text-sm hover:bg-gray-50">ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©</button>
          <button id="closeCart" class="rounded-xl bg-rose-600 text-white px-4 py-2 text-sm">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
      </div>

      <div class="p-4 grid md:grid-cols-2 gap-4">
        <div>
          <div id="cartItems" class="space-y-3"></div>
        </div>

        <div class="space-y-3">
          <div class="rounded-2xl border bg-white p-4">
            <div class="font-semibold mb-2">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
            <div class="space-y-2">
              <input id="cusName"  class="w-full rounded-xl border px-3 py-2" placeholder="Ø§Ù„Ø§Ø³Ù…"/>
              <input id="cusPhone" class="w-full rounded-xl border px-3 py-2" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ"/>
              <input id="cusCity"  class="w-full rounded-xl border px-3 py-2" placeholder="Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©/Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©"/>
              <select id="cusTier" class="w-full rounded-xl border px-3 py-2">
                <option value="wh">Ø¬Ù…Ù„Ø© Ø§Ù„Ø¬Ù…Ù„Ø©</option>
                <option value="half">Ù†Øµ Ø¬Ù…Ù„Ø©</option>
                <option value="retail">Ù‚Ø·Ø§Ø¹ÙŠ</option>
              </select>
              <div id="tierMsg" class="text-sm text-rose-600"></div>
            </div>
          </div>

          <div class="rounded-2xl border bg-white p-4">
            <div class="flex items-center justify-between">
              <div>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±Ø¹ÙŠ</div>
              <div id="cartSubtotal" class="font-bold">0 Ø¬.Ù…</div>
            </div>
            <div class="flex items-center justify-between text-sm text-gray-600 mt-1">
              <div>Ø§Ù„Ø´Ø­Ù†</div>
              <div id="cartShipping">ÙŠÙØ­Ø³Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</div>
            </div>
            <div id="retailDiscountRow" class="hidden flex items-center justify-between text-sm mt-1">
              <div>Ø®ØµÙ… Ù‚Ø·Ø§Ø¹ÙŠ 10%</div>
              <div id="retailDiscountVal">-0 Ø¬.Ù…</div>
            </div>
            <hr class="my-2">
            <div class="flex items-center justify-between text-lg">
              <div class="font-bold">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
              <div id="cartTotal" class="font-extrabold text-rose-600">0 Ø¬.Ù…</div>
            </div>
            <p class="text-xs text-gray-500 mt-2">* Ø§Ù„ÙƒÙ…ÙŠØ§Øª ØªØªØ­Ø±Ùƒ Ø¨Ù…Ø¶Ø§Ø¹ÙØ§Øª Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„ÙƒÙ„ ØµÙ†Ù.</p>
            <div class="mt-3 grid grid-cols-1 gap-2">
              <button id="cartCheckoutWA" class="rounded-xl bg-rose-600 text-white px-4 py-2 font-semibold hover:bg-rose-700">Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨</button>
              <button id="cartCheckoutEmail" class="rounded-xl border px-4 py-2 hover:bg-gray-50">Ø·Ù„Ø¨ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

<script>
/* =====================[ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© + Ø¯Ø¹Ù… ]===================== */
const WHATSAPP_PHONE = '201112444190';           // â† Ø±Ù‚Ù…Ùƒ Ø¨ØµÙŠØºØ© Ø¯ÙˆÙ„ÙŠØ©
const SUPPORT_EMAIL  = 'sales@example.com';
document.getElementById('waBtn').href = 'https://wa.me/' + WHATSAPP_PHONE;

/* =====================[ Admin PIN + Routing ]===================== */
const ADMIN_PIN = '1234';
let isAdmin = sessionStorage.getItem('zl_admin') === '1';

/* Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù‡ÙˆÙ… */
function showHomeSections(show) {
  document.getElementById('heroSection').classList.toggle('hidden', !show);
  document.getElementById('benefitsSection').classList.toggle('hidden', !show);
  document.getElementById('categoriesSection').classList.toggle('hidden', !show);
}
function ensureAdmin() {
  const pin = prompt('Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… PIN Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:');
  if (pin === ADMIN_PIN) {
    isAdmin = true;
    sessionStorage.setItem('zl_admin', '1');
    const btn = document.getElementById('openAdmin');
    if (btn) btn.classList.remove('hidden');
    openAdminPanel();
  } else { alert('PIN ØºÙŠØ± ØµØ­ÙŠØ­'); location.hash = '#/'; }
}

/* =====================[ Ø¨ÙŠØ§Ù†Ø§Øª + LocalStorage ]===================== */
const LS_KEYS = { brand:'zl_brand', hero:'zl_hero', cats:'zl_cats', prods:'zl_prods', cart:'zl_cart', customer:'zl_customer' };
const DEFAULT_BRAND = 'ZADORA';
const DEFAULT_HERO = {
  title: 'Ø¬ÙÙ…Ù„Ø© Ø±Ø§Ù‚ÙŠØ© Ø¨Ù„Ù…Ø³Ø© ZADORA',
  subtitle: 'Ø§Ø·Ù„Ø¨ Ø¨Ø§Ù„ÙƒØ±ØªÙˆÙ†Ø© Ø£Ùˆ Ø­Ø¯ Ø£Ø¯Ù†Ù‰ 12 Ù‚Ø·Ø¹Ø© â€” Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ø¶Ø­Ø©ØŒ Ø®Ø§Ù…Ø§Øª Ù…Ø¶Ù…ÙˆÙ†Ø©ØŒ ÙˆØµÙˆØ± Ø¬Ø§Ù‡Ø²Ø© Ù„Ø²ÙŠØ§Ø¯Ø© Ù…Ø¨ÙŠØ¹Ø§ØªÙƒ ÙÙˆØ±Ù‹Ø§.',
  image: 'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?q=80&w=1600&auto=format&fit=crop'
};
const DEFAULT_CATS = [
  { name:'Ù…Ø·Ø¨Ø®', image:'https://images.unsplash.com/photo-1542909168-82c3e7fdca5c?q=80&w=1200&auto=format&fit=crop' },
  { name:'ØªØ®Ø²ÙŠÙ† ÙˆØªÙ†Ø¸ÙŠÙ…', image:'https://images.unsplash.com/photo-1582582429416-2f3a27730854?q=80&w=1200&auto=format&fit=crop' },
  { name:'Ù…Ø´Ø±ÙˆØ¨Ø§Øª ÙˆÙ…Ø¬Ø§Øª', image:'https://images.unsplash.com/photo-1511920170033-f8396924c348?q=80&w=1200&auto=format&fit=crop' },
  { name:'Ø¯ÙŠÙƒÙˆØ±', image:'https://images.unsplash.com/photo-1501045661006-fcebe0257c3f?q=80&w=1200&auto=format&fit=crop' },
  { name:'Ù…Ù†Ø³ÙˆØ¬Ø§Øª', image:'https://images.unsplash.com/photo-1497032628192-86f99bcd76bc?q=80&w=1200&auto=format&fit=crop' },
  { name:'Ø¨Ù„Ø§Ø³ØªÙŠÙƒ ÙˆØ§Ø³ØªØ§Ù„Ø³', image:'https://images.unsplash.com/photo-1542444592-1e6c9f952a25?q=80&w=1200&auto=format&fit=crop' },
];
/* Ø®Ù„ÙŠÙ‘Ù†Ø§ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ù…Ù†ØªØ¬Ø§Øª 12 ÙÙŠ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¬Ø§Ù‡Ø²Ø© */
const DEFAULT_PRODS = [
  { id:1, title:'Ø·Ù‚Ù… ØªÙ„Ø§Ø¬Ø© Ø¨ÙŠØ±ÙƒØ³ â€“ 3 Ù‚Ø·Ø¹', price:420, oldPrice:480, rating:4.7, reviews:126, image:'https://images.unsplash.com/photo-1601050690290-27f9864c06c0?q=80&w=1200&auto=format&fit=crop', badge:'Ø§Ù„Ø£ÙƒØ«Ø± Ø·Ù„Ø¨Ù‹Ø§', minQty:12, category:'Ù…Ø·Ø¨Ø®' },
  { id:2, title:'Ù„Ø§Ù†Ø´ Ø¨ÙˆÙƒØ³ Ø­Ø±Ø§Ø±ÙŠ', price:165, oldPrice:199, rating:4.6, reviews:98, image:'https://images.unsplash.com/photo-1517673132405-a56a62b18caf?q=80&w=1200&auto=format&fit=crop', badge:'Ø¹Ø±Ø¶ Ø®Ø§Øµ', minQty:12, category:'ØªØ®Ø²ÙŠÙ† ÙˆØªÙ†Ø¸ÙŠÙ…' },
  { id:3, title:'Ù…Ø¬ Ø³ÙŠØ±Ø§Ù…ÙŠÙƒ Ù…Ø·ÙÙŠ', price:85, oldPrice:110, rating:4.4, reviews:210, image:'https://images.unsplash.com/photo-1523365280197-f1783db9fe62?q=80&w=1200&auto=format&fit=crop', badge:'Ø¬Ø¯ÙŠØ¯', minQty:12, category:'Ù…Ø´Ø±ÙˆØ¨Ø§Øª ÙˆÙ…Ø¬Ø§Øª' },
  { id:4, title:'Ø¹Ù„Ø¨ ØªØ®Ø²ÙŠÙ† Ù…Ø­ÙƒÙ…Ø© â€“ 6 Ù‚Ø·Ø¹', price:350, oldPrice:399, rating:4.8, reviews:73, image:'https://images.unsplash.com/photo-1592840496694-26d035b08cc6?q=80&w=1200&auto=format&fit=crop', badge:'Ø§Ù„Ø£ÙØ¶Ù„ Ù‚ÙŠÙ…Ø©', minQty:12, category:'ØªØ®Ø²ÙŠÙ† ÙˆØªÙ†Ø¸ÙŠÙ…' },
];
/* Ø­Ø¯ Ø£Ø¯Ù†Ù‰ Ø¹Ø§Ù… Ù„Ù„Ù…Ø­Ù„ */
const STORE_MIN_QTY = 12;

function lsGet(k, fb){ try{ const v = localStorage.getItem(k); return v? JSON.parse(v): fb; }catch{ return fb; } }
function lsSet(k, v){ try{ localStorage.setItem(k, JSON.stringify(v)); }catch{} }

let brand = lsGet(LS_KEYS.brand, DEFAULT_BRAND);
let hero = lsGet(LS_KEYS.hero, DEFAULT_HERO);
let categories = lsGet(LS_KEYS.cats, DEFAULT_CATS);
let products = lsGet(LS_KEYS.prods, DEFAULT_PRODS);
let cart = lsGet(LS_KEYS.cart, []);               // [{id, qty}]
let customer = lsGet(LS_KEYS.customer, {name:'', phone:'', city:'', tier:'wh'});

/* =====================[ Ø¨Ø­Ø« + ØªØ±ØªÙŠØ¨ ]===================== */
let currentSort = 'default';
let currentQuery = '';
function normalize(s){ return String(s||'').toLowerCase(); }
function sortList(list, key) {
  const arr = [...list];
  if (key === 'priceLow')  arr.sort((a,b)=> (a.price||0) - (b.price||0));
  if (key === 'priceHigh') arr.sort((a,b)=> (b.price||0) - (a.price||0));
  if (key === 'ratingHigh') arr.sort((a,b)=> (b.rating||0) - (a.rating||0));
  return arr;
}
function applyFilters(list){
  let out = list;
  const q = normalize(currentQuery.trim());
  if(q){ out = out.filter(p => normalize(p.title).includes(q) || normalize(p.category).includes(q)); }
  return sortList(out, currentSort);
}

/* =====================[ Cart Logic ]===================== */
const fmt = n => `${Number(n||0).toLocaleString('ar-EG')} Ø¬.Ù…`;
const effMin = p => Number(p.minQty) || STORE_MIN_QTY;

function getProd(id){ return products.find(p=> String(p.id)===String(id)); }
function saveCart(){ lsSet(LS_KEYS.cart, cart); renderCartIcon(); }
function cartCount(){ return cart.reduce((s,i)=> s + (Number(i.qty)||0), 0); }
function cartSubtotal(){ return cart.reduce((s,i)=> { const p=getProd(i.id); return s + (p?(p.price||0)*(i.qty||0):0); }, 0); }

function renderCartIcon(){
  const c = cartCount();
  const b = document.getElementById('cartCount');
  b.textContent = c;
  b.classList.toggle('hidden', c===0);
}
function addToCart(id){
  const p = getProd(id); if(!p) return;
  const step = effMin(p);
  const item = cart.find(x=> String(x.id)===String(id));
  if(item){ item.qty += step; } else { cart.push({id, qty: step}); }
  saveCart(); openCart();
}
function changeQty(id, dir){
  const p = getProd(id); if(!p) return;
  const step = effMin(p);
  const it = cart.find(x=> String(x.id)===String(id)); if(!it) return;
  it.qty = Math.max(step, (it.qty||0) + dir*step);
  saveCart(); renderCartPanel();
}
function removeItem(id){ cart = cart.filter(x=> String(x.id)!==String(id)); saveCart(); renderCartPanel(); }
function clearCart(){ cart = []; saveCart(); renderCartPanel(); }

function renderCartPanel(){
  const wrap = document.getElementById('cartItems');
  if(!wrap) return;

  if(cart.length===0){
    wrap.innerHTML = `<div class="rounded-2xl border bg-white p-6">Ø³Ù„ØªÙƒ ÙØ§Ø±ØºØ©.</div>`;
  }else{
    wrap.innerHTML = cart.map(it=>{
      const p = getProd(it.id); if(!p) return '';
      const line = (p.price||0)*(it.qty||0);
      const step = effMin(p);
      return `
      <div class="rounded-2xl border bg-white p-3">
        <div class="flex gap-3">
          <img src="${p.image}" class="w-20 h-20 object-cover rounded-xl border" />
          <div class="flex-1">
            <div class="font-semibold">${p.title}</div>
            <div class="text-sm text-gray-500">Ø§Ù„Ù‚Ø³Ù…: ${p.category||'-'} â€¢ Ø­Ø¯ Ø£Ø¯Ù†Ù‰: ${step}</div>
            <div class="mt-2 flex items-center gap-2">
              <button class="px-3 py-1 rounded-xl border qty-dec" data-id="${p.id}">âˆ’</button>
              <div class="min-w-[56px] text-center font-semibold">${it.qty}</div>
              <button class="px-3 py-1 rounded-xl border qty-inc" data-id="${p.id}">+</button>
              <button class="ml-auto px-3 py-1 rounded-xl border text-sm hover:bg-gray-50 item-remove" data-id="${p.id}">Ø­Ø°Ù</button>
            </div>
          </div>
        </div>
        <div class="mt-2 text-right"><span class="font-bold">${fmt(line)}</span></div>
      </div>`;
    }).join('');
  }

  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
  document.getElementById('cusName').value  = customer.name||'';
  document.getElementById('cusPhone').value = customer.phone||'';
  document.getElementById('cusCity').value  = customer.city||'';
  document.getElementById('cusTier').value  = customer.tier||'wh';

  // Ù…Ù„Ø®Øµ Ù…Ø§Ù„ÙŠ Ù…Ø¹ Ù…Ø²Ø§ÙŠØ§ Ø§Ù„Ø´Ø±Ø§Ø¦Ø­
  const subtotal = cartSubtotal();
  document.getElementById('cartSubtotal').textContent = fmt(subtotal);

  const tier = customer.tier || 'wh';
  let discount = 0, msg = '';
  if (tier === 'retail'){
    discount = Math.round(subtotal * 0.10);
    document.getElementById('retailDiscountRow').classList.remove('hidden');
    document.getElementById('retailDiscountVal').textContent = `-${fmt(discount)}`;
    msg = 'Ù…Ø¨Ø±ÙˆÙƒ! Ø¬Ø§Ù„Ùƒ Ø®ØµÙ… 10%';
  } else {
    document.getElementById('retailDiscountRow').classList.add('hidden');
    if (tier==='wh')  msg = 'Ù…Ø¨Ø±ÙˆÙƒ! ÙƒØ³Ø¨Øª 2% ÙƒØ§Ø´ Ø¨Ø§Ùƒ.';
    if (tier==='half') msg = 'Ù…Ø¨Ø±ÙˆÙƒ! ÙƒØ³Ø¨Øª Ø¨ÙˆÙƒØ³ Ù…Ù† ZADORA.';
  }
  document.getElementById('tierMsg').textContent = msg;

  const total = subtotal - discount;
  document.getElementById('cartTotal').textContent = fmt(total);

  // ØªÙØ¹ÙŠÙ„/ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø±
  document.getElementById('cartCheckoutWA').disabled = cart.length===0;
  document.getElementById('cartCheckoutEmail').disabled = cart.length===0;
  document.getElementById('cartClear').disabled = cart.length===0;
}

function openCart(){ document.getElementById('cartModal').classList.remove('hidden'); renderCartPanel(); }
function closeCart(){ document.getElementById('cartModal').classList.add('hidden'); }

/* =====================[ Render Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ]===================== */
function renderHero(){
  const el = document.getElementById('heroSection');
  el.innerHTML = `
    <div class="grid md:grid-cols-3 gap-4">
      <div class="md:col-span-2 relative overflow-hidden rounded-2xl bg-neutral-900 text-white min-h-[220px]">
        <img src="${hero.image}" class="absolute inset-0 w-full h-full object-cover opacity-70">
        <div class="relative p-8 md:p-12">
          <h2 class="text-2xl md:text-4xl font-extrabold leading-tight">${hero.title}</h2>
          <p class="mt-2 md:mt-4 text-sm md:text-base text-white/90">${hero.subtitle}</p>
          <button class="mt-5 inline-flex items-center gap-1 rounded-xl bg-white text-neutral-900 px-4 py-2 text-sm font-semibold hover:bg-white/90">ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†</button>
        </div>
      </div>
      <div class="relative overflow-hidden rounded-2xl bg-rose-600 text-white min-h-[220px]">
        <img src="https://images.unsplash.com/photo-1549778399-f94fd24d4697?q=80&w=1600&auto=format&fit=crop" class="absolute inset-0 w-full h-full object-cover opacity-40">
        <div class="relative p-8">
          <h3 class="text-xl md:text-2xl font-extrabold">ZADORA Box</h3>
          <p class="mt-2 text-sm text-white/90">Ø¨Ø§ÙƒØ¯Ú† Ù…ØªÙ†ÙˆØ¹Ø© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ø§Ù„Ù…Ø­Ù„</p>
          <button class="mt-4 inline-flex items-center gap-1 rounded-xl bg-white text-neutral-900 px-4 py-2 text-sm font-semibold hover:bg-white/90">Ø´ÙˆÙ Ø§Ù„Ø¨ÙˆÙƒØ³</button>
        </div>
      </div>
    </div>`;
}
function renderBenefits(){
  const data = [
    { title:'Ø´Ø­Ù† Ø³Ø±ÙŠØ¹', desc:'ØªÙˆØµÙŠÙ„ Ù„ÙƒÙ„ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª Ø®Ù„Ø§Ù„ 24-72 Ø³Ø§Ø¹Ø©' },
    { title:'Ø¶Ù…Ø§Ù† ÙˆØ§Ø³ØªØ¨Ø¯Ø§Ù„', desc:'Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù‚Ø·Ø¹ Ø§Ù„Ù…ÙƒØ³ÙˆØ±Ø© Ø®Ù„Ø§Ù„ 7 Ø£ÙŠØ§Ù…' },
    { title:'Ø¬Ù…Ù„Ø© Ø¨Ø§Ù„ÙƒØ±ØªÙˆÙ†Ø©', desc:'Ø­Ø¯ Ø£Ø¯Ù†Ù‰ 12 Ù‚Ø·Ø¹Ø© ÙÙ‚Ø·' },
  ];
  const el = document.getElementById('benefitsSection');
  el.innerHTML = `<div class="grid sm:grid-cols-3 gap-3">
      ${data.map(b=>`<div class="flex items-center gap-4 rounded-2xl border p-4 bg-white">
        <div class="rounded-2xl p-3 bg-rose-50">âœ¦</div>
        <div class="text-right">
          <div class="font-semibold">${b.title}</div>
          <div class="text-sm text-gray-600">${b.desc}</div>
        </div>
      </div>`).join('')}
    </div>`;
}
function renderCategories(){
  const el = document.getElementById('categoriesSection');
  el.innerHTML = `
    <div class="flex items-center justify-between mb-3">
      <h3 class="text-lg md:text-xl font-bold">ØªØ³ÙˆÙ‚ Ø¨Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</h3>
      <a href="#/" class="text-rose-600 hover:underline cursor-pointer">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</a>
    </div>
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-3">
      ${categories.map(cat => `
        <a href="#/c/${encodeURIComponent(cat.name)}" class="group relative block overflow-hidden rounded-2xl border bg-white">
          <img src="${cat.image}" alt="${cat.name}" class="h-28 w-full object-cover transition-transform duration-300 group-hover:scale-105" />
          <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent"></div>
          <div class="absolute bottom-2 right-2 text-white text-sm font-semibold">${cat.name}</div>
        </a>`).join('')}
    </div>`;
}
function productCard(p){
  return `
  <div class="group rounded-2xl border bg-white overflow-hidden hover:shadow-md transition-shadow">
    <div class="relative">
      <img src="${p.image}" class="w-full h-56 object-cover"/>
      ${p.badge ? `<span class="absolute top-3 right-3 bg-rose-600 text-white text-xs px-2 py-1 rounded-full">${p.badge}</span>` : ''}
      <button class="absolute bottom-3 left-3 bg-white/90 backdrop-blur text-sm rounded-xl px-3 py-1 hover:bg-white">
        Ø­Ø¯ Ø£Ø¯Ù†Ù‰: ${effMin(p)}
      </button>
    </div>
    <div class="p-3" dir="rtl">
      <h4 class="font-semibold min-h-[44px]">${p.title}</h4>
      <div class="flex items-baseline gap-2 mt-2">
        <span class="text-lg font-extrabold">${fmt(p.price)}</span>
        <span class="text-sm line-through text-gray-400">${fmt(p.oldPrice)}</span>
      </div>
      <div class="mt-3 flex items-center gap-2">
        <button class="flex-1 rounded-xl bg-rose-600 text-white py-2 font-semibold hover:bg-rose-700 btn-add" data-id="${p.id}">Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©</button>
        <button class="rounded-xl border px-3 py-2 hover:bg-gray-50" title="Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ÙØ¶Ù„Ø©">â™¡</button>
      </div>
    </div>
  </div>`;
}
function renderProducts(){
  const el = document.getElementById('productsSection');
  const list = applyFilters(products);
  el.innerHTML = `
    <div class="flex items-center justify-between mb-3">
      <h3 class="text-lg md:text-xl font-bold">${currentQuery ? `Ù†ØªØ§Ø¦Ø¬ Ø¹Ù†: "${currentQuery}"` : 'Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ù‹Ø§'}</h3>
      <div class="flex items-center gap-2 text-sm">
        <span>ØªØ±ØªÙŠØ¨:</span>
        <select id="homeSort" class="border rounded-xl px-2 py-1">
          <option value="default">Ø¨Ø¯ÙˆÙ† ØªØ±ØªÙŠØ¨</option>
          <option value="priceLow">Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø£Ø¹Ù„Ù‰</option>
          <option value="priceHigh">Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù„Ø£Ù‚Ù„</option>
          <option value="ratingHigh">Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ù‹Ø§</option>
        </select>
      </div>
    </div>
    <div class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-4">
      ${list.length ? list.map(productCard).join('') : `<div class="rounded-2xl border bg-white p-6">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©.</div>`}
    </div>`;
  const sel = document.getElementById('homeSort');
  sel.value = currentSort;
  sel.onchange = (e) => { currentSort = e.target.value; renderProducts(); };
}
function refreshAll(){
  document.getElementById('brandName').textContent = brand;
  document.getElementById('brandNameFooter').textContent = brand;
  document.getElementById('brandNameCopy').textContent = brand;
  document.getElementById('year').textContent = new Date().getFullYear();
  document.getElementById('brandInChat').textContent = brand;
  renderHero(); renderBenefits(); renderCategories(); renderProducts();
  renderCartIcon();
}

/* =====================[ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ]===================== */
const modal = document.getElementById('adminModal');
const openAdminBtn = document.getElementById('openAdmin');
function openAdminPanel(){
  modal.classList.remove('hidden');
  document.getElementById('brandInput').value = brand;
  document.getElementById('heroTitleInput').value = hero.title;
  document.getElementById('heroSubInput').value = hero.subtitle;
  document.getElementById('heroImgPreview').src = hero.image;
  switchTab('products'); fillCatSelect(); listCats(); listProds();
}
if (!isAdmin) openAdminBtn.classList.add('hidden');
openAdminBtn.onclick = () => { if (!isAdmin) { location.hash = '#/admin'; ensureAdmin(); return; } openAdminPanel(); };
document.getElementById('closeAdmin').onclick = ()=> modal.classList.add('hidden');
document.getElementById('adminCloseBg').onclick = ()=> modal.classList.add('hidden');

document.querySelectorAll('.tab-btn').forEach(btn=> btn.addEventListener('click', ()=> switchTab(btn.dataset.tab)));
function switchTab(name){
  document.querySelectorAll('.tab-pane').forEach(p=>p.classList.add('hidden'));
  document.getElementById('tab-'+name).classList.remove('hidden');
  document.querySelectorAll('.tab-btn').forEach(b=>{
    const on = b.dataset.tab===name;
    b.classList.toggle('bg-rose-600', on);
    b.classList.toggle('text-white', on);
    b.classList.toggle('border-rose-600', on);
  });
}

/* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© */
document.getElementById('brandInput').addEventListener('input', e=>{ brand = e.target.value || 'ZADORA'; lsSet(LS_KEYS.brand, brand); refreshAll(); });
document.getElementById('heroTitleInput').addEventListener('input', e=>{ hero.title = e.target.value; lsSet(LS_KEYS.hero, hero); refreshAll(); });
document.getElementById('heroSubInput').addEventListener('input', e=>{ hero.subtitle = e.target.value; lsSet(LS_KEYS.hero, hero); refreshAll(); });
document.getElementById('heroImgInput').addEventListener('change', e=>{
  const file = e.target.files[0]; if(!file) return;
  const r = new FileReader(); r.onload = ev =>{ hero.image = String(ev.target.result); lsSet(LS_KEYS.hero, hero); refreshAll(); };
  r.readAsDataURL(file);
});

/* Ø£Ù‚Ø³Ø§Ù… */
let editingCat = null;
function listCats(){
  const wrap = document.getElementById('catsList');
  wrap.innerHTML = categories.map(c=>`
    <div class="rounded-2xl border overflow-hidden bg-white">
      <div class="aspect-[4/3] w-full overflow-hidden">
        <img src="${c.image}" class="w-full h-full object-cover" />
      </div>
      <div class="p-3 flex items-center justify-between">
        <div class="font-semibold">${c.name}</div>
        <div class="flex gap-2">
          <button class="rounded-xl border px-3 py-1 hover:bg-gray-50" onclick='editCat("${c.name}")'>ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="rounded-xl border px-3 py-1 hover:bg-gray-50" onclick='deleteCat("${c.name}")'>Ø­Ø°Ù</button>
        </div>
      </div>
    </div>`).join('');
}
function editCat(name){
  const c = categories.find(x=>x.name===name); if(!c) return;
  editingCat = name;
  document.getElementById('catName').value = c.name;
  document.getElementById('catImgPreview').src = c.image;
}
function deleteCat(name){
  if(!confirm('Ù…Ø³Ø­ Ø§Ù„Ù‚Ø³Ù…ØŸ')) return;
  categories = categories.filter(c=>c.name!==name);
  lsSet(LS_KEYS.cats, categories); fillCatSelect(); listCats(); renderCategories(); renderRoute();
}
document.getElementById('catImgInput').addEventListener('change', e=>{
  const f = e.target.files[0]; if(!f) return;
  const r = new FileReader(); r.onload = ev => document.getElementById('catImgPreview').src = String(ev.target.result);
  r.readAsDataURL(f);
});
document.getElementById('saveCat').onclick = ()=>{
  const name = document.getElementById('catName').value.trim();
  const img = document.getElementById('catImgPreview').src;
  if(!name) return alert('Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…');
  if(editingCat){ categories = categories.map(c=> c.name===editingCat? {name, image:img}: c); }
  else{
    if(categories.some(c=>c.name===name)) return alert('Ø§Ù„Ù‚Ø³Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„');
    categories.push({name, image:img});
  }
  editingCat=null; document.getElementById('catName').value=''; document.getElementById('catImgPreview').src='';
  lsSet(LS_KEYS.cats, categories); fillCatSelect(); listCats(); renderCategories(); renderRoute();
};
document.getElementById('resetCat').onclick = ()=>{ editingCat=null; document.getElementById('catName').value=''; document.getElementById('catImgPreview').src=''; };
function fillCatSelect(){
  const sel = document.getElementById('pCategory');
  sel.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>' + categories.map(c=> `<option>${c.name}</option>`).join('');
}

/* Ù…Ù†ØªØ¬Ø§Øª */
let editingProd = null;
function listProds(){
  const wrap = document.getElementById('productsList');
  wrap.innerHTML = products.map(p=>`
    <div class="rounded-2xl border bg-white overflow-hidden">
      <div class="aspect-[4/3] w-full overflow-hidden">
        <img src="${p.image}" class="w-full h-full object-cover"/>
      </div>
      <div class="p-3">
        <div class="font-semibold">${p.title}</div>
        <div class="text-sm text-gray-500 mt-1">${p.category||''}</div>
        <div class="flex items-baseline gap-2 mt-2">
          <span class="text-lg font-extrabold">${fmt(p.price)}</span>
          <span class="text-sm line-through text-gray-400">${fmt(p.oldPrice)}</span>
        </div>
        <div class="mt-3 flex items-center gap-2">
          <button class="rounded-xl border px-3 py-1 hover:bg-gray-50" onclick='editProd(${JSON.stringify(p.id)})'>ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="rounded-xl border px-3 py-1 hover:bg-gray-50" onclick='deleteProd(${JSON.stringify(p.id)})'>Ø­Ø°Ù</button>
        </div>
      </div>
    </div>`).join('');
}
function editProd(id){
  const p = products.find(x=>String(x.id)===String(id)); if(!p) return;
  editingProd = id;
  pTitle.value = p.title; pPrice.value=p.price; pOld.value=p.oldPrice;
  pRating.value=p.rating; pReviews.value=p.reviews; pMinQty.value=p.minQty;
  pBadge.value=p.badge||''; pCategory.value=p.category||''; pImgPreview.src=p.image;
}
function deleteProd(id){
  if(!confirm('Ù…Ø³Ø­ Ø§Ù„Ù…Ù†ØªØ¬ØŸ')) return;
  products = products.filter(p=>String(p.id)!==String(id));
  lsSet(LS_KEYS.prods, products); listProds(); renderProducts(); renderRoute();
}
pImgInput.addEventListener('change', e=>{
  const f = e.target.files[0]; if(!f) return;
  const r = new FileReader(); r.onload = ev => pImgPreview.src = String(ev.target.result);
  r.readAsDataURL(f);
});
saveProduct.onclick = ()=>{
  const form = {
    title: pTitle.value.trim(),
    price: Number(pPrice.value||0),
    oldPrice: Number(pOld.value||0),
    rating: Number(pRating.value||0),
    reviews: Number(pReviews.value||0),
    minQty: Number(pMinQty.value||0),
    badge: pBadge.value.trim(),
    category: pCategory.value,
    image: pImgPreview.src || ''
  };
  if(!form.title) return alert('Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬');
  if(editingProd){ products = products.map(p=> String(p.id)===String(editingProd)? {...form, id: editingProd}: p); }
  else{
    const nextId = products.length? Math.max(...products.map(p=>Number(p.id)||0))+1: 1;
    products.push({...form, id: nextId});
  }
  editingProd=null;
  ['pTitle','pPrice','pOld','pRating','pReviews','pMinQty','pBadge'].forEach(id=> document.getElementById(id).value='');
  pCategory.value=''; pImgPreview.src='';
  lsSet(LS_KEYS.prods, products); listProds(); renderProducts(); renderRoute();
};
resetProduct.onclick = ()=>{
  editingProd=null; ['pTitle','pPrice','pOld','pRating','pReviews','pMinQty','pBadge'].forEach(id=> document.getElementById(id).value='');
  pCategory.value=''; pImgPreview.src='';
};

/* ØªØµØ¯ÙŠØ±/Ø§Ø³ØªÙŠØ±Ø§Ø¯/Ø¥Ø±Ø¬Ø§Ø¹ */
document.getElementById('exportJson').onclick = ()=>{
  const data = { brand, hero, categories, products };
  const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'zadora_store_export.json'; a.click(); URL.revokeObjectURL(url);
};
document.getElementById('importJson').addEventListener('change', e=>{
  const f = e.target.files[0]; if(!f) return;
  const r = new FileReader(); r.onload = ev => {
    try{
      const data = JSON.parse(String(ev.target.result||'{}'));
      if(data.brand) brand = data.brand;
      if(data.hero) hero = data.hero;
      if(Array.isArray(data.categories)) categories = data.categories;
      if(Array.isArray(data.products)) products = data.products;
      lsSet(LS_KEYS.brand, brand); lsSet(LS_KEYS.hero, hero); lsSet(LS_KEYS.cats, categories); lsSet(LS_KEYS.prods, products);
      refreshAll(); fillCatSelect(); listCats(); listProds(); renderRoute();
    }catch{ alert('Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­'); }
  }; r.readAsText(f);
});
document.getElementById('resetAll').onclick = ()=>{
  if(!confirm('Ø¥Ø±Ø¬Ø§Ø¹ ÙƒÙ„ Ø´ÙŠØ¡ Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØŸ')) return;
  brand = DEFAULT_BRAND; hero = DEFAULT_HERO; categories = DEFAULT_CATS.slice(); products = DEFAULT_PRODS.slice();
  lsSet(LS_KEYS.brand, brand); lsSet(LS_KEYS.hero, hero); lsSet(LS_KEYS.cats, categories); lsSet(LS_KEYS.prods, products);
  refreshAll(); fillCatSelect(); listCats(); listProds(); renderRoute();
};

/* =====================[ Router ]===================== */
function renderCategoryView(cat) {
  showHomeSections(false);
  const all = products.filter(p => (p.category || '') === cat);
  const list = applyFilters(all);
  const el = document.getElementById('productsSection');

  el.innerHTML = `
    <div class="flex items-center justify-between mb-3">
      <div class="text-lg md:text-xl font-bold">Ù‚Ø³Ù…: ${cat}</div>
      <div class="flex items-center gap-3">
        <select id="catSort" class="border rounded-xl px-2 py-1">
          <option value="default">Ø¨Ø¯ÙˆÙ† ØªØ±ØªÙŠØ¨</option>
          <option value="priceLow">Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø£Ø¹Ù„Ù‰</option>
          <option value="priceHigh">Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù„Ø£Ù‚Ù„</option>
          <option value="ratingHigh">Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ù‹Ø§</option>
        </select>
        <a href="#/" class="text-rose-600 hover:underline">Ø¹ÙˆØ¯Ø© Ù„Ù„ÙƒÙ„</a>
      </div>
    </div>
    <div class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-4">
      ${list.length ? list.map(productCard).join('') : `<div class="rounded-2xl border bg-white p-6">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</div>`}
    </div>`;
  const sel = document.getElementById('catSort');
  sel.value = currentSort;
  sel.onchange = (e)=> { currentSort = e.target.value; renderCategoryView(cat); };
}
function renderHome(){ showHomeSections(true); renderProducts(); }
function renderRoute(){
  const h = decodeURIComponent(location.hash || '#/');
  if (h.startsWith('#/c/')) renderCategoryView(h.slice(4));
  else renderHome();
}

/* =====================[ Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù…Ø¨Ø§Ø´Ø± ]===================== */
function attachSearch(){
  const boxes = [document.getElementById('search'), document.getElementById('search2')].filter(Boolean);
  boxes.forEach(inp=>{
    inp.value = currentQuery;
    inp.oninput = (e)=>{ currentQuery = e.target.value; renderRoute(); };
    inp.onkeydown = (e)=>{ if(e.key==='Escape'){ e.target.value=''; currentQuery=''; renderRoute(); } };
  });
}

/* =====================[ ÙˆÙŠØ¯Ø¬Øª Ø§Ù„Ø´Ø§Øª (Ø¨ÙˆØª Ø¨Ø³ÙŠØ·) ]===================== */
const chatPanel = document.getElementById('chatPanel');
const chatToggle = document.getElementById('chatToggle');
const chatClose  = document.getElementById('chatClose');
const chatBody   = document.getElementById('chatBody');
const chatInput  = document.getElementById('chatInput');
const chatSend   = document.getElementById('chatSend');

chatToggle.onclick = ()=> chatPanel.classList.toggle('hidden');
chatClose.onclick  = ()=> chatPanel.classList.add('hidden');
document.querySelectorAll('.quick').forEach(b=> b.onclick = ()=> { sendMsg(b.textContent); });

let chatHistory = lsGet('zl_chat_history', []);
function renderChat(){
  chatBody.innerHTML = chatHistory.map(m => `
    <div class="flex ${m.role==='user'?'justify-start':'justify-end'}">
      <div class="max-w-[80%] rounded-2xl px-3 py-2 text-sm ${m.role==='user'?'bg-white border':'bg-rose-600 text-white'}">
        ${m.text}
      </div>
    </div>`).join('');
  chatBody.scrollTop = chatBody.scrollHeight;
}
function push(role,text){ chatHistory.push({role,text,ts:Date.now()}); lsSet('zl_chat_history', chatHistory); renderChat(); }
function replyBot(q){
  const t = q.trim(); const s = w => t.includes(w); let a = '';
  if (s('Ø´Ø­Ù†')||s('ØªÙˆØµÙŠÙ„')||s('Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©')||s('Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª')) a='Ø§Ù„Ø´Ø­Ù† Ø®Ù„Ø§Ù„ 24-72 Ø³Ø§Ø¹Ø© Ù„ÙƒÙ„ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª. Ø§Ù„Ø³Ø¹Ø± Ø­Ø³Ø¨ Ø§Ù„ÙˆØ²Ù† ÙˆØ§Ù„Ù…Ø­Ø§ÙØ¸Ø©. Ù‡Ù†Ø¬Ù…Ø¹ Ø§Ù„Ø£ÙˆØ±Ø¯Ø± ÙˆÙ†ØªÙˆØ§ØµÙ„ Ù„Ù„ØªØ£ÙƒÙŠØ¯.';
  else if (s('Ø§Ø³ØªØ±Ø¬Ø§Ø¹')||s('Ø§Ø±Ø¬Ø§Ø¹')||s('Ø§Ø³ØªØ¨Ø¯Ø§Ù„')) a='Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø®Ù„Ø§Ù„ 7 Ø£ÙŠØ§Ù… Ù„Ù„Ù‚Ø·Ø¹ Ø§Ù„Ù…Ø¹ÙŠÙˆØ¨Ø©/Ø§Ù„Ù…ÙƒØ³ÙˆØ±Ø© â€“ Ø¨Ù†Ø¨Ø¯Ù„ ÙÙˆØ±Ù‹Ø§ Ø£Ùˆ Ù†Ø±Ø¬Ø¹ Ù‚ÙŠÙ…ØªÙ‡Ø§.';
  else if (s('Ø­Ø¯ Ø£Ø¯Ù†Ù‰')||s('Ø§Ù‚Ù„ ÙƒÙ…ÙŠØ©')||s('Ø£Ù‚Ù„ ÙƒÙ…ÙŠØ©')) a='Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø·Ù„Ø¨: 12 Ù‚Ø·Ø¹Ø© Ù„ÙƒÙ„ ØµÙ†Ù (Ø£Ùˆ ÙƒØ±ØªÙˆÙ†Ø© ÙƒØ§Ù…Ù„Ø© Ù„Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª).';
  else if (s('Ø¯ÙØ¹')||s('ØªØ­ÙˆÙŠÙ„')||s('ÙÙŠØ²Ø§')||s('ÙƒØ§Ø´')) a='Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹: ÙƒØ§Ø´ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… (Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©/Ø§Ù„Ø¬ÙŠØ²Ø©)ØŒ ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠØŒ Ø£Ùˆ ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´.';
  else if (s('Ø³Ø¹Ø±')||s('Ø³Ø¹Ø±Ù‡')||s('Ø«Ù…Ù†')) a='Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø¨Ø§Ù„Ø¬Ù…Ù„Ø© Ø¸Ø§Ù‡Ø±Ø© ØªØ­Øª ÙƒÙ„ Ù…Ù†ØªØ¬. Ù„Ø£Ø³Ø¹Ø§Ø± Ø¬Ù…Ù„Ø© ÙƒØ¨ÙŠØ±Ø© Ø§Ø¨Ø¹ØªÙ„Ù†Ø§ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨.';
  else if (s('ØªÙˆØ§ØµÙ„')||s('ÙˆØ§ØªØ³Ø§Ø¨')||s('Ø±Ù‚Ù…')) a=`ØªÙ‚Ø¯Ø± ØªÙƒÙ„Ù… ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø©: ÙˆØ§ØªØ³Ø§Ø¨ ${WHATSAPP_PHONE} Ø£Ùˆ Ø¥ÙŠÙ…ÙŠÙ„ ${SUPPORT_EMAIL}.`;
  else a='Ù…ÙÙ‡ÙˆÙ…! ğŸ˜Š Ù„Ùˆ Ø³Ø¤Ø§Ù„Ùƒ Ø¹Ù† Ø§Ù„Ø´Ø­Ù†/Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹/Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰/Ø§Ù„Ø¯ÙØ¹ Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙ„Ù…Ø©ØŒ Ø£Ùˆ ØªÙˆØ§ØµÙ„ Ø¹Ù„Ù‰ Ø²Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ø¨Ø§Ù„Ø£Ø³ÙÙ„.';
  push('bot', a);
}
function sendMsg(text){
  const v = (text ?? chatInput.value).trim(); if(!v) return;
  push('user', v); chatInput.value=''; setTimeout(()=> replyBot(v), 400);
}
chatSend.onclick = ()=> sendMsg();
chatInput.addEventListener('keydown', (e)=> { if(e.key==='Enter') sendMsg(); });

/* =====================[ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø³Ù„Ø© + ÙØªØ­/ØºÙ„Ù‚ ]===================== */
document.getElementById('openCart').onclick = openCart;
document.getElementById('closeCart').onclick = closeCart;
document.getElementById('cartCloseBg').onclick = closeCart;
document.getElementById('cartClear').onclick = clearCart;

// Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ + Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„
['cusName','cusPhone','cusCity','cusTier'].forEach(id=>{
  const el = document.getElementById(id);
  el.addEventListener('input', ()=>{
    customer = {
      name:  document.getElementById('cusName').value.trim(),
      phone: document.getElementById('cusPhone').value.trim(),
      city:  document.getElementById('cusCity').value.trim(),
      tier:  document.getElementById('cusTier').value
    };
    lsSet(LS_KEYS.customer, customer);
    renderCartPanel();
  });
});

// ØªÙÙˆÙŠØ¶ Ù†Ù‚Ø±Ø§Øª (Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø³Ù„Ø© + Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©)
document.addEventListener('click', (e)=>{
  const add = e.target.closest('.btn-add'); if(add){ addToCart(add.dataset.id); return; }
  const inc = e.target.closest('.qty-inc'); if(inc){ changeQty(inc.dataset.id, +1); return; }
  const dec = e.target.closest('.qty-dec'); if(dec){ changeQty(dec.dataset.id, -1); return; }
  const rm  = e.target.closest('.item-remove'); if(rm){ removeItem(rm.dataset.id); return; }
});

/* Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ / Ø¨Ø±ÙŠØ¯ */
function buildOrderText(){
  const lines = cart.map(it=>{
    const p = getProd(it.id); if(!p) return '';
    const line = (p.price||0)*(it.qty||0);
    return `â€¢ ${p.title} â€” ÙƒÙ…ÙŠØ©: ${it.qty} â€” ${line} Ø¬.Ù…`;
  }).filter(Boolean).join('\n');

  const subtotal = cartSubtotal();
  const tier = customer.tier || 'wh';
  let note = '';
  let discount = 0;

  if (tier==='retail'){ discount = Math.round(subtotal*0.10); note = `Ø®ØµÙ… Ù‚Ø·Ø§Ø¹ÙŠ 10%: -${discount} Ø¬.Ù…`; }
  if (tier==='wh'){ note = `ÙƒØ§Ø´ Ø¨Ø§Ùƒ 2%: ${Math.round(subtotal*0.02)} Ø¬.Ù…`; }
  if (tier==='half'){ note = 'Ù‡Ø¯ÙŠØ©: Ø¨ÙˆÙƒØ³ Ù…Ù† ZADORA'; }

  const total = subtotal - discount;

  return `Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† ${brand}:
${lines}
----------------
Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±Ø¹ÙŠ: ${subtotal} Ø¬.Ù…
${note}
Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${total} Ø¬.Ù…
Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„: ${tier==='wh'?'Ø¬Ù…Ù„Ø© Ø§Ù„Ø¬Ù…Ù„Ø©':tier==='half'?'Ù†Øµ Ø¬Ù…Ù„Ø©':'Ù‚Ø·Ø§Ø¹ÙŠ'}
Ø§Ù„Ø§Ø³Ù…: ${customer.name||'-'}
Ø§Ù„Ù‡Ø§ØªÙ: ${customer.phone||'-'}
Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©/Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: ${customer.city||'-'}`;
}
document.getElementById('cartCheckoutWA').onclick = ()=>{
  if(!cart.length) return;
  const text = buildOrderText();
  const url = 'https://wa.me/' + WHATSAPP_PHONE + '?text=' + encodeURIComponent(text);
  window.open(url, '_blank');
};
document.getElementById('cartCheckoutEmail').onclick = ()=>{
  if(!cart.length) return;
  const subject = encodeURIComponent(`Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ - ${brand}`);
  const body = encodeURIComponent(buildOrderText());
  window.location.href = `mailto:${SUPPORT_EMAIL}?subject=${subject}&body=${body}`;
};

/* =====================[ Ø¨Ø¯Ø¡ ]===================== */
refreshAll(); fillCatSelect(); listCats(); listProds();
renderRoute(); attachSearch(); renderChat(); renderCartIcon();

if (location.hash === '#/admin' && !isAdmin) ensureAdmin();
window.addEventListener('hashchange', () => {
  if (location.hash === '#/admin' && !isAdmin) ensureAdmin();
  renderRoute(); attachSearch();
});
</script>
</body>
</html>
