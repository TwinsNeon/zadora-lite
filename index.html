<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ZADORA Lite</title>
  <!-- Tailwind ุนุจุฑ CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{ background:#fafafa; color:#111827; }
    .container{ max-width:1120px; margin:0 auto; }
    .glass{ backdrop-filter: blur(6px); background: rgba(255,255,255,.85); }
    .modal-bg{ background: rgba(0,0,0,.45); }
  </style>
</head>
<body class="min-h-screen">
  <!-- ุงูููุฏุฑ -->
  <header class="sticky top-0 z-40 glass border-b">
    <div class="container px-4 py-3 flex items-center gap-3">
      <div class="font-extrabold text-xl text-rose-600" id="brandName">ZADORA</div>
      <div class="flex-1"></div>

      <!-- ุจุญุซ -->
      <div class="hidden md:block w-[420px]">
        <input id="search" placeholder="ุฅุจุญุซ ุนู ููุชุฌ..." class="w-full rounded-xl border px-3 py-2" />
      </div>

      <!-- ุฒุฑ ุงูุณูุฉ -->
      <button id="openCart" class="relative rounded-xl border px-3 py-2 hover:bg-gray-50">
        ๐ ุงูุณูุฉ
        <span id="cartCount" class="absolute -top-2 -left-2 min-w-[22px] h-[22px] text-xs rounded-full bg-rose-600 text-white px-1 flex items-center justify-center hidden">0</span>
      </button>

      <!-- ููุญุฉ ุงูุชุญูู -->
      <button id="openAdmin" class="rounded-xl border px-3 py-2 hover:bg-gray-50">โ๏ธ ููุญุฉ ุงูุชุญูู</button>
    </div>
    <div class="md:hidden px-4 pb-3">
      <input id="search2" placeholder="ุฅุจุญุซ ุนู ููุชุฌ..." class="w-full rounded-xl border px-3 py-2" />
    </div>
  </header>

  <!-- ููุฑู -->
  <section class="container px-4 mt-4" id="heroSection"></section>
  <!-- ูููุฒุงุช -->
  <section class="container px-4 mt-6" id="benefitsSection"></section>
  <!-- ุฃูุณุงู -->
  <section class="container px-4 mt-8" id="categoriesSection"></section>
  <!-- ููุชุฌุงุช -->
  <section class="container px-4 mt-8" id="productsSection"></section>

  <!-- ูุดุฑุฉ ุจุฑูุฏูุฉ -->
  <section class="container px-4 mt-10">
    <div class="rounded-2xl bg-neutral-900 text-white overflow-hidden">
      <div class="grid md:grid-cols-2">
        <div class="p-8 md:p-12">
          <h3 class="text-2xl md:text-3xl font-extrabold">ูุงุฆูุฉ ุงูุชุฌุงุฑ ุงูุจุฑูุฏูุฉ</h3>
          <p class="mt-2 text-white/80">ุฎุตููุงุช ุฎุงุตุฉ ุจุงูุฌููุฉ + ุนุฑูุถ ุตูุงุฏูู ุฌุงูุฒุฉ ุฃุณุจูุนููุง.</p>
          <div class="mt-5 flex items-center gap-2">
            <input class="flex-1 rounded-xl px-3 py-2 text-neutral-900" placeholder="ุงูุชุจ ุจุฑูุฏู ุงูุฅููุชุฑููู" dir="rtl"/>
            <button class="rounded-xl bg-rose-600 px-4 py-2 font-semibold hover:bg-rose-700">ุงุดุชุฑู</button>
          </div>
        </div>
        <div class="relative min-h-[220px]">
          <img src="https://images.unsplash.com/photo-1523275335684-37898b6baf30?q=80&w=1600&auto=format&fit=crop" alt="newsletter" class="absolute inset-0 w-full h-full object-cover opacity-70"/>
        </div>
      </div>
    </div>
  </section>

  <!-- ููุชุฑ -->
  <footer class="mt-10 border-t">
    <div class="container px-4 py-8 grid md:grid-cols-4 gap-8 text-right">
      <div>
        <div class="font-bold text-lg"><span class="text-rose-600">โฆ</span> <span id="brandNameFooter">ZADORA</span></div>
        <p class="mt-3 text-sm text-gray-600">ููุตุฉ ุฌููุฉ ููุฃุฏูุงุช ุงูููุฒููุฉ: ุญุฏ ุฃุฏูู 12 ูุทุนุฉุ ุดุญู ุณุฑูุนุ ูุถูุงู ุงุณุชุจุฏุงู.</p>
      </div>
      <div>
        <h4 class="font-semibold mb-2">ุฎุฏูุฉ ุงูุนููุงุก</h4>
        <ul class="space-y-1 text-sm text-gray-600">
          <li><a class="hover:underline">ุณูุงุณุฉ ุงูุงุณุชุฑุฌุงุน</a></li>
          <li><a class="hover:underline">ุงูุดุญู ูุงูุชุณููู</a></li>
          <li><a class="hover:underline">ุทุฑู ุงูุฏูุน</a></li>
        </ul>
      </div>
      <div>
        <h4 class="font-semibold mb-2">ุงูุดุฑูุฉ</h4>
        <ul class="space-y-1 text-sm text-gray-600">
          <li><a class="hover:underline">ูู ูุญู</a></li>
          <li><a class="hover:underline">ุงูุถู ูุชุงุฌุฑ/ููุฑุฏ</a></li>
          <li><a class="hover:underline">ุชูุงุตู ูุนูุง</a></li>
        </ul>
      </div>
      <div>
        <h4 class="font-semibold mb-2">ุชุงุจุนูุง</h4>
        <ul class="space-y-1 text-sm text-gray-600">
          <li><a class="hover:underline">Facebook</a></li>
          <li><a class="hover:underline">Instagram</a></li>
          <li><a class="hover:underline">TikTok</a></li>
        </ul>
      </div>
    </div>
    <div class="py-4 text-center text-xs text-gray-500">ยฉ <span id="year"></span> <span id="brandNameCopy">ZADORA</span>. All rights reserved.</div>
  </footer>

  <!-- ููุญุฉ ุงูุชุญูู -->
  <div id="adminModal" class="fixed inset-0 hidden z-50 modal-bg">
    <div class="absolute inset-0" id="adminCloseBg"></div>
    <div class="absolute right-0 top-0 bottom-0 w-full md:w-[760px] bg-white rounded-none md:rounded-l-3xl shadow-2xl overflow-y-auto">
      <div class="sticky top-0 glass border-b p-4 flex items-center justify-between">
        <div class="font-bold">ููุญุฉ ุงูุชุญูู</div>
        <div class="flex items-center gap-2">
          <label class="rounded-xl border px-3 py-2 text-sm cursor-pointer hover:bg-gray-50">
            <input type="file" id="importJson" accept="application/json" class="hidden" /> ุงุณุชูุฑุงุฏ
          </label>
          <button id="exportJson" class="rounded-xl border px-3 py-2 text-sm hover:bg-gray-50">ุชุตุฏูุฑ</button>
          <button id="resetAll" class="rounded-xl border px-3 py-2 text-sm hover:bg-gray-50">ุฅุฑุฌุงุน ุงูุงูุชุฑุงุถู</button>
          <button id="closeAdmin" class="rounded-xl bg-rose-600 text-white px-4 py-2 text-sm">ุฅุบูุงู</button>
        </div>
      </div>

      <div class="p-4">
        <div class="flex gap-2 mb-4">
          <button data-tab="products" class="tab-btn rounded-xl px-4 py-2 text-sm border">ุงูููุชุฌุงุช</button>
          <button data-tab="categories" class="tab-btn rounded-xl px-4 py-2 text-sm border">ุงูุฃูุณุงู</button>
          <button data-tab="settings" class="tab-btn rounded-xl px-4 py-2 text-sm border">ุงูุฅุนุฏุงุฏุงุช</button>
        </div>

        <!-- ุฅุนุฏุงุฏุงุช -->
        <div id="tab-settings" class="tab-pane hidden" dir="rtl">
          <div class="grid md:grid-cols-2 gap-4">
            <div class="space-y-2">
              <label class="text-sm font-medium">ุงุณู ุงูุจุฑุงูุฏ</label>
              <input id="brandInput" class="w-full rounded-xl border px-3 py-2" placeholder="ZADORA"/>
              <label class="text-sm font-medium">ุนููุงู ุงูููุฑู</label>
              <input id="heroTitleInput" class="w-full rounded-xl border px-3 py-2"/>
              <label class="text-sm font-medium">ูุตู ุงูููุฑู</label>
              <textarea id="heroSubInput" class="w-full rounded-xl border px-3 py-2 min-h-[112px]"></textarea>
            </div>
            <div class="space-y-2">
              <div class="text-sm font-medium">ุตูุฑุฉ ุงูููุฑู</div>
              <div class="aspect-[4/3] w-full overflow-hidden rounded-xl border bg-white" id="heroImgWrap">
                <img id="heroImgPreview" class="w-full h-full object-cover" />
              </div>
              <label class="inline-flex items-center gap-2 rounded-xl border px-3 py-2 cursor-pointer hover:bg-gray-50">
                <input id="heroImgInput" type="file" accept="image/*" class="hidden" /> ุฑูุน ุตูุฑุฉ
              </label>
            </div>
          </div>
        </div>

        <!-- ุฃูุณุงู -->
        <div id="tab-categories" class="tab-pane hidden" dir="rtl">
          <div class="grid md:grid-cols-3 gap-4">
            <div class="space-y-3">
              <input id="catName" class="w-full rounded-xl border px-3 py-2" placeholder="ุงุณู ุงููุณู"/>
              <div class="space-y-2">
                <div class="text-sm font-medium">ุตูุฑุฉ ุงููุณู</div>
                <div class="aspect-[4/3] w-full overflow-hidden rounded-xl border bg-white">
                  <img id="catImgPreview" class="w-full h-full object-cover" />
                </div>
                <label class="inline-flex items-center gap-2 rounded-xl border px-3 py-2 cursor-pointer hover:bg-gray-50">
                  <input id="catImgInput" type="file" accept="image/*" class="hidden" /> ุฑูุน ุตูุฑุฉ
                </label>
              </div>
              <div class="flex gap-2">
                <button id="saveCat" class="flex-1 rounded-xl bg-rose-600 text-white py-2 font-semibold">ุญูุธ</button>
                <button id="resetCat" class="rounded-xl border px-3">ุฅูุบุงุก</button>
              </div>
            </div>
            <div class="md:col-span-2 grid sm:grid-cols-2 gap-3" id="catsList"></div>
          </div>
        </div>

        <!-- ููุชุฌุงุช -->
        <div id="tab-products" class="tab-pane hidden" dir="rtl">
          <div class="grid md:grid-cols-3 gap-4">
            <div class="space-y-3">
              <input id="pTitle" class="w-full rounded-xl border px-3 py-2" placeholder="ุงุณู ุงูููุชุฌ"/>
              <div class="grid grid-cols-2 gap-2">
                <input id="pPrice" class="rounded-xl border px-3 py-2" placeholder="ุงูุณุนุฑ" type="number"/>
                <input id="pOld" class="rounded-xl border px-3 py-2" placeholder="ุงูุณุนุฑ ูุจู" type="number"/>
              </div>
              <div class="grid grid-cols-3 gap-2">
                <input id="pRating" class="rounded-xl border px-3 py-2" placeholder="ุชูููู" type="number" step="0.1"/>
                <input id="pReviews" class="rounded-xl border px-3 py-2" placeholder="ูุฑุงุฌุนุงุช" type="number"/>
                <input id="pMinQty" class="rounded-xl border px-3 py-2" placeholder="ุญุฏ ุฃุฏูู" type="number"/>
              </div>
              <input id="pBadge" class="w-full rounded-xl border px-3 py-2" placeholder="ุดุงุฑุฉ (ุฌุฏูุฏ/ุนุฑุถ ุฎุงุต)"/>
              <select id="pCategory" class="w-full rounded-xl border px-3 py-2"></select>
              <div class="space-y-2">
                <div class="text-sm font-medium">ุตูุฑุฉ ุงูููุชุฌ</div>
                <div class="aspect-[4/3] w-full overflow-hidden rounded-xl border bg-white">
                  <img id="pImgPreview" class="w-full h-full object-cover" />
                </div>
                <label class="inline-flex items-center gap-2 rounded-xl border px-3 py-2 cursor-pointer hover:bg-gray-50">
                  <input id="pImgInput" type="file" accept="image/*" class="hidden" /> ุฑูุน ุตูุฑุฉ
                </label>
              </div>
              <div class="flex gap-2">
                <button id="saveProduct" class="flex-1 rounded-xl bg-rose-600 text-white py-2 font-semibold">ุฅุถุงูุฉ/ุชุญุฏูุซ</button>
                <button id="resetProduct" class="rounded-xl border px-3">ุฅูุบุงุก</button>
              </div>
            </div>
            <div class="md:col-span-2 grid sm:grid-cols-2 gap-3" id="productsList"></div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- ููุฏุฌุช ุงูุดุงุช -->
  <div id="chatRoot" class="fixed bottom-4 right-4 z-50">
    <button id="chatToggle" class="rounded-full shadow-lg bg-rose-600 text-white w-14 h-14 flex items-center justify-center text-2xl">๐ฌ</button>
    <div id="chatPanel" class="hidden mt-3 w-[320px] sm:w-[360px] rounded-2xl shadow-2xl border bg-white overflow-hidden">
      <div class="flex items-center justify-between px-4 py-3 bg-neutral-900 text-white">
        <div class="font-semibold">ุฏุนู <span id="brandInChat">ZADORA</span></div>
        <button id="chatClose" title="ุฅุบูุงู">โ</button>
      </div>
      <div id="chatBody" class="h-[320px] overflow-y-auto px-3 py-3 space-y-2 bg-neutral-50"></div>
      <div class="px-3 pb-3">
        <div class="flex flex-wrap gap-2 text-xs mb-2">
          <button class="px-2 py-1 rounded-full border bg-white quick">ุงูุดุญู</button>
          <button class="px-2 py-1 rounded-full border bg-white quick">ุงูุงุณุชุฑุฌุงุน</button>
          <button class="px-2 py-1 rounded-full border bg-white quick">ุงูุญุฏ ุงูุฃุฏูู</button>
          <button class="px-2 py-1 rounded-full border bg-white quick">ุทุฑู ุงูุฏูุน</button>
        </div>
        <div class="flex items-center gap-2">
          <input id="chatInput" class="flex-1 rounded-xl border px-3 py-2" placeholder="ุงูุชุจ ุณุคุงูู..." />
          <button id="chatSend" class="rounded-xl bg-rose-600 text-white px-4 py-2">ุฅุฑุณุงู</button>
        </div>
        <a id="waBtn" class="block text-center text-sm mt-2 rounded-xl border py-2 hover:bg-gray-50" target="_blank" rel="noopener">ุชูุงุตู ูุงุชุณุงุจ ุงูุขู</a>
      </div>
    </div>
  </div>

  <!-- ุณูุฉ ุงููุดุชุฑูุงุช -->
  <div id="cartModal" class="fixed inset-0 hidden z-50 modal-bg">
    <div id="cartCloseBg" class="absolute inset-0"></div>
    <div class="absolute right-0 top-0 bottom-0 w-full md:w-[760px] bg-white rounded-none md:rounded-l-3xl shadow-2xl overflow-y-auto">
      <div class="sticky top-0 glass border-b p-4 flex items-center justify-between">
        <div class="font-bold">ุณูุฉ ุงููุดุชุฑูุงุช</div>
        <div class="flex items-center gap-2">
          <button id="cartClear" class="rounded-xl border px-3 py-2 text-sm hover:bg-gray-50">ุชูุฑูุบ ุงูุณูุฉ</button>
          <button id="closeCart" class="rounded-xl bg-rose-600 text-white px-4 py-2 text-sm">ุฅุบูุงู</button>
        </div>
      </div>

      <div class="p-4 grid md:grid-cols-2 gap-4">
        <div>
          <div id="cartItems" class="space-y-3"></div>
        </div>

        <div class="space-y-3">
          <div class="rounded-2xl border bg-white p-4">
            <div class="font-semibold mb-2">ุงูุจูุงูุงุช</div>
            <div class="space-y-2">
              <input id="cusName"  class="w-full rounded-xl border px-3 py-2" placeholder="ุงูุงุณู"/>
              <input id="cusPhone" class="w-full rounded-xl border px-3 py-2" placeholder="ุฑูู ุงููุงุชู"/>
              <input id="cusCity"  class="w-full rounded-xl border px-3 py-2" placeholder="ุงููุญุงูุธุฉ/ุงููุฏููุฉ"/>
            </div>
          </div>

          <div class="rounded-2xl border bg-white p-4">
            <div class="flex items-center justify-between">
              <div>ุงูุฅุฌูุงูู ุงููุฑุนู</div>
              <div id="cartSubtotal" class="font-bold">0 ุฌ.ู</div>
            </div>
            <div class="flex items-center justify-between text-sm text-gray-600 mt-1">
              <div>ุงูุดุญู</div>
              <div id="cartShipping">ููุญุณุจ ุญุณุจ ุงููุญุงูุธุฉ</div>
            </div>
            <hr class="my-2">
            <div class="flex items-center justify-between text-lg">
              <div class="font-bold">ุงูุฅุฌูุงูู</div>
              <div id="cartTotal" class="font-extrabold text-rose-600">0 ุฌ.ู</div>
            </div>
            <p class="text-xs text-gray-500 mt-2">* ุงููููุงุช ุชุชุญุฑู ุจูุถุงุนูุงุช ุงูุญุฏ ุงูุฃุฏูู ููู ุตูู.</p>
            <div class="mt-3 grid grid-cols-1 gap-2">
              <button id="cartCheckoutWA" class="rounded-xl bg-rose-600 text-white px-4 py-2 font-semibold hover:bg-rose-700">ุฅููุงู ุงูุทูุจ ุนูู ูุงุชุณุงุจ</button>
              <button id="cartCheckoutEmail" class="rounded-xl border px-4 py-2 hover:bg-gray-50">ุทูุจ ุนุจุฑ ุงูุจุฑูุฏ</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

<script>
/* =====================[ ุฅุนุฏุงุฏุงุช ุนุงูุฉ + ุฏุนู ]===================== */
const WHATSAPP_PHONE = '201112345678';   // ุนุฏูู ุฑูู ุงููุงุชุณุงุจ ููุง ุจุตูุบุฉ ุฏูููุฉ
const SUPPORT_EMAIL  = 'sales@example.com'; // ุนุฏูู ุงูุฅูููู ูู ุนุงูุฒ
document.getElementById('waBtn').href = 'https://wa.me/' + WHATSAPP_PHONE;

/* =====================[ Admin PIN + Routing ]===================== */
const ADMIN_PIN = '1234';
let isAdmin = sessionStorage.getItem('zl_admin') === '1';

function showHomeSections(show) {
  document.getElementById('heroSection').classList.toggle('hidden', !show);
  document.getElementById('benefitsSection').classList.toggle('hidden', !show);
  document.getElementById('categoriesSection').classList.toggle('hidden', !show);
}

function ensureAdmin() {
  const pin = prompt('ุฃุฏุฎู ุฑูู PIN ุงูุฅุฏุงุฑุฉ:');
  if (pin === ADMIN_PIN) {
    isAdmin = true;
    sessionStorage.setItem('zl_admin', '1');
    const btn = document.getElementById('openAdmin');
    if (btn) btn.classList.remove('hidden');
    openAdminPanel();
  } else {
    alert('PIN ุบูุฑ ุตุญูุญ');
    location.hash = '#/';
  }
}

/* =====================[ ุจูุงูุงุช ุงูุชุฑุงุถูุฉ + LocalStorage ]===================== */
const LS_KEYS = { brand:'zl_brand', hero:'zl_hero', cats:'zl_cats', prods:'zl_prods', cart:'zl_cart', customer:'zl_customer' };
const DEFAULT_BRAND = 'ZADORA';
const DEFAULT_HERO = {
  title: 'ุฌูููุฉ ุฑุงููุฉ ุจููุณุฉ ZADORA',
  subtitle: 'ุงุทูุจ ุจุงููุฑุชููุฉ ุฃู ุญุฏ ุฃุฏูู 12 ูุทุนุฉ โ ุฃุณุนุงุฑ ูุงุถุญุฉุ ุฎุงูุงุช ูุถูููุฉุ ูุตูุฑ ุฌุงูุฒุฉ ูุฒูุงุฏุฉ ูุจูุนุงุชู ููุฑูุง.',
  image: 'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?q=80&w=1600&auto=format&fit=crop'
};
const DEFAULT_CATS = [
  { name:'ูุทุจุฎ', image:'https://images.unsplash.com/photo-1542909168-82c3e7fdca5c?q=80&w=1200&auto=format&fit=crop' },
  { name:'ุชุฎุฒูู ูุชูุธูู', image:'https://images.unsplash.com/photo-1582582429416-2f3a27730854?q=80&w=1200&auto=format&fit=crop' },
  { name:'ูุดุฑูุจุงุช ููุฌุงุช', image:'https://images.unsplash.com/photo-1511920170033-f8396924c348?q=80&w=1200&auto=format&fit=crop' },
  { name:'ุฏูููุฑ', image:'https://images.unsplash.com/photo-1501045661006-fcebe0257c3f?q=80&w=1200&auto=format&fit=crop' },
  { name:'ููุณูุฌุงุช', image:'https://images.unsplash.com/photo-1497032628192-86f99bcd76bc?q=80&w=1200&auto=format&fit=crop' },
  { name:'ุจูุงุณุชูู ูุงุณุชุงูุณ', image:'https://images.unsplash.com/photo-1542444592-1e6c9f952a25?q=80&w=1200&auto=format&fit=crop' },
];
const DEFAULT_PRODS = [
  { id:1, title:'ุทูู ุชูุงุฌุฉ ุจูุฑูุณ โ 3 ูุทุน', price:420, oldPrice:480, rating:4.7, reviews:126, image:'https://images.unsplash.com/photo-1601050690290-27f9864c06c0?q=80&w=1200&auto=format&fit=crop', badge:'ุงูุฃูุซุฑ ุทูุจูุง', minQty:12, category:'ูุทุจุฎ' },
  { id:2, title:'ูุงูุด ุจููุณ ุญุฑุงุฑู', price:165, oldPrice:199, rating:4.6, reviews:98, image:'https://images.unsplash.com/photo-1517673132405-a56a62b18caf?q=80&w=1200&auto=format&fit=crop', badge:'ุนุฑุถ ุฎุงุต', minQty:24, category:'ุชุฎุฒูู ูุชูุธูู' },
  { id:3, title:'ูุฌ ุณูุฑุงููู ูุทูู', price:85, oldPrice:110, rating:4.4, reviews:210, image:'https://images.unsplash.com/photo-1523365280197-f1783db9fe62?q=80&w=1200&auto=format&fit=crop', badge:'ุฌุฏูุฏ', minQty:24, category:'ูุดุฑูุจุงุช ููุฌุงุช' },
  { id:4, title:'ุนูุจ ุชุฎุฒูู ูุญููุฉ โ 6 ูุทุน', price:350, oldPrice:399, rating:4.8, reviews:73, image:'https://images.unsplash.com/photo-1592840496694-26d035b08cc6?q=80&w=1200&auto=format&fit=crop', badge:'ุงูุฃูุถู ูููุฉ', minQty:6, category:'ุชุฎุฒูู ูุชูุธูู' },
];
function lsGet(k, fb){ try{ const v = localStorage.getItem(k); return v? JSON.parse(v): fb; }catch{ return fb; } }
function lsSet(k, v){ try{ localStorage.setItem(k, JSON.stringify(v)); }catch{} }

let brand = lsGet(LS_KEYS.brand, DEFAULT_BRAND);
let hero = lsGet(LS_KEYS.hero, DEFAULT_HERO);
let categories = lsGet(LS_KEYS.cats, DEFAULT_CATS);
let products = lsGet(LS_KEYS.prods, DEFAULT_PRODS);
let cart = lsGet(LS_KEYS.cart, []);               // [{id, qty}]
let customer = lsGet(LS_KEYS.customer, {name:'', phone:'', city:''});

/* =====================[ ุจุญุซ + ุชุฑุชูุจ ]===================== */
let currentSort = 'default';
let currentQuery = '';

function normalize(s){ return String(s||'').toLowerCase(); }

function sortList(list, key) {
  const arr = [...list];
  if (key === 'priceLow')  arr.sort((a,b)=> (a.price||0) - (b.price||0));
  if (key === 'priceHigh') arr.sort((a,b)=> (b.price||0) - (a.price||0));
  if (key === 'ratingHigh') arr.sort((a,b)=> (b.rating||0) - (a.rating||0));
  return arr;
}
function applyFilters(list){
  let out = list;
  const q = normalize(currentQuery.trim());
  if(q){
    out = out.filter(p => normalize(p.title).includes(q) || normalize(p.category).includes(q));
  }
  return sortList(out, currentSort);
}

/* =====================[ Cart Logic ]===================== */
function getProd(id){ return products.find(p=> String(p.id)===String(id)); }
function saveCart(){ lsSet(LS_KEYS.cart, cart); renderCartIcon(); }
function cartCount(){ return cart.reduce((s,i)=> s + (Number(i.qty)||0), 0); }
function cartSubtotal(){ return cart.reduce((s,i)=> { const p=getProd(i.id); return s + (p?(p.price||0)*(i.qty||0):0); }, 0); }

function renderCartIcon(){
  const c = cartCount();
  const b = document.getElementById('cartCount');
  b.textContent = c;
  b.classList.toggle('hidden', c===0);
}

function addToCart(id){
  const p = getProd(id); if(!p) return;
  const step = Number(p.minQty)||1;
  const item = cart.find(x=> String(x.id)===String(id));
  if(item){ item.qty += step; } else { cart.push({id, qty: step}); }
  saveCart();
  // ุงูุชุญ ุงูุณูุฉ ุจุนุฏ ุงูุฅุถุงูุฉ
  openCart();
}

function changeQty(id, dir){ // dir = +1 / -1 (ุจูุถุงุนูุงุช ุงูุญุฏ ุงูุฃุฏูู)
  const p = getProd(id); if(!p) return;
  const step = Number(p.minQty)||1;
  const it = cart.find(x=> String(x.id)===String(id)); if(!it) return;
  it.qty = Math.max(step, (it.qty||0) + dir*step);
  saveCart(); renderCartPanel();
}
function removeItem(id){
  cart = cart.filter(x=> String(x.id)!==String(id));
  saveCart(); renderCartPanel();
}
function clearCart(){
  cart = []; saveCart(); renderCartPanel();
}

function renderCartPanel(){
  const wrap = document.getElementById('cartItems');
  if(!wrap) return;
  if(cart.length===0){
    wrap.innerHTML = `<div class="rounded-2xl border bg-white p-6">ุณูุชู ูุงุฑุบุฉ.</div>`;
  }else{
    wrap.innerHTML = cart.map(it=>{
      const p = getProd(it.id); if(!p) return '';
      const line = (p.price||0)*(it.qty||0);
      const step = Number(p.minQty)||1;
      return `
      <div class="rounded-2xl border bg-white p-3">
        <div class="flex gap-3">
          <img src="${p.image}" class="w-20 h-20 object-cover rounded-xl border" />
          <div class="flex-1">
            <div class="font-semibold">${p.title}</div>
            <div class="text-sm text-gray-500">ุงููุณู: ${p.category||'-'} โข ุญุฏ ุฃุฏูู: ${step}</div>
            <div class="mt-2 flex items-center gap-2">
              <button class="px-3 py-1 rounded-xl border qty-dec" data-id="${p.id}">โ</button>
              <div class="min-w-[56px] text-center font-semibold">${it.qty}</div>
              <button class="px-3 py-1 rounded-xl border qty-inc" data-id="${p.id}">+</button>
              <button class="ml-auto px-3 py-1 rounded-xl border text-sm hover:bg-gray-50 item-remove" data-id="${p.id}">ุญุฐู</button>
            </div>
          </div>
        </div>
        <div class="mt-2 text-right"><span class="font-bold">${line}</span> ุฌ.ู</div>
      </div>`;
    }).join('');
  }
  document.getElementById('cartSubtotal').textContent = cartSubtotal() + ' ุฌ.ู';
  document.getElementById('cartTotal').textContent = cartSubtotal() + ' ุฌ.ู';

  // ุญููู ุงูุนููู
  document.getElementById('cusName').value = customer.name||'';
  document.getElementById('cusPhone').value = customer.phone||'';
  document.getElementById('cusCity').value = customer.city||'';

  // ุชูุนูู/ุชุนุทูู ุงูุฃุฒุฑุงุฑ ุญุณุจ ุงูุณูุฉ
  document.getElementById('cartCheckoutWA').disabled = cart.length===0;
  document.getElementById('cartCheckoutEmail').disabled = cart.length===0;
  document.getElementById('cartClear').disabled = cart.length===0;
}

function openCart(){ document.getElementById('cartModal').classList.remove('hidden'); renderCartPanel(); }
function closeCart(){ document.getElementById('cartModal').classList.add('hidden'); }

/* =====================[ Render ]===================== */
function renderHero(){
  const el = document.getElementById('heroSection');
  el.innerHTML = `
    <div class="grid md:grid-cols-3 gap-4">
      <div class="md:col-span-2 relative overflow-hidden rounded-2xl bg-neutral-900 text-white min-h-[220px]">
        <img src="${hero.image}" class="absolute inset-0 w-full h-full object-cover opacity-70">
        <div class="relative p-8 md:p-12">
          <h2 class="text-2xl md:text-4xl font-extrabold leading-tight">${hero.title}</h2>
          <p class="mt-2 md:mt-4 text-sm md:text-base text-white/90">${hero.subtitle}</p>
          <button class="mt-5 inline-flex items-center gap-1 rounded-xl bg-white text-neutral-900 px-4 py-2 text-sm font-semibold hover:bg-white/90">ุชุณูู ุงูุขู</button>
        </div>
      </div>
      <div class="relative overflow-hidden rounded-2xl bg-rose-600 text-white min-h-[220px]">
        <img src="https://images.unsplash.com/photo-1549778399-f94fd24d4697?q=80&w=1600&auto=format&fit=crop" class="absolute inset-0 w-full h-full object-cover opacity-40">
        <div class="relative p-8">
          <h3 class="text-xl md:text-2xl font-extrabold">ZADORA Box</h3>
          <p class="mt-2 text-sm text-white/90">ุจุงูุฏฺ ูุชููุนุฉ ุฌุงูุฒุฉ ููุนุฑุถ ูู ุงููุญู</p>
          <button class="mt-4 inline-flex items-center gap-1 rounded-xl bg-white text-neutral-900 px-4 py-2 text-sm font-semibold hover:bg-white/90">ุดูู ุงูุจููุณ</button>
        </div>
      </div>
    </div>`;
}
function renderBenefits(){
  const data = [
    { title:'ุดุญู ุณุฑูุน', desc:'ุชูุตูู ููู ุงููุญุงูุธุงุช ุฎูุงู 24-72 ุณุงุนุฉ' },
    { title:'ุถูุงู ูุงุณุชุจุฏุงู', desc:'ุงุณุชุจุฏุงู ุงููุทุน ุงูููุณูุฑุฉ ุฎูุงู 7 ุฃูุงู' },
    { title:'ุฌููุฉ ุจุงููุฑุชููุฉ', desc:'ุญุฏ ุฃุฏูู 12 ูุทุนุฉ ููุท' },
  ];
  const el = document.getElementById('benefitsSection');
  el.innerHTML = `<div class="grid sm:grid-cols-3 gap-3">
      ${data.map(b=>`<div class="flex items-center gap-4 rounded-2xl border p-4 bg-white">
        <div class="rounded-2xl p-3 bg-rose-50">โฆ</div>
        <div class="text-right">
          <div class="font-semibold">${b.title}</div>
          <div class="text-sm text-gray-600">${b.desc}</div>
        </div>
      </div>`).join('')}
    </div>`;
}
function renderCategories(){
  const el = document.getElementById('categoriesSection');
  el.innerHTML = `
    <div class="flex items-center justify-between mb-3">
      <h3 class="text-lg md:text-xl font-bold">ุชุณูู ุจุงูุฃูุณุงู</h3>
      <a href="#/" class="text-rose-600 hover:underline cursor-pointer">ุนุฑุถ ุงููู</a>
    </div>
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-3">
      ${categories.map(cat => `
        <a href="#/c/${encodeURIComponent(cat.name)}" class="group relative block overflow-hidden rounded-2xl border bg-white">
          <img src="${cat.image}" alt="${cat.name}" class="h-28 w-full object-cover transition-transform duration-300 group-hover:scale-105" />
          <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent"></div>
          <div class="absolute bottom-2 right-2 text-white text-sm font-semibold">${cat.name}</div>
        </a>`).join('')}
    </div>`;
}
function renderProducts(){
  const el = document.getElementById('productsSection');
  const list = applyFilters(products);

  el.innerHTML = `
    <div class="flex items-center justify-between mb-3">
      <h3 class="text-lg md:text-xl font-bold">${currentQuery ? `ูุชุงุฆุฌ ุนู: "${currentQuery}"` : 'ุงูุฃูุซุฑ ูุจูุนูุง'}</h3>
      <div class="flex items-center gap-2 text-sm">
        <span>ุชุฑุชูุจ:</span>
        <select id="homeSort" class="border rounded-xl px-2 py-1">
          <option value="default">ุจุฏูู ุชุฑุชูุจ</option>
          <option value="priceLow">ุงูุณุนุฑ: ูู ุงูุฃูู ููุฃุนูู</option>
          <option value="priceHigh">ุงูุณุนุฑ: ูู ุงูุฃุนูู ููุฃูู</option>
          <option value="ratingHigh">ุงูุฃุนูู ุชูููููุง</option>
        </select>
      </div>
    </div>
    <div class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-4">
      ${list.length ? list.map(p => `
        <div class="group rounded-2xl border bg-white overflow-hidden hover:shadow-md transition-shadow">
          <div class="relative">
            <img src="${p.image}" class="w-full h-56 object-cover"/>
            ${p.badge ? `<span class="absolute top-3 right-3 bg-rose-600 text-white text-xs px-2 py-1 rounded-full">${p.badge}</span>` : ''}
            <button class="absolute bottom-3 left-3 bg-white/90 backdrop-blur text-sm rounded-xl px-3 py-1 hover:bg-white">
              ุญุฏ ุฃุฏูู: ${p.minQty}
            </button>
          </div>
          <div class="p-3" dir="rtl">
            <h4 class="font-semibold min-h-[44px]">${p.title}</h4>
            <div class="flex items-baseline gap-2 mt-2">
              <span class="text-lg font-extrabold">${p.price} ุฌ.ู</span>
              <span class="text-sm line-through text-gray-400">${p.oldPrice} ุฌ.ู</span>
            </div>
            <div class="mt-3 flex items-center gap-2">
              <button class="flex-1 rounded-xl bg-rose-600 text-white py-2 font-semibold hover:bg-rose-700 btn-add" data-id="${p.id}">ุฃุถู ููุณูุฉ</button>
              <button class="rounded-xl border px-3 py-2 hover:bg-gray-50" title="ุฅุถุงูุฉ ููููุถูุฉ">โก</button>
            </div>
          </div>
        </div>`).join('') : `<div class="rounded-2xl border bg-white p-6">ูุง ุชูุฌุฏ ูุชุงุฆุฌ ูุทุงุจูุฉ.</div>`}
    </div>`;

  const sel = document.getElementById('homeSort');
  sel.value = currentSort;
  sel.onchange = (e) => { currentSort = e.target.value; renderProducts(); };
}
function refreshAll(){
  document.getElementById('brandName').textContent = brand;
  document.getElementById('brandNameFooter').textContent = brand;
  document.getElementById('brandNameCopy').textContent = brand;
  document.getElementById('year').textContent = new Date().getFullYear();
  document.getElementById('brandInChat').textContent = brand;
  renderHero(); renderBenefits(); renderCategories(); renderProducts();
  renderCartIcon();
}

/* =====================[ ููุญุฉ ุงูุชุญูู ]===================== */
const modal = document.getElementById('adminModal');
const openAdminBtn = document.getElementById('openAdmin');

function openAdminPanel(){
  modal.classList.remove('hidden');
  document.getElementById('brandInput').value = brand;
  document.getElementById('heroTitleInput').value = hero.title;
  document.getElementById('heroSubInput').value = hero.subtitle;
  document.getElementById('heroImgPreview').src = hero.image;
  switchTab('products'); fillCatSelect(); listCats(); listProds();
}
if (!isAdmin) openAdminBtn.classList.add('hidden');
openAdminBtn.onclick = () => { if (!isAdmin) { location.hash = '#/admin'; ensureAdmin(); return; } openAdminPanel(); };
document.getElementById('closeAdmin').onclick = ()=> modal.classList.add('hidden');
document.getElementById('adminCloseBg').onclick = ()=> modal.classList.add('hidden');

document.querySelectorAll('.tab-btn').forEach(btn=> btn.addEventListener('click', ()=> switchTab(btn.dataset.tab)));
function switchTab(name){
  document.querySelectorAll('.tab-pane').forEach(p=>p.classList.add('hidden'));
  document.getElementById('tab-'+name).classList.remove('hidden');
  document.querySelectorAll('.tab-btn').forEach(b=>{
    const on = b.dataset.tab===name;
    b.classList.toggle('bg-rose-600', on);
    b.classList.toggle('text-white', on);
    b.classList.toggle('border-rose-600', on);
  });
}

/* ุฅุนุฏุงุฏุงุช ุนุงูุฉ */
document.getElementById('brandInput').addEventListener('input', e=>{ brand = e.target.value || 'ZADORA'; lsSet(LS_KEYS.brand, brand); refreshAll(); });
document.getElementById('heroTitleInput').addEventListener('input', e=>{ hero.title = e.target.value; lsSet(LS_KEYS.hero, hero); refreshAll(); });
document.getElementById('heroSubInput').addEventListener('input', e=>{ hero.subtitle = e.target.value; lsSet(LS_KEYS.hero, hero); refreshAll(); });
document.getElementById('heroImgInput').addEventListener('change', e=>{
  const file = e.target.files[0]; if(!file) return;
  const r = new FileReader(); r.onload = ev =>{ hero.image = String(ev.target.result); lsSet(LS_KEYS.hero, hero); refreshAll(); };
  r.readAsDataURL(file);
});

/* ุฃูุณุงู */
let editingCat = null;
function listCats(){
  const wrap = document.getElementById('catsList');
  wrap.innerHTML = categories.map(c=>`
    <div class="rounded-2xl border overflow-hidden bg-white">
      <div class="aspect-[4/3] w-full overflow-hidden">
        <img src="${c.image}" class="w-full h-full object-cover" />
      </div>
      <div class="p-3 flex items-center justify-between">
        <div class="font-semibold">${c.name}</div>
        <div class="flex gap-2">
          <button class="rounded-xl border px-3 py-1 hover:bg-gray-50" onclick='editCat("${c.name}")'>ุชุนุฏูู</button>
          <button class="rounded-xl border px-3 py-1 hover:bg-gray-50" onclick='deleteCat("${c.name}")'>ุญุฐู</button>
        </div>
      </div>
    </div>`).join('');
}
function editCat(name){
  const c = categories.find(x=>x.name===name); if(!c) return;
  editingCat = name;
  document.getElementById('catName').value = c.name;
  document.getElementById('catImgPreview').src = c.image;
}
function deleteCat(name){
  if(!confirm('ูุณุญ ุงููุณูุ')) return;
  categories = categories.filter(c=>c.name!==name);
  lsSet(LS_KEYS.cats, categories); fillCatSelect(); listCats(); renderCategories(); renderRoute();
}
document.getElementById('catImgInput').addEventListener('change', e=>{
  const f = e.target.files[0]; if(!f) return;
  const r = new FileReader(); r.onload = ev => document.getElementById('catImgPreview').src = String(ev.target.result);
  r.readAsDataURL(f);
});
document.getElementById('saveCat').onclick = ()=>{
  const name = document.getElementById('catName').value.trim();
  const img = document.getElementById('catImgPreview').src;
  if(!name) return alert('ุงูุชุจ ุงุณู ุงููุณู');
  if(editingCat){
    categories = categories.map(c=> c.name===editingCat? {name, image:img}: c);
  }else{
    if(categories.some(c=>c.name===name)) return alert('ุงููุณู ููุฌูุฏ ุจุงููุนู');
    categories.push({name, image:img});
  }
  editingCat=null; document.getElementById('catName').value=''; document.getElementById('catImgPreview').src='';
  lsSet(LS_KEYS.cats, categories); fillCatSelect(); listCats(); renderCategories(); renderRoute();
};
document.getElementById('resetCat').onclick = ()=>{ editingCat=null; document.getElementById('catName').value=''; document.getElementById('catImgPreview').src=''; };
function fillCatSelect(){
  const sel = document.getElementById('pCategory');
  sel.innerHTML = '<option value="">ุงุฎุชุฑ ุงููุณู</option>' + categories.map(c=> `<option>${c.name}</option>`).join('');
}

/* ููุชุฌุงุช */
let editingProd = null;
function listProds(){
  const wrap = document.getElementById('productsList');
  wrap.innerHTML = products.map(p=>`
    <div class="rounded-2xl border bg-white overflow-hidden">
      <div class="aspect-[4/3] w-full overflow-hidden">
        <img src="${p.image}" class="w-full h-full object-cover"/>
      </div>
      <div class="p-3">
        <div class="font-semibold">${p.title}</div>
        <div class="text-sm text-gray-500 mt-1">${p.category||''}</div>
        <div class="flex items-baseline gap-2 mt-2">
          <span class="text-lg font-extrabold">${p.price} ุฌ.ู</span>
          <span class="text-sm line-through text-gray-400">${p.oldPrice} ุฌ.ู</span>
        </div>
        <div class="mt-3 flex items-center gap-2">
          <button class="rounded-xl border px-3 py-1 hover:bg-gray-50" onclick='editProd(${JSON.stringify(p.id)})'>ุชุนุฏูู</button>
          <button class="rounded-xl border px-3 py-1 hover:bg-gray-50" onclick='deleteProd(${JSON.stringify(p.id)})'>ุญุฐู</button>
        </div>
      </div>
    </div>`).join('');
}
function editProd(id){
  const p = products.find(x=>String(x.id)===String(id)); if(!p) return;
  editingProd = id;
  pTitle.value = p.title; pPrice.value=p.price; pOld.value=p.oldPrice;
  pRating.value=p.rating; pReviews.value=p.reviews; pMinQty.value=p.minQty;
  pBadge.value=p.badge||''; pCategory.value=p.category||''; pImgPreview.src=p.image;
}
function deleteProd(id){
  if(!confirm('ูุณุญ ุงูููุชุฌุ')) return;
  products = products.filter(p=>String(p.id)!==String(id));
  lsSet(LS_KEYS.prods, products); listProds(); renderProducts(); renderRoute();
}
pImgInput.addEventListener('change', e=>{
  const f = e.target.files[0]; if(!f) return;
  const r = new FileReader(); r.onload = ev => pImgPreview.src = String(ev.target.result);
  r.readAsDataURL(f);
});
saveProduct.onclick = ()=>{
  const form = {
    title: pTitle.value.trim(),
    price: Number(pPrice.value||0),
    oldPrice: Number(pOld.value||0),
    rating: Number(pRating.value||0),
    reviews: Number(pReviews.value||0),
    minQty: Number(pMinQty.value||0),
    badge: pBadge.value.trim(),
    category: pCategory.value,
    image: pImgPreview.src || ''
  };
  if(!form.title) return alert('ุงูุชุจ ุงุณู ุงูููุชุฌ');
  if(editingProd){
    products = products.map(p=> String(p.id)===String(editingProd)? {...form, id: editingProd}: p);
  }else{
    const nextId = products.length? Math.max(...products.map(p=>Number(p.id)||0))+1: 1;
    products.push({...form, id: nextId});
  }
  editingProd=null;
  ['pTitle','pPrice','pOld','pRating','pReviews','pMinQty','pBadge'].forEach(id=> document.getElementById(id).value='');
  pCategory.value=''; pImgPreview.src='';
  lsSet(LS_KEYS.prods, products); listProds(); renderProducts(); renderRoute();
};
resetProduct.onclick = ()=>{
  editingProd=null; ['pTitle','pPrice','pOld','pRating','pReviews','pMinQty','pBadge'].forEach(id=> document.getElementById(id).value='');
  pCategory.value=''; pImgPreview.src='';
};

/* ุชุตุฏูุฑ/ุงุณุชูุฑุงุฏ/ุฅุฑุฌุงุน */
document.getElementById('exportJson').onclick = ()=>{
  const data = { brand, hero, categories, products };
  const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'zadora_store_export.json'; a.click(); URL.revokeObjectURL(url);
};
document.getElementById('importJson').addEventListener('change', e=>{
  const f = e.target.files[0]; if(!f) return;
  const r = new FileReader(); r.onload = ev => {
    try{
      const data = JSON.parse(String(ev.target.result||'{}'));
      if(data.brand) brand = data.brand;
      if(data.hero) hero = data.hero;
      if(Array.isArray(data.categories)) categories = data.categories;
      if(Array.isArray(data.products)) products = data.products;
      lsSet(LS_KEYS.brand, brand); lsSet(LS_KEYS.hero, hero); lsSet(LS_KEYS.cats, categories); lsSet(LS_KEYS.prods, products);
      refreshAll(); fillCatSelect(); listCats(); listProds(); renderRoute();
    }catch{ alert('ููู ุบูุฑ ุตุงูุญ'); }
  }; r.readAsText(f);
});
document.getElementById('resetAll').onclick = ()=>{
  if(!confirm('ุฅุฑุฌุงุน ูู ุดูุก ูููุถุน ุงูุงูุชุฑุงุถูุ')) return;
  brand = DEFAULT_BRAND; hero = DEFAULT_HERO; categories = DEFAULT_CATS.slice(); products = DEFAULT_PRODS.slice();
  lsSet(LS_KEYS.brand, brand); lsSet(LS_KEYS.hero, hero); lsSet(LS_KEYS.cats, categories); lsSet(LS_KEYS.prods, products);
  refreshAll(); fillCatSelect(); listCats(); listProds(); renderRoute();
};

/* =====================[ Router ุจุงููุงุด ]===================== */
function renderCategoryView(cat) {
  showHomeSections(false);
  const all = products.filter(p => (p.category || '') === cat);
  const list = applyFilters(all);
  const el = document.getElementById('productsSection');

  el.innerHTML = `
    <div class="flex items-center justify-between mb-3">
      <div class="text-lg md:text-xl font-bold">ูุณู: ${cat}</div>
      <div class="flex items-center gap-3">
        <select id="catSort" class="border rounded-xl px-2 py-1">
          <option value="default">ุจุฏูู ุชุฑุชูุจ</option>
          <option value="priceLow">ุงูุณุนุฑ: ูู ุงูุฃูู ููุฃุนูู</option>
          <option value="priceHigh">ุงูุณุนุฑ: ูู ุงูุฃุนูู ููุฃูู</option>
          <option value="ratingHigh">ุงูุฃุนูู ุชูููููุง</option>
        </select>
        <a href="#/" class="text-rose-600 hover:underline">ุนูุฏุฉ ูููู</a>
      </div>
    </div>
    <div class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-4">
      ${
        list.length
        ? list.map(p => `
          <div class="group rounded-2xl border bg-white overflow-hidden hover:shadow-md transition-shadow">
            <div class="relative">
              <img src="${p.image}" class="w-full h-56 object-cover"/>
              ${p.badge ? `<span class="absolute top-3 right-3 bg-rose-600 text-white text-xs px-2 py-1 rounded-full">${p.badge}</span>` : ''}
              <button class="absolute bottom-3 left-3 bg-white/90 backdrop-blur text-sm rounded-xl px-3 py-1 hover:bg-white">ุญุฏ ุฃุฏูู: ${p.minQty}</button>
            </div>
            <div class="p-3" dir="rtl">
              <h4 class="font-semibold min-h-[44px]">${p.title}</h4>
              <div class="flex items-baseline gap-2 mt-2">
                <span class="text-lg font-extrabold">${p.price} ุฌ.ู</span>
                <span class="text-sm line-through text-gray-400">${p.oldPrice} ุฌ.ู</span>
              </div>
              <div class="mt-3 flex items-center gap-2">
                <button class="flex-1 rounded-xl bg-rose-600 text-white py-2 font-semibold hover:bg-rose-700 btn-add" data-id="${p.id}">ุฃุถู ููุณูุฉ</button>
                <button class="rounded-xl border px-3 py-2 hover:bg-gray-50">โก</button>
              </div>
            </div>
          </div>`).join('')
        : `<div class="rounded-2xl border bg-white p-6">ูุง ุชูุฌุฏ ููุชุฌุงุช ููุฐุง ุงููุณู ุญุชู ุงูุขู.</div>`
      }
    </div>`;

  const sel = document.getElementById('catSort');
  sel.value = currentSort;
  sel.onchange = (e)=> { currentSort = e.target.value; renderCategoryView(cat); };
}
function renderHome() {
  showHomeSections(true);
  renderProducts();
}
function renderRoute() {
  const h = decodeURIComponent(location.hash || '#/');
  if (h.startsWith('#/c/')) {
    const cat = h.slice(4);
    renderCategoryView(cat);
  } else {
    renderHome();
  }
}

/* =====================[ ุงูุจุญุซ ุงููุจุงุดุฑ ]===================== */
function attachSearch(){
  const boxes = [document.getElementById('search'), document.getElementById('search2')].filter(Boolean);
  boxes.forEach(inp=>{
    inp.value = currentQuery;
    inp.oninput = (e)=>{ currentQuery = e.target.value; renderRoute(); };
    inp.onkeydown = (e)=>{ if(e.key==='Escape'){ e.target.value=''; currentQuery=''; renderRoute(); } };
  });
}

/* =====================[ ููุฏุฌุช ุงูุดุงุช: ุจูุช ุจุณูุท ]===================== */
const chatPanel = document.getElementById('chatPanel');
const chatToggle = document.getElementById('chatToggle');
const chatClose  = document.getElementById('chatClose');
const chatBody   = document.getElementById('chatBody');
const chatInput  = document.getElementById('chatInput');
const chatSend   = document.getElementById('chatSend');

chatToggle.onclick = ()=> chatPanel.classList.toggle('hidden');
chatClose.onclick  = ()=> chatPanel.classList.add('hidden');
document.querySelectorAll('.quick').forEach(b=> b.onclick = ()=> { sendMsg(b.textContent); });

let chatHistory = lsGet('zl_chat_history', []);
function renderChat(){
  chatBody.innerHTML = chatHistory.map(m => `
    <div class="flex ${m.role==='user'?'justify-start':'justify-end'}">
      <div class="max-w-[80%] rounded-2xl px-3 py-2 text-sm ${m.role==='user'?'bg-white border':'bg-rose-600 text-white'}">
        ${m.text}
      </div>
    </div>`).join('');
  chatBody.scrollTop = chatBody.scrollHeight;
}
function push(role,text){
  chatHistory.push({role,text,ts:Date.now()});
  lsSet('zl_chat_history', chatHistory);
  renderChat();
}
function replyBot(q){
  const t = q.trim();
  const s = (w)=> t.includes(w);
  let a = '';

  if (s('ุดุญู')||s('ุชูุตูู')||s('ุงููุญุงูุธุฉ')||s('ุงููุญุงูุธุงุช')) {
    a = 'ุงูุดุญู ุฎูุงู 24-72 ุณุงุนุฉ ููู ุงููุญุงูุธุงุช. ุงูุณุนุฑ ุญุณุจ ุงููุฒู ูุงููุญุงูุธุฉ. ููุฌูุน ุงูุฃูุฑุฏุฑ ููุชูุงุตู ููุชุฃููุฏ.';
  } else if (s('ุงุณุชุฑุฌุงุน')||s('ุงุฑุฌุงุน')||s('ุงุณุชุจุฏุงู')) {
    a = 'ุงูุงุณุชุจุฏุงู ุฎูุงู 7 ุฃูุงู ูููุทุน ุงููุนููุจุฉ/ุงูููุณูุฑุฉ โ ุจูุจุฏู ููุฑูุง ุฃู ูุฑุฌุน ูููุชูุง.';
  } else if (s('ุญุฏ ุฃุฏูู')||s('ุญุฏ ุงุฏูู')||s('ุงูู ูููุฉ')||s('ุฃูู ูููุฉ')) {
    a = 'ุงูุญุฏ ุงูุฃุฏูู ููุทูุจ: 12 ูุทุนุฉ ููู ุตูู (ุฃู ูุฑุชููุฉ ูุงููุฉ ูุจุนุถ ุงูููุชุฌุงุช).';
  } else if (s('ุฏูุน')||s('ุชุญููู')||s('ููุฒุง')||s('ูุงุด')) {
    a = 'ุทุฑู ุงูุฏูุน: ูุงุด ุนูุฏ ุงูุงุณุชูุงู (ุงููุงูุฑุฉ/ุงูุฌูุฒุฉ)ุ ุชุญููู ุจูููุ ุฃู ููุฏุงููู ูุงุด.';
  } else if (s('ุณุนุฑ')||s('ุณุนุฑู')||s('ุซูู')) {
    a = 'ุงูุฃุณุนุงุฑ ุจุงูุฌููุฉ ุธุงูุฑุฉ ุชุญุช ูู ููุชุฌ. ูุฃุณุนุงุฑ ุฌููุฉ ูุจูุฑุฉ ุงุจุนุชููุง ุนูู ูุงุชุณุงุจ.';
  } else if (s('ุชูุงุตู')||s('ูุงุชุณุงุจ')||s('ุฑูู')) {
    a = `ุชูุฏุฑ ุชููู ูุฑูู ุงููุจูุนุงุช ูุจุงุดุฑุฉ: ูุงุชุณุงุจ ${WHATSAPP_PHONE} ุฃู ุฅูููู ${SUPPORT_EMAIL}.`;
  } else {
    a = 'ููููู! ๐ ูู ุณุคุงูู ุนู ุงูุดุญู/ุงูุงุณุชุฑุฌุงุน/ุงูุญุฏ ุงูุฃุฏูู/ุงูุฏูุน ุงูุชุจ ุงููููุฉุ ุฃู ุชูุงุตู ุนูู ุฒุฑ ูุงุชุณุงุจ ุจุงูุฃุณูู.';
  }
  push('bot', a);
}
function sendMsg(text){
  const v = (text ?? chatInput.value).trim();
  if(!v) return;
  push('user', v);
  chatInput.value='';
  setTimeout(()=> replyBot(v), 400);
}
chatSend.onclick = ()=> sendMsg();
chatInput.addEventListener('keydown', (e)=> { if(e.key==='Enter') sendMsg(); });

/* =====================[ ุฃุญุฏุงุซ ุงูุณูุฉ + ูุชุญ/ุบูู ]===================== */
document.getElementById('openCart').onclick = openCart;
document.getElementById('closeCart').onclick = closeCart;
document.getElementById('cartCloseBg').onclick = closeCart;
document.getElementById('cartClear').onclick = clearCart;

// ุญูุธ ุจูุงูุงุช ุงูุนููู
['cusName','cusPhone','cusCity'].forEach(id=>{
  const el = document.getElementById(id);
  el.addEventListener('input', ()=>{
    customer = {
      name:  document.getElementById('cusName').value.trim(),
      phone: document.getElementById('cusPhone').value.trim(),
      city:  document.getElementById('cusCity').value.trim()
    };
    lsSet(LS_KEYS.customer, customer);
  });
});

// ุชูููุถ ููุฑุงุช ุฏุงุฎู ุงููุซููุฉ (ุฃุฒุฑุงุฑ ุงูุณูุฉ + ุฃุถู ููุณูุฉ)
document.addEventListener('click', (e)=>{
  const add = e.target.closest('.btn-add');
  if(add){ addToCart(add.dataset.id); return; }

  const inc = e.target.closest('.qty-inc');
  if(inc){ changeQty(inc.dataset.id, +1); return; }

  const dec = e.target.closest('.qty-dec');
  if(dec){ changeQty(dec.dataset.id, -1); return; }

  const rm = e.target.closest('.item-remove');
  if(rm){ removeItem(rm.dataset.id); return; }
});

// ุฅููุงู ุงูุทูุจ ุนุจุฑ ูุงุชุณุงุจ / ุจุฑูุฏ
function buildOrderText(){
  const lines = cart.map(it=>{
    const p = getProd(it.id); if(!p) return '';
    const line = (p.price||0)*(it.qty||0);
    return `โข ${p.title} โ ูููุฉ: ${it.qty} โ ${line} ุฌ.ู`;
  }).filter(Boolean).join('\n');

  const total = cartSubtotal();
  return `ุทูุจ ุฌุฏูุฏ ูู ${brand}:
${lines}
----------------
ุงูุฅุฌูุงูู: ${total} ุฌ.ู
ุงูุงุณู: ${customer.name||'-'}
ุงููุงุชู: ${customer.phone||'-'}
ุงููุญุงูุธุฉ/ุงููุฏููุฉ: ${customer.city||'-'}`;
}
document.getElementById('cartCheckoutWA').onclick = ()=>{
  if(!cart.length) return;
  const text = buildOrderText();
  const url = 'https://wa.me/' + WHATSAPP_PHONE + '?text=' + encodeURIComponent(text);
  window.open(url, '_blank');
};
document.getElementById('cartCheckoutEmail').onclick = ()=>{
  if(!cart.length) return;
  const subject = encodeURIComponent(`ุทูุจ ุฌุฏูุฏ - ${brand}`);
  const body = encodeURIComponent(buildOrderText());
  window.location.href = `mailto:${SUPPORT_EMAIL}?subject=${subject}&body=${body}`;
};

/* =====================[ ุจุฏุก ]===================== */
refreshAll(); fillCatSelect(); listCats(); listProds();
renderRoute();
attachSearch();
renderChat();
renderCartIcon();

if (location.hash === '#/admin' && !isAdmin) ensureAdmin();
window.addEventListener('hashchange', () => {
  if (location.hash === '#/admin' && !isAdmin) ensureAdmin();
  renderRoute();
  attachSearch();
});
</script>
</body>
</html>
