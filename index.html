<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <head>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
 /* ===== Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ Ø§Ù„Ù…ØªØ­Ø±Ùƒ ===== */
#sideTicker .marquee {
  white-space: nowrap;
  display: inline-block;
  padding-inline: 16px;
  animation: tickerBounce 12s linear infinite alternate;
  will-change: transform;
}
@keyframes tickerBounce {
  0%   { transform: translateX(0); }
  100% { transform: translateX(-55%); }
}
/* Ù…ÙˆØ¨Ø§ÙŠÙ„: Ø§Ø¨Ø¹Ø¯Ù‡ Ø¹Ù† Ø²Ø± Ø§Ù„Ø´Ø§Øª */
@media (max-width: 640px){
  #sideTicker { bottom: 120px !important; top: auto !important; transform: none !important; }
}

  </style>
  </head>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ZADORA Lite</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google Sign-In (Ø§Ø®ØªÙŠØ§Ø±ÙŠ: ÙØ¹Ù‘Ù„ ÙÙ‚Ø· Ù„Ùˆ Ù‡ØªØ­Ø· Client ID) -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <style>
    :root{
      /* Ø£Ù„ÙˆØ§Ù† Ø§Ù„Ø«ÙŠÙ… */
      --accent: #C19A6B;     /* Ø¬Ù…Ù„ÙŠ */
      --accent-700:#A67C52;  /* Ø£ØºÙ…Ù‚ */
      --accent-50:#F4ECE3;   /* ÙØ§ØªØ­ */
    }
    body{ background:#fafafa; color:#111827; }
    .container{ max-width:1120px; margin:0 auto; }
    .glass{ backdrop-filter: blur(6px); background: rgba(255,255,255,.85); }
    .modal-bg{ background: rgba(0,0,0,.45); }
    /* Ø£Ø¯ÙˆØ§Øª Ù„Ù„ÙˆÙ† Ø§Ù„Ø¬Ù…Ù„ÙŠ Ø¨Ø¯Ù„ ÙƒÙ„Ø§Ø³ Ø±ÙˆØ² */
    .accent-bg{ background-color:var(--accent) !important; color:#fff !important; }
    .accent-bg:hover{ background-color:var(--accent-700) !important; }
    .accent-border{ border-color:var(--accent) !important; }
    .accent-text{ color:var(--accent) !important; }
    .accent-50{ background-color:var(--accent-50) !important; }
    /* Ù…Ù†ÙŠÙˆ Ø·Ø§ÙŠØ±Ø© Ø¨Ø³ÙŠØ·Ø© */
    .dropdown{ position:relative; }
    .dropdown-panel{ position:absolute; inset-inline-start:0; top:100%; margin-top:.5rem;
      width:16rem; background:#fff; border:1px solid #e5e7eb; border-radius:1rem;
      box-shadow:0 20px 50px rgba(0,0,0,.08); overflow:hidden; z-index:60;
    }
  </style>
</head>
<body class="min-h-screen">
  <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± -->
  <header class="sticky top-0 z-40 glass border-b">
    <div class="container px-4 py-3 flex items-center gap-3">
      <div class="font-extrabold text-xl text-black" id="brandName">ZADORA</div>
      <div class="flex-1"></div>

      <!-- Ø¨Ø­Ø« (Ø¯ÙŠØ³ÙƒØªÙˆØ¨) -->
      <div class="hidden md:block w-[420px]">
        <form id="searchForm" class="relative">
          <input id="search" placeholder="Ø¥Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬..." class="w-full rounded-xl border px-3 py-2 pr-10" />
          <button id="searchBtn" type="submit" class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">ğŸ”</button>
        </form>
      </div>

<!-- Ø§Ø³ØªØ¨Ø¯Ù„ ÙƒÙ„ ÙƒÙˆØ¯ Ø²Ø± Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø¨ÙƒÙˆØ¯ ÙˆØ§Ø­Ø¯ ÙÙ‚Ø· Ø²ÙŠ Ø¯Ù‡ -->
<button id="catsToggle"
  class="inline-flex items-center gap-2 rounded-xl border px-3 py-2 hover:bg-gray-50 accent-text"
  aria-label="Ø§Ù„Ø£Ù‚Ø³Ø§Ù…" title="Ø§Ù„Ø£Ù‚Ø³Ø§Ù…">
  <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© 3 Ø´Ø±Ø·Ø§Øª -->
  <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
    <path d="M4 6h16M4 12h16M4 18h16"
          stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
  </svg>
  <span class="hidden md:inline">Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</span>
</button>



      <!-- Ø§Ù„Ø³Ù„Ø© -->
      <button id="openCart" class="relative rounded-xl border px-3 py-2 hover:bg-gray-50">
        ğŸ›’ 
        <span id="cartCount" class="absolute -top-2 -left-2 min-w-[22px] h-[22px] text-xs rounded-full accent-bg px-1 flex items-center justify-center hidden">0</span>
      </button>

      <!-- Ø§Ù„Ø­Ø³Ø§Ø¨ -->
      <div class="dropdown">
        <button id="accountBtn" class="rounded-xl border px-3 py-2 hover:bg-gray-50">ğŸ‘¤ </button>
        <div id="accountMenu" class="dropdown-panel hidden text-sm">
          <div class="px-3 py-2 bg-neutral-50 border-b">
            <div id="accountHello">Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ø¶ÙŠÙ</div>
          </div>
          <button id="menuLogin" class="w-full text-right px-3 py-2 hover:bg-gray-50">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</button>
          <button id="menuInvoices" class="w-full text-right px-3 py-2 hover:bg-gray-50 hidden">ÙÙˆØ§ØªÙŠØ±ÙŠ</button>
          <button id="menuLogout" class="w-full text-right px-3 py-2 hover:bg-gray-50 hidden">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>
        </div>
      </div>

      <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
      <button id="openAdmin" class="rounded-xl border px-3 py-2 hover:bg-gray-50">âš™ï¸ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</button>
    </div>

    <!-- Ø¨Ø­Ø« (Ù…ÙˆØ¨Ø§ÙŠÙ„) -->
    <div class="md:hidden px-4 pb-3">
      <form id="searchForm2" class="relative">
        <input id="search2" placeholder="Ø¥Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬..." class="w-full rounded-xl border px-3 py-2 pr-10" />
        <button id="searchBtn2" type="submit" class="absolute left-3 top-1/2 -translate-y-1/2 text-gray-500">ğŸ”</button>
      </form>
      <!-- Ø²Ø± Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ -->
     <button id="catsToggle"
  class="rounded-xl border px-3 py-2 hover:bg-gray-50 hidden sm:inline-flex items-center gap-2 accent-text"
  aria-label="Ø§Ù„Ø£Ù‚Ø³Ø§Ù…">
  <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© 3 Ø´Ø±Ø·Ø§Øª -->
  <svg class="w-5 h-5" viewBox="0 0 24 24" fill="none" aria-hidden="true">
    <path d="M4 6h16M4 12h16M4 18h16"
          stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
  </svg>
  <span class="hidden md:inline">Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</span>
</button>

  </header>

  <!-- Ù‡ÙŠØ±Ùˆ -->
  <section class="container px-4 mt-4" id="heroSection"></section>
  <!-- Ù…Ù…ÙŠØ²Ø§Øª -->
  <section class="container px-4 mt-6" id="benefitsSection"></section>
  <!-- Ø£Ù‚Ø³Ø§Ù… -->
  <section class="container px-4 mt-8" id="categoriesSection"></section>
  <!-- Ù…Ù†ØªØ¬Ø§Øª -->
  <section class="container px-4 mt-8" id="productsSection"></section>

  <!-- Ù†Ø´Ø±Ø© Ø¨Ø±ÙŠØ¯ÙŠØ© -->
  <section class="container px-4 mt-10">
    <div class="rounded-2xl bg-neutral-900 text-white overflow-hidden">
      <div class="grid md:grid-cols-2">
        <div class="p-8 md:p-12">
          <h3 class="text-2xl md:text-3xl font-extrabold">Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„ØªØ¬Ø§Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ÙŠØ©</h3>
          <p class="mt-2 text-white/80">Ø®ØµÙˆÙ…Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø¬Ù…Ù„Ø© + Ø¹Ø±ÙˆØ¶ ØµÙ†Ø§Ø¯ÙŠÙ‚ Ø¬Ø§Ù‡Ø²Ø© Ø£Ø³Ø¨ÙˆØ¹ÙŠÙ‹Ø§.</p>
          <div class="mt-5 flex items-center gap-2">
            <input class="flex-1 rounded-xl px-3 py-2 text-neutral-900" placeholder="Ø§ÙƒØªØ¨ Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" dir="rtl"/>
            <button class="rounded-xl accent-bg px-4 py-2 font-semibold">Ø§Ø´ØªØ±Ùƒ</button>
          </div>
        </div>
        <div class="relative min-h-[220px]">
          <img src="https://images.unsplash.com/photo-1523275335684-37898b6baf30?q=80&w=1600&auto=format&fit=crop" alt="newsletter" class="absolute inset-0 w-full h-full object-cover opacity-70"/>
        </div>
      </div>
    </div>
  </section>

  <!-- ÙÙˆØªØ± -->
  <footer class="mt-10 border-t">
    <div class="container px-4 py-8 grid md:grid-cols-4 gap-8 text-right">
      <div>
        <div class="font-bold text-lg"><span class="accent-text">âœ¦</span> <span id="brandNameFooter" class="text-black">ZADORA</span></div>
        <p class="mt-3 text-sm text-gray-600" id="footerAbout">Ù…Ù†ØµØ© Ø¬Ù…Ù„Ø© Ù„Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©: Ø­Ø¯ Ø£Ø¯Ù†Ù‰ 12 Ù‚Ø·Ø¹Ø©ØŒ Ø´Ø­Ù† Ø³Ø±ÙŠØ¹ØŒ ÙˆØ¶Ù…Ø§Ù† Ø§Ø³ØªØ¨Ø¯Ø§Ù„.</p>
      </div>
      <div>
        <h4 class="font-semibold mb-2">Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h4>
        <ul class="space-y-1 text-sm text-gray-600">
          <li><a class="hover:underline">Ø³ÙŠØ§Ø³Ø© Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹</a></li>
          <li><a class="hover:underline">Ø§Ù„Ø´Ø­Ù† ÙˆØ§Ù„ØªØ³Ù„ÙŠÙ…</a></li>
          <li><a class="hover:underline">Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹</a></li>
        </ul>
      </div>
      <div>
        <h4 class="font-semibold mb-2">Ø§Ù„Ø´Ø±ÙƒØ©</h4>
        <ul class="space-y-1 text-sm text-gray-600">
          <li><a class="hover:underline">Ù…Ù† Ù†Ø­Ù†</a></li>
          <li><a class="hover:underline">Ø§Ù†Ø¶Ù… ÙƒØªØ§Ø¬Ø±/Ù…ÙˆØ±Ø¯</a></li>
          <li><a class="hover:underline">ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</a></li>
        </ul>
      </div>
      <div>
        <h4 class="font-semibold mb-2">ØªØ§Ø¨Ø¹Ù†Ø§</h4>
        <ul class="space-y-1 text-sm text-gray-600">
          <li><a id="linkFacebook"  class="hover:underline">Facebook</a></li>
          <li><a id="linkInstagram" class="hover:underline">Instagram</a></li>
          <li><a id="linkTikTok"    class="hover:underline">TikTok</a></li>
          <li><a id="linkTelegram"  class="hover:underline">Telegram</a></li>
        </ul>
      </div>
    </div>
    <div class="py-4 text-center text-xs text-gray-500">Â© <span id="year"></span> <span id="brandNameCopy" class="text-black">ZADORA</span>. All rights reserved.</div>
  </footer>

  <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
  <div id="adminModal" class="fixed inset-0 hidden z-50 modal-bg">
    <div class="absolute inset-0" id="adminCloseBg"></div>
    <div class="absolute right-0 top-0 bottom-0 w-full md:w-[760px] bg-white rounded-none md:rounded-l-3xl shadow-2xl overflow-y-auto">
      <div class="sticky top-0 glass border-b p-4 flex items-center justify-between">
        <div class="font-bold">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
        <div class="flex items-center gap-2">
          <label class="rounded-xl border px-3 py-2 text-sm cursor-pointer hover:bg-gray-50">
            <input type="file" id="importJson" accept="application/json" class="hidden" /> Ø§Ø³ØªÙŠØ±Ø§Ø¯
          </label>
          <button id="exportJson" class="rounded-xl border px-3 py-2 text-sm hover:bg-gray-50">ØªØµØ¯ÙŠØ±</button>
          <button id="resetAll" class="rounded-xl border px-3 py-2 text-sm hover:bg-gray-50">Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ</button>
          <button id="closeAdmin" class="rounded-xl accent-bg px-4 py-2 text-sm">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
      </div>

      <div class="p-4">
        <div class="flex gap-2 mb-4">
          <button data-tab="products"  class="tab-btn rounded-xl px-4 py-2 text-sm border">Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
          <button data-tab="categories" class="tab-btn rounded-xl px-4 py-2 text-sm border">Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</button>
          <button data-tab="settings"   class="tab-btn rounded-xl px-4 py-2 text-sm border">Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
        </div>

        <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
        <div id="tab-settings" class="tab-pane hidden" dir="rtl">
          <div class="grid md:grid-cols-2 gap-4">
            <div class="space-y-2">
              <label class="text-sm font-medium">Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ø§Ù†Ø¯</label>
              <input id="brandInput" class="w-full rounded-xl border px-3 py-2" placeholder="ZADORA"/>
              <label class="text-sm font-medium">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù‡ÙŠØ±Ùˆ</label>
              <input id="heroTitleInput" class="w-full rounded-xl border px-3 py-2"/>
              <label class="text-sm font-medium">ÙˆØµÙ Ø§Ù„Ù‡ÙŠØ±Ùˆ</label>
              <textarea id="heroSubInput" class="w-full rounded-xl border px-3 py-2 min-h-[112px]"></textarea>

              <div class="space-y-2 mt-4">
                <label class="text-sm font-medium">ÙˆØµÙ Ø§Ù„ÙÙˆØªØ±</label>
                <textarea id="footerInput" class="w-full rounded-xl border px-3 py-2 min-h-[90px]"
                  placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ù†Øµ Ø§Ù„ØªØ¹Ø±ÙŠÙÙŠ Ø§Ù„Ø°ÙŠ ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ÙÙˆØªØ±"></textarea>

                <div class="text-sm font-medium mt-2">Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø³ÙˆØ´ÙŠØ§Ù„</div>
                <input id="linkFBInput" class="w-full rounded-xl border px-3 py-2" placeholder="https://facebook.com/yourpage" />
                <input id="linkIGInput" class="w-full rounded-xl border px-3 py-2" placeholder="https://instagram.com/yourpage" />
                <input id="linkTTInput" class="w-full rounded-xl border px-3 py-2" placeholder="https://tiktok.com/@yourpage" />
                <input id="linkTGInput" class="w-full rounded-xl border px-3 py-2" placeholder="https://t.me/yourchannel" />
                <p class="text-xs text-gray-500">Ø§ØªØ±Ùƒ Ø£ÙŠ Ø®Ø§Ù†Ø© ÙØ§Ø¶ÙŠØ© Ù„Ùˆ Ù…Ø´ Ø¹Ø§ÙŠØ² Ø§Ù„Ø±Ø§Ø¨Ø· ÙŠØ¸Ù‡Ø±.</p>
              </div>
            </div>
            <div class="space-y-2">
              <div class="text-sm font-medium">ØµÙˆØ±Ø© Ø§Ù„Ù‡ÙŠØ±Ùˆ</div>
              <div class="aspect-[4/3] w-full overflow-hidden rounded-xl border bg-white" id="heroImgWrap">
                <img id="heroImgPreview" class="w-full h-full object-cover" />
              </div>
              <label class="inline-flex items-center gap-2 rounded-xl border px-3 py-2 cursor-pointer hover:bg-gray-50">
                <input id="heroImgInput" type="file" accept="image/*" class="hidden" /> Ø±ÙØ¹ ØµÙˆØ±Ø©
              </label>
            </div>
          </div>
        </div>

        <!-- Ø£Ù‚Ø³Ø§Ù… -->
        <div id="tab-categories" class="tab-pane hidden" dir="rtl">
          <div class="grid md:grid-cols-3 gap-4">
            <div class="space-y-3">
              <input id="catName" class="w-full rounded-xl border px-3 py-2" placeholder="Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…"/>
              <div class="space-y-2">
                <div class="text-sm font-medium">ØµÙˆØ±Ø© Ø§Ù„Ù‚Ø³Ù…</div>
                <div class="aspect-[4/3] w-full overflow-hidden rounded-xl border bg-white">
                  <img id="catImgPreview" class="w-full h-full object-cover" />
                </div>
                <label class="inline-flex items-center gap-2 rounded-xl border px-3 py-2 cursor-pointer hover:bg-gray-50">
                  <input id="catImgInput" type="file" accept="image/*" class="hidden" /> Ø±ÙØ¹ ØµÙˆØ±Ø©
                </label>
              </div>
              <div class="flex gap-2">
                <button id="saveCat" class="flex-1 rounded-xl accent-bg py-2 font-semibold">Ø­ÙØ¸</button>
                <button id="resetCat" class="rounded-xl border px-3">Ø¥Ù„ØºØ§Ø¡</button>
              </div>
            </div>
            <div class="md:col-span-2 grid sm:grid-cols-2 gap-3" id="catsList"></div>
          </div>
        </div>

        <!-- Ù…Ù†ØªØ¬Ø§Øª -->
        <div id="tab-products" class="tab-pane hidden" dir="rtl">
          <div class="grid md:grid-cols-3 gap-4">
            <div class="space-y-3">
              <input id="pTitle" class="w-full rounded-xl border px-3 py-2" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬"/>
              <div class="grid grid-cols-2 gap-2">
                <input id="pPrice" class="rounded-xl border px-3 py-2" placeholder="Ø§Ù„Ø³Ø¹Ø±" type="number"/>
                <input id="pOld" class="rounded-xl border px-3 py-2" placeholder="Ø§Ù„Ø³Ø¹Ø± Ù‚Ø¨Ù„" type="number"/>
              </div>
              <div class="grid grid-cols-3 gap-2">
                <input id="pRating" class="rounded-xl border px-3 py-2" placeholder="ØªÙ‚ÙŠÙŠÙ…" type="number" step="0.1"/>
                <input id="pReviews" class="rounded-xl border px-3 py-2" placeholder="Ù…Ø±Ø§Ø¬Ø¹Ø§Øª" type="number"/>
                <input id="pMinQty" class="rounded-xl border px-3 py-2" placeholder="Ø­Ø¯ Ø£Ø¯Ù†Ù‰" type="number"/>
              </div>
              <input id="pBadge" class="w-full rounded-xl border px-3 py-2" placeholder="Ø´Ø§Ø±Ø© (Ø¬Ø¯ÙŠØ¯/Ø¹Ø±Ø¶ Ø®Ø§Øµ)"/>
              <select id="pCategory" class="w-full rounded-xl border px-3 py-2"></select>
              <div class="space-y-2">
                <div class="text-sm font-medium">ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬</div>
                <div class="aspect-[4/3] w-full overflow-hidden rounded-xl border bg-white">
                  <img id="pImgPreview" class="w-full h-full object-cover" />
                </div>
                <label class="inline-flex items-center gap-2 rounded-xl border px-3 py-2 cursor-pointer hover:bg-gray-50">
                  <input id="pImgInput" type="file" accept="image/*" class="hidden" /> Ø±ÙØ¹ ØµÙˆØ±Ø©
                </label>
              </div>
              <div class="flex gap-2">
                <button id="saveProduct" class="flex-1 rounded-xl accent-bg py-2 font-semibold">Ø¥Ø¶Ø§ÙØ©/ØªØ­Ø¯ÙŠØ«</button>
                <button id="resetProduct" class="rounded-xl border px-3">Ø¥Ù„ØºØ§Ø¡</button>
              </div>
            </div>
            <div class="md:col-span-2 grid sm:grid-cols-2 gap-3" id="productsList"></div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <!-- ÙˆÙŠØ¯Ø¬Øª Ø§Ù„Ø´Ø§Øª -->
  <div id="chatRoot" class="fixed bottom-4 right-4 z-50">
    <button id="chatToggle" class="rounded-full shadow-lg accent-bg w-14 h-14 flex items-center justify-center text-2xl">ğŸ’¬</button>
    <div id="chatPanel" class="hidden mt-3 w-[320px] sm:w-[360px] rounded-2xl shadow-2xl border bg-white overflow-hidden">
      <div class="flex items-center justify-between px-4 py-3 bg-neutral-900 text-white">
        <div class="font-semibold">Ø¯Ø¹Ù… <span id="brandInChat">ZADORA</span></div>
        <button id="chatClose" title="Ø¥ØºÙ„Ø§Ù‚">âœ•</button>
      </div>
      <div id="chatBody" class="h-[320px] overflow-y-auto px-3 py-3 space-y-2 bg-neutral-50"></div>
      <div class="px-3 pb-3">
        <div class="flex flex-wrap gap-2 text-xs mb-2">
          <button class="px-2 py-1 rounded-full border bg-white quick">Ø§Ù„Ø´Ø­Ù†</button>
          <button class="px-2 py-1 rounded-full border bg-white quick">Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹</button>
          <button class="px-2 py-1 rounded-full border bg-white quick">Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰</button>
          <button class="px-2 py-1 rounded-full border bg-white quick">Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹</button>
        </div>
        <div class="flex items-center gap-2">
          <input id="chatInput" class="flex-1 rounded-xl border px-3 py-2" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ..." />
          <button id="chatSend" class="rounded-xl accent-bg px-4 py-2">Ø¥Ø±Ø³Ø§Ù„</button>
        </div>
        <a id="waBtn" class="block text-center text-sm mt-2 rounded-xl border py-2 hover:bg-gray-50" target="_blank" rel="noopener">ØªÙˆØ§ØµÙ„ ÙˆØ§ØªØ³Ø§Ø¨ Ø§Ù„Ø¢Ù†</a>
      </div>
    </div>
  </div>

  <!-- Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª -->
  <div id="cartModal" class="fixed inset-0 hidden z-50 modal-bg">
    <div id="cartCloseBg" class="absolute inset-0"></div>
    <div class="absolute right-0 top-0 bottom-0 w-full md:w-[760px] bg-white rounded-none md:rounded-l-3xl shadow-2xl overflow-y-auto">
      <div class="sticky top-0 glass border-b p-4 flex items-center justify-between">
        <div class="font-bold">Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</div>
        <div class="flex items-center gap-2">
          <button id="cartClear" class="rounded-xl border px-3 py-2 text-sm hover:bg-gray-50">ØªÙØ±ÙŠØº Ø§Ù„Ø³Ù„Ø©</button>
          <button id="closeCart" class="rounded-xl accent-bg px-4 py-2 text-sm">Ø¥ØºÙ„Ø§Ù‚</button>
        </div>
      </div>

      <div class="p-4 grid md:grid-cols-2 gap-4">
        <div>
          <div id="cartItems" class="space-y-3"></div>
        </div>

        <div class="space-y-3">
          <div class="rounded-2xl border bg-white p-4">
            <div class="font-semibold mb-2">Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</div>
            <div class="space-y-2">
              <input id="cusName"  class="w-full rounded-xl border px-3 py-2" placeholder="Ø§Ù„Ø§Ø³Ù…"/>
              <input id="cusPhone" class="w-full rounded-xl border px-3 py-2" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ"/>
              <input id="cusCity"  class="w-full rounded-xl border px-3 py-2" placeholder="Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©/Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©"/>
              <select id="cusTier" class="w-full rounded-xl border px-3 py-2">
                <option value="wh">Ø¬Ù…Ù„Ø© Ø§Ù„Ø¬Ù…Ù„Ø©</option>
                <option value="half">Ù†Øµ Ø¬Ù…Ù„Ø©</option>
                <option value="retail">Ù‚Ø·Ø§Ø¹ÙŠ</option>
              </select>
              <div id="tierMsg" class="text-sm accent-text"></div>
            </div>
          </div>

          <div class="rounded-2xl border bg-white p-4">
            <div class="flex items-center justify-between">
              <div>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±Ø¹ÙŠ</div>
              <div id="cartSubtotal" class="font-bold">0 Ø¬.Ù…</div>
            </div>
            <div class="flex items-center justify-between text-sm text-gray-600 mt-1">
              <div>Ø§Ù„Ø´Ø­Ù†</div>
              <div id="cartShipping">ÙŠÙØ­Ø³Ø¨ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©</div>
            </div>
            <div id="retailDiscountRow" class="hidden flex items-center justify-between text-sm mt-1">
              <div>Ø®ØµÙ… Ù‚Ø·Ø§Ø¹ÙŠ 10%</div>
              <div id="retailDiscountVal">-0 Ø¬.Ù…</div>
            </div>
            <hr class="my-2">
            <div class="flex items-center justify-between text-lg">
              <div class="font-bold">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</div>
              <div id="cartTotal" class="font-extrabold accent-text">0 Ø¬.Ù…</div>
            </div>
            <p class="text-xs text-gray-500 mt-2">* Ø§Ù„ÙƒÙ…ÙŠØ§Øª ØªØªØ­Ø±Ùƒ Ø¨Ù…Ø¶Ø§Ø¹ÙØ§Øª Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„ÙƒÙ„ ØµÙ†Ù.</p>
            <div class="mt-3 grid grid-cols-1 gap-2">
              <button id="cartCheckoutWA" class="rounded-xl accent-bg px-4 py-2 font-semibold">Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨</button>
              <button id="cartCheckoutEmail" class="rounded-xl border px-4 py-2 hover:bg-gray-50">Ø·Ù„Ø¨ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- Ø¯Ø±Ø¬ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… (Sidebar) -->
  <div id="catsDrawer" class="fixed inset-0 hidden z-50 modal-bg">
    <div class="absolute inset-0" id="catsCloseBg"></div>
    <aside class="absolute right-0 top-0 bottom-0 w-full sm:w-[420px] bg-white md:rounded-l-3xl shadow-2xl overflow-y-auto">
      <div class="sticky top-0 glass border-b p-4 flex items-center justify-between">
        <div class="font-bold">Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</div>
        <button id="catsClose" class="rounded-xl accent-bg px-4 py-2 text-sm">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
      <div class="p-4">
        <input id="catsFilter" class="w-full rounded-xl border px-3 py-2" placeholder="Ø§Ø¨Ø­Ø« Ø¯Ø§Ø®Ù„ Ø§Ù„Ø£Ù‚Ø³Ø§Ù…..."/>
        <div id="catsDrawerList" class="mt-3 grid grid-cols-1 gap-2"></div>
      </div>
    </aside>
  </div>

  <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„Ø­Ø³Ø§Ø¨ (ØªØ³Ø¬ÙŠÙ„) -->
  <div id="authModal" class="fixed inset-0 hidden z-50 modal-bg">
    <div class="absolute inset-0" id="authCloseBg"></div>
    <div class="absolute right-0 top-0 bottom-0 w-full sm:w-[500px] bg-white md:rounded-l-3xl shadow-2xl overflow-y-auto">
      <div class="sticky top-0 glass border-b p-4 flex items-center justify-between">
        <div class="font-bold">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</div>
        <button id="authClose" class="rounded-xl accent-bg px-4 py-2 text-sm">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
      <div class="p-4 space-y-3">
        <div class="text-sm text-gray-600">Ø³Ø¬Ù„ Ø¨Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§ØªÙƒØŒ Ø£Ùˆ ÙØ¹Ù‘Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¬ÙˆØ¬Ù„ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ).</div>
        <input id="authName"  class="w-full rounded-xl border px-3 py-2" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„"/>
        <input id="authEmail" class="w-full rounded-xl border px-3 py-2" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"/>
        <input id="authPhone" class="w-full rounded-xl border px-3 py-2" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ"/>
        <button id="authSave" class="w-full rounded-xl accent-bg px-4 py-2 font-semibold">ØªØ³Ø¬ÙŠÙ„ / Ø¯Ø®ÙˆÙ„</button>

        <!-- Google One Tap / Button -->
        <div id="googleArea" class="mt-4 hidden">
          <div class="text-center my-2 text-xs text-gray-500">Ø£Ùˆ</div>
          <div id="g_id_onload"
               data-client_id=""
               data-context="signin"
               data-callback="onGoogleCredential"
               data-itp_support="true">
          </div>
          <div class="g_id_signin" data-type="standard" data-shape="pill" data-theme="outline" data-text="signin_with" data-size="large" data-logo_alignment="left"></div>
          <div class="text-xs text-gray-500 mt-2">Ø¶Ø¹ Client ID ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ù„ØªÙØ¹ÙŠÙ„ Ø²Ø± Ø¬ÙˆØ¬Ù„.</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Ù…ÙˆØ¯Ø§Ù„ Ø§Ù„ÙÙˆØ§ØªÙŠØ± -->
  <div id="invModal" class="fixed inset-0 hidden z-50 modal-bg">
    <div class="absolute inset-0" id="invCloseBg"></div>
    <div class="absolute right-0 top-0 bottom-0 w-full md:w-[760px] bg-white md:rounded-l-3xl shadow-2xl overflow-y-auto">
      <div class="sticky top-0 glass border-b p-4 flex items-center justify-between">
        <div class="font-bold">ÙÙˆØ§ØªÙŠØ±ÙŠ</div>
        <button id="invClose" class="rounded-xl accent-bg px-4 py-2 text-sm">Ø¥ØºÙ„Ø§Ù‚</button>
      </div>
      <div id="invBody" class="p-4"></div>
    </div>
  </div>

<script>
/* =====================[ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© + Ø¯Ø¹Ù… ]===================== */
const WHATSAPP_PHONE = '201119508881';           // Ø±Ù‚Ù… ÙˆØ§ØªØ³Ø§Ø¨ Ø¨ØµÙŠØºØ© Ø¯ÙˆÙ„ÙŠØ© (20 + Ø§Ù„Ø±Ù‚Ù… Ø¨Ø¯ÙˆÙ† 0)
const SUPPORT_EMAIL  = 'sales@example.com';
if (document.getElementById('waBtn')) document.getElementById('waBtn').href = 'https://wa.me/' + WHATSAPP_PHONE;
/* (Ø§Ø®ØªÙŠØ§Ø±ÙŠ) Ù„Ùˆ Ø¹Ù†Ø¯Ùƒ Google Client ID Ø­Ø·Ù‡ Ù‡Ù†Ø§ ÙˆØ£Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© */
const GOOGLE_CLIENT_ID = ''; // Ù…Ø«Ø§Ù„: "1234567890-abcdefg.apps.googleusercontent.com"

/* =====================[ Admin PIN + Routing ]===================== */
const ADMIN_PIN = '1234';
let isAdmin = sessionStorage.getItem('zl_admin') === '1';

/* Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù‡ÙˆÙ… */
function showHomeSections(show) {
  document.getElementById('heroSection').classList.toggle('hidden', !show);
  document.getElementById('benefitsSection').classList.toggle('hidden', !show);
  document.getElementById('categoriesSection').classList.toggle('hidden', !show);
}
function ensureAdmin() {
  const pin = prompt('Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… PIN Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©:');
  if (pin === ADMIN_PIN) {
    isAdmin = true;
    sessionStorage.setItem('zl_admin', '1');
    const btn = document.getElementById('openAdmin');
    if (btn) btn.classList.remove('hidden');
    openAdminPanel();
  } else { alert('PIN ØºÙŠØ± ØµØ­ÙŠØ­'); location.hash = '#/'; }
}

/* =====================[ Ø¨ÙŠØ§Ù†Ø§Øª + LocalStorage ]===================== */
const LS_KEYS = {
  brand:'zl_brand', hero:'zl_hero', cats:'zl_cats', prods:'zl_prods',
  cart:'zl_cart', customer:'zl_customer',
  social:'zl_social', footer:'zl_footer',
  user:'zl_user', invoices:'zl_invoices',
  chat:'zl_chat_history'
};
const DEFAULT_BRAND = 'ZADORA';
const DEFAULT_HERO = {
  title: 'Ø¬ÙÙ…Ù„Ø© Ø±Ø§Ù‚ÙŠØ© Ø¨Ù„Ù…Ø³Ø© ZADORA',
  subtitle: 'Ø§Ø·Ù„Ø¨ Ø¨Ø§Ù„ÙƒØ±ØªÙˆÙ†Ø© Ø£Ùˆ Ø­Ø¯ Ø£Ø¯Ù†Ù‰ 12 Ù‚Ø·Ø¹Ø© â€” Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ø¶Ø­Ø©ØŒ Ø®Ø§Ù…Ø§Øª Ù…Ø¶Ù…ÙˆÙ†Ø©ØŒ ÙˆØµÙˆØ± Ø¬Ø§Ù‡Ø²Ø© Ù„Ø²ÙŠØ§Ø¯Ø© Ù…Ø¨ÙŠØ¹Ø§ØªÙƒ ÙÙˆØ±Ù‹Ø§.',
  image: 'https://images.unsplash.com/photo-1555041469-a586c61ea9bc?q=80&w=1600&auto=format&fit=crop'
};
const DEFAULT_CATS = [
  { name:'Ù…Ø·Ø¨Ø®', image:'https://images.unsplash.com/photo-1542909168-82c3e7fdca5c?q=80&w=1200&auto=format&fit=crop' },
  { name:'ØªØ®Ø²ÙŠÙ† ÙˆØªÙ†Ø¸ÙŠÙ…', image:'https://images.unsplash.com/photo-1582582429416-2f3a27730854?q=80&w=1200&auto=format&fit=crop' },
  { name:'Ù…Ø´Ø±ÙˆØ¨Ø§Øª ÙˆÙ…Ø¬Ø§Øª', image:'https://images.unsplash.com/photo-1511920170033-f8396924c348?q=80&w=1200&auto=format&fit=crop' },
  { name:'Ø¯ÙŠÙƒÙˆØ±', image:'https://images.unsplash.com/photo-1501045661006-fcebe0257c3f?q=80&w=1200&auto=format&fit=crop' },
  { name:'Ù…Ù†Ø³ÙˆØ¬Ø§Øª', image:'https://images.unsplash.com/photo-1497032628192-86f99bcd76bc?q=80&w=1200&auto=format&fit=crop' },
  { name:'Ø¨Ù„Ø§Ø³ØªÙŠÙƒ ÙˆØ§Ø³ØªØ§Ù„Ø³', image:'https://images.unsplash.com/photo-1542444592-1e6c9f952a25?q=80&w=1200&auto=format&fit=crop' },
];
const DEFAULT_PRODS = [
  { id:1, title:'Ø·Ù‚Ù… ØªÙ„Ø§Ø¬Ø© Ø¨ÙŠØ±ÙƒØ³ â€“ 3 Ù‚Ø·Ø¹', price:420, oldPrice:480, rating:4.7, reviews:126, image:'https://images.unsplash.com/photo-1601050690290-27f9864c06c0?q=80&w=1200&auto=format&fit=crop', badge:'Ø§Ù„Ø£ÙƒØ«Ø± Ø·Ù„Ø¨Ù‹Ø§', minQty:12, category:'Ù…Ø·Ø¨Ø®' },
  { id:2, title:'Ù„Ø§Ù†Ø´ Ø¨ÙˆÙƒØ³ Ø­Ø±Ø§Ø±ÙŠ', price:165, oldPrice:199, rating:4.6, reviews:98, image:'https://images.unsplash.com/photo-1517673132405-a56a62b18caf?q=80&w=1200&auto=format&fit=crop', badge:'Ø¹Ø±Ø¶ Ø®Ø§Øµ', minQty:12, category:'ØªØ®Ø²ÙŠÙ† ÙˆØªÙ†Ø¸ÙŠÙ…' },
  { id:3, title:'Ù…Ø¬ Ø³ÙŠØ±Ø§Ù…ÙŠÙƒ Ù…Ø·ÙÙŠ', price:85, oldPrice:110, rating:4.4, reviews:210, image:'https://images.unsplash.com/photo-1523365280197-f1783db9fe62?q=80&w=1200&auto=format&fit=crop', badge:'Ø¬Ø¯ÙŠØ¯', minQty:12, category:'Ù…Ø´Ø±ÙˆØ¨Ø§Øª ÙˆÙ…Ø¬Ø§Øª' },
  { id:4, title:'Ø¹Ù„Ø¨ ØªØ®Ø²ÙŠÙ† Ù…Ø­ÙƒÙ…Ø© â€“ 6 Ù‚Ø·Ø¹', price:350, oldPrice:399, rating:4.8, reviews:73, image:'https://images.unsplash.com/photo-1592840496694-26d035b08cc6?q=80&w=1200&auto=format&fit=crop', badge:'Ø§Ù„Ø£ÙØ¶Ù„ Ù‚ÙŠÙ…Ø©', minQty:12, category:'ØªØ®Ø²ÙŠÙ† ÙˆØªÙ†Ø¸ÙŠÙ…' },
];
const DEFAULT_SOCIAL = { facebook:'', instagram:'', tiktok:'', telegram:'' };
const DEFAULT_FOOTER = 'Ù…Ù†ØµØ© Ø¬Ù…Ù„Ø© Ù„Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…Ù†Ø²Ù„ÙŠØ©: Ø­Ø¯ Ø£Ø¯Ù†Ù‰ 12 Ù‚Ø·Ø¹Ø©ØŒ Ø´Ø­Ù† Ø³Ø±ÙŠØ¹ØŒ ÙˆØ¶Ù…Ø§Ù† Ø§Ø³ØªØ¨Ø¯Ø§Ù„.';
const STORE_MIN_QTY = 12;

function lsGet(k, fb){ try{ const v = localStorage.getItem(k); return v? JSON.parse(v): fb; }catch{ return fb; } }
function lsSet(k, v){ try{ localStorage.setItem(k, JSON.stringify(v)); }catch{} }

let brand = lsGet(LS_KEYS.brand, DEFAULT_BRAND);
let hero = lsGet(LS_KEYS.hero, DEFAULT_HERO);
let categories = lsGet(LS_KEYS.cats, DEFAULT_CATS);
let products = lsGet(LS_KEYS.prods, DEFAULT_PRODS);
let cart = lsGet(LS_KEYS.cart, []);               // [{id, qty}]
let customer = lsGet(LS_KEYS.customer, {name:'', phone:'', city:'', tier:'wh'});
let social = lsGet(LS_KEYS.social, DEFAULT_SOCIAL);
let footerText = lsGet(LS_KEYS.footer, DEFAULT_FOOTER);
let user = lsGet(LS_KEYS.user, null);
let invoices = lsGet(LS_KEYS.invoices, []);

/* =====================[ Ø¨Ø­Ø« + ØªØ±ØªÙŠØ¨ ]===================== */
let currentSort = 'default';
let currentQuery = '';
function normalize(s){
  return String(s||'').toLowerCase()
    .replace(/[Ø£Ø¥Ø¢]/g,'Ø§').replace(/Ù‰/g,'ÙŠ').replace(/Ø©/g,'Ù‡')
    .replace(/[^\p{L}\p{N}\s]/gu,'').trim();
}
function sortList(list, key) {
  const arr = [...list];
  if (key === 'priceLow')  arr.sort((a,b)=> (a.price||0) - (b.price||0));
  if (key === 'priceHigh') arr.sort((a,b)=> (b.price||0) - (a.price||0));
  if (key === 'ratingHigh') arr.sort((a,b)=> (b.rating||0) - (a.rating||0));
  return arr;
}
function applyFilters(list){
  let out = list;
  const q = normalize(currentQuery.trim());
  const q2 = q.endsWith('Ø§') ? q.slice(0,-1) : '';
  if(q){
    out = out.filter(p=>{
      const t = normalize(p.title);
      const c = normalize(p.category);
      return t.includes(q) || c.includes(q) || (q2 && (t.includes(q2) || c.includes(q2)));
    });
  }
  return sortList(out, currentSort);
}

/* =====================[ Cart Logic ]===================== */
const fmt = n => `${Number(n||0).toLocaleString('ar-EG')} Ø¬.Ù…`;
const effMin = p => Number(p.minQty) || STORE_MIN_QTY;

function getProd(id){ return products.find(p=> String(p.id)===String(id)); }
function saveCart(){ lsSet(LS_KEYS.cart, cart); renderCartIcon(); }
function cartCount(){ return cart.reduce((s,i)=> s + (Number(i.qty)||0), 0); }
function cartSubtotal(){ return cart.reduce((s,i)=> { const p=getProd(i.id); return s + (p?(p.price||0)*(i.qty||0):0); }, 0); }

function renderCartIcon(){
  const c = cartCount();
  const b = document.getElementById('cartCount');
  b.textContent = c;
  b.classList.toggle('hidden', c===0);
}
function addToCart(id){
  const p = getProd(id); if(!p) return;
  const step = effMin(p);
  const item = cart.find(x=> String(x.id)===String(id));
  if(item){ item.qty += step; } else { cart.push({id, qty: step}); }
  saveCart(); openCart();
}
function changeQty(id, dir){
  const p = getProd(id); if(!p) return;
  const step = effMin(p);
  const it = cart.find(x=> String(x.id)===String(id)); if(!it) return;
  it.qty = Math.max(step, (it.qty||0) + dir*step);
  saveCart(); renderCartPanel();
}
function removeItem(id){ cart = cart.filter(x=> String(x.id)!==String(id)); saveCart(); renderCartPanel(); }
function clearCart(){ cart = []; saveCart(); renderCartPanel(); }

function renderCartPanel(){
  const wrap = document.getElementById('cartItems');
  if(!wrap) return;

  if(cart.length===0){
    wrap.innerHTML = `<div class="rounded-2xl border bg-white p-6">Ø³Ù„ØªÙƒ ÙØ§Ø±ØºØ©.</div>`;
  }else{
    wrap.innerHTML = cart.map(it=>{
      const p = getProd(it.id); if(!p) return '';
      const line = (p.price||0)*(it.qty||0);
      const step = effMin(p);
      return `
      <div class="rounded-2xl border bg-white p-3">
        <div class="flex gap-3">
          <img src="${p.image}" class="w-20 h-20 object-cover rounded-xl border" />
          <div class="flex-1">
            <div class="font-semibold">${p.title}</div>
            <div class="text-sm text-gray-500">Ø§Ù„Ù‚Ø³Ù…: ${p.category||'-'} â€¢ Ø­Ø¯ Ø£Ø¯Ù†Ù‰: ${step}</div>
            <div class="mt-2 flex items-center gap-2">
              <button class="px-3 py-1 rounded-xl border qty-dec" data-id="${p.id}">âˆ’</button>
              <div class="min-w-[56px] text-center font-semibold">${it.qty}</div>
              <button class="px-3 py-1 rounded-xl border qty-inc" data-id="${p.id}">+</button>
              <button class="ml-auto px-3 py-1 rounded-xl border text-sm hover:bg-gray-50 item-remove" data-id="${p.id}">Ø­Ø°Ù</button>
            </div>
          </div>
        </div>
        <div class="mt-2 text-right"><span class="font-bold">${fmt(line)}</span></div>
      </div>`;
    }).join('');
  }

  // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
  document.getElementById('cusName').value  = customer.name||'';
  document.getElementById('cusPhone').value = customer.phone||'';
  document.getElementById('cusCity').value  = customer.city||'';
  document.getElementById('cusTier').value  = customer.tier||'wh';

  // Ù…Ù„Ø®Øµ Ù…Ø§Ù„ÙŠ + Ù…Ø²Ø§ÙŠØ§ Ø§Ù„Ø´Ø±ÙŠØ­Ø©
  const subtotal = cartSubtotal();
  document.getElementById('cartSubtotal').textContent = fmt(subtotal);

  const tier = customer.tier || 'wh';
  let discount = 0, msg = '';
  if (tier === 'retail'){
    discount = Math.round(subtotal * 0.10);
    document.getElementById('retailDiscountRow').classList.remove('hidden');
    document.getElementById('retailDiscountVal').textContent = `-${fmt(discount)}`;
    msg = 'Ù…Ø¨Ø±ÙˆÙƒ! Ø¬Ø§Ù„Ùƒ Ø®ØµÙ… 10%';
  } else {
    document.getElementById('retailDiscountRow').classList.add('hidden');
    if (tier==='wh')  msg = 'Ù…Ø¨Ø±ÙˆÙƒ! ÙƒØ³Ø¨Øª 2% ÙƒØ§Ø´ Ø¨Ø§Ùƒ.';
    if (tier==='half') msg = 'Ù…Ø¨Ø±ÙˆÙƒ! ÙƒØ³Ø¨Øª Ø¨ÙˆÙƒØ³ Ù…Ù† ZADORA.';
  }
  document.getElementById('tierMsg').textContent = msg;

  const total = subtotal - discount;
  document.getElementById('cartTotal').textContent = fmt(total);

  // ØªÙØ¹ÙŠÙ„/ØªØ¹Ø·ÙŠÙ„ Ø£Ø²Ø±Ø§Ø±
  document.getElementById('cartCheckoutWA').disabled = cart.length===0;
  document.getElementById('cartCheckoutEmail').disabled = cart.length===0;
  document.getElementById('cartClear').disabled = cart.length===0;
}

function openCart(){ document.getElementById('cartModal').classList.remove('hidden'); renderCartPanel(); }
function closeCart(){ document.getElementById('cartModal').classList.add('hidden'); }

/* =====================[ Render Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ]===================== */
function renderHero(){
  const el = document.getElementById('heroSection');
  el.innerHTML = `
    <div class="grid md:grid-cols-3 gap-4">
      <div class="md:col-span-2 relative overflow-hidden rounded-2xl bg-neutral-900 text-white min-h-[220px]">
        <img src="${hero.image}" class="absolute inset-0 w-full h-full object-cover opacity-70">
        <div class="relative p-8 md:p-12">
          <h2 class="text-2xl md:text-4xl font-extrabold leading-tight">${hero.title}</h2>
          <p class="mt-2 md:mt-4 text-sm md:text-base text-white/90">${hero.subtitle}</p>
          <button class="mt-5 inline-flex items-center gap-1 rounded-xl bg-white text-neutral-900 px-4 py-2 text-sm font-semibold hover:bg-white/90">ØªØ³ÙˆÙ‚ Ø§Ù„Ø¢Ù†</button>
        </div>
      </div>
      <div class="relative overflow-hidden rounded-2xl accent-bg min-h-[220px]">
        <img src="https://images.unsplash.com/photo-1549778399-f94fd24d4697?q=80&w=1600&auto=format&fit=crop" class="absolute inset-0 w-full h-full object-cover opacity-40">
        <div class="relative p-8">
          <h3 class="text-xl md:text-2xl font-extrabold">ZADORA Box</h3>
          <p class="mt-2 text-sm text-white/90">Ø¨Ø§ÙƒØ¯Ú† Ù…ØªÙ†ÙˆØ¹Ø© Ø¬Ø§Ù‡Ø²Ø© Ù„Ù„Ø¹Ø±Ø¶ ÙÙŠ Ø§Ù„Ù…Ø­Ù„</p>
          <button class="mt-4 inline-flex items-center gap-1 rounded-xl bg-white text-neutral-900 px-4 py-2 text-sm font-semibold hover:bg-white/90">Ø´ÙˆÙ Ø§Ù„Ø¨ÙˆÙƒØ³</button>
        </div>
      </div>
    </div>`;
}
function renderBenefits(){
  const data = [
    { title:'Ø´Ø­Ù† Ø³Ø±ÙŠØ¹', desc:'ØªÙˆØµÙŠÙ„ Ù„ÙƒÙ„ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª Ø®Ù„Ø§Ù„ 24-72 Ø³Ø§Ø¹Ø©' },
    { title:'Ø¶Ù…Ø§Ù† ÙˆØ§Ø³ØªØ¨Ø¯Ø§Ù„', desc:'Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù‚Ø·Ø¹ Ø§Ù„Ù…ÙƒØ³ÙˆØ±Ø© Ø®Ù„Ø§Ù„ 7 Ø£ÙŠØ§Ù…' },
    { title:'Ø¬Ù…Ù„Ø© Ø¨Ø§Ù„ÙƒØ±ØªÙˆÙ†Ø©', desc:'Ø­Ø¯ Ø£Ø¯Ù†Ù‰ 12 Ù‚Ø·Ø¹Ø© ÙÙ‚Ø·' },
  ];
  const el = document.getElementById('benefitsSection');
  el.innerHTML = `<div class="grid sm:grid-cols-3 gap-3">
      ${data.map(b=>`<div class="flex items-center gap-4 rounded-2xl border p-4 bg-white">
        <div class="rounded-2xl p-3 accent-50">âœ¦</div>
        <div class="text-right">
          <div class="font-semibold">${b.title}</div>
          <div class="text-sm text-gray-600">${b.desc}</div>
        </div>
      </div>`).join('')}
    </div>`;
}
function renderCategories(){
  const el = document.getElementById('categoriesSection');
  el.innerHTML = `
    <div class="flex items-center justify-between mb-3">
      <h3 class="text-lg md:text-xl font-bold">ØªØ³ÙˆÙ‚ Ø¨Ø§Ù„Ø£Ù‚Ø³Ø§Ù…</h3>
      <a href="#/" class="accent-text hover:underline cursor-pointer">Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙ„</a>
    </div>
    <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-6 gap-3">
      ${categories.map(cat => `
        <a href="#/c/${encodeURIComponent(cat.name)}" class="group relative block overflow-hidden rounded-2xl border bg-white">
          <img src="${cat.image}" alt="${cat.name}" class="h-28 w-full object-cover transition-transform duration-300 group-hover:scale-105" />
          <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent"></div>
          <div class="absolute bottom-2 right-2 text-white text-sm font-semibold">${cat.name}</div>
        </a>`).join('')}
    </div>`;
}
function productCard(p){
  return `
  <div class="group rounded-2xl border bg-white overflow-hidden hover:shadow-md transition-shadow">
    <div class="relative">
      <img src="${p.image}" class="w-full h-56 object-cover"/>
      ${p.badge ? `<span class="absolute top-3 right-3 accent-bg text-xs px-2 py-1 rounded-full">${p.badge}</span>` : ''}
      <button class="absolute bottom-3 left-3 bg-white/90 backdrop-blur text-sm rounded-xl px-3 py-1 hover:bg-white">
        Ø­Ø¯ Ø£Ø¯Ù†Ù‰: ${effMin(p)}
      </button>
    </div>
    <div class="p-3" dir="rtl">
      <h4 class="font-semibold min-h-[44px]">${p.title}</h4>
      <div class="flex items-baseline gap-2 mt-2">
        <span class="text-lg font-extrabold">${fmt(p.price)}</span>
        <span class="text-sm line-through text-gray-400">${fmt(p.oldPrice)}</span>
      </div>
      <div class="mt-3 flex items-center gap-2">
        <button class="flex-1 rounded-xl accent-bg py-2 font-semibold btn-add" data-id="${p.id}">Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©</button>
        <button class="rounded-xl border px-3 py-2 hover:bg-gray-50" title="Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ÙØ¶Ù„Ø©">â™¡</button>
      </div>
    </div>
  </div>`;
}
function renderProducts(){
  const el = document.getElementById('productsSection');
  const list = applyFilters(products);
  el.innerHTML = `
    <div class="flex items-center justify-between mb-3">
      <h3 class="text-lg md:text-xl font-bold">${currentQuery ? `Ù†ØªØ§Ø¦Ø¬ Ø¹Ù†: "${currentQuery}"` : 'Ø§Ù„Ø£ÙƒØ«Ø± Ù…Ø¨ÙŠØ¹Ù‹Ø§'}</h3>
      <div class="flex items-center gap-2 text-sm">
        <span>ØªØ±ØªÙŠØ¨:</span>
        <select id="homeSort" class="border rounded-xl px-2 py-1">
          <option value="default">Ø¨Ø¯ÙˆÙ† ØªØ±ØªÙŠØ¨</option>
          <option value="priceLow">Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø£Ø¹Ù„Ù‰</option>
          <option value="priceHigh">Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù„Ø£Ù‚Ù„</option>
          <option value="ratingHigh">Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ù‹Ø§</option>
        </select>
      </div>
    </div>
    <div class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-4">
      ${list.length ? list.map(productCard).join('') : `<div class="rounded-2xl border bg-white p-6">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©.</div>`}
    </div>`;
  const sel = document.getElementById('homeSort');
  sel.value = currentSort;
  sel.onchange = (e) => { currentSort = e.target.value; renderProducts(); };
}
function renderFooter(){
  // Ù†Øµ Ø§Ù„ÙÙˆØªØ±
  const about = document.getElementById('footerAbout');
  if (about) about.textContent = footerText || '';
  // Ø±ÙˆØ§Ø¨Ø· Ø³ÙˆØ´ÙŠØ§Ù„
  const setLink = (id, url) => {
    const a = document.getElementById(id);
    if (!a) return;
    const val = (url || '').trim();
    if (val) {
      const href = /^https?:\/\//i.test(val) ? val : ('https://' + val);
      a.href = href; a.target = '_blank'; a.rel = 'noopener';
      a.classList.remove('text-gray-400','pointer-events-none');
    } else {
      a.removeAttribute('href'); a.removeAttribute('target'); a.removeAttribute('rel');
      a.classList.add('text-gray-400','pointer-events-none');
    }
  };
  setLink('linkFacebook',  social.facebook);
  setLink('linkInstagram', social.instagram);
  setLink('linkTikTok',    social.tiktok);
  setLink('linkTelegram',  social.telegram);
}
function refreshAll(){
  document.getElementById('brandName').textContent = brand;
  document.getElementById('brandNameFooter').textContent = brand;
  document.getElementById('brandNameCopy').textContent = brand;
  document.getElementById('year').textContent = new Date().getFullYear();
  document.getElementById('brandInChat').textContent = brand;
  renderHero(); renderBenefits(); renderCategories(); renderProducts();
  renderFooter(); renderCartIcon(); updateAccountUI();
  renderCatsDrawerList('');
}

/* =====================[ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ]===================== */
const modal = document.getElementById('adminModal');
const openAdminBtn = document.getElementById('openAdmin');
function openAdminPanel(){
  modal.classList.remove('hidden');
  document.getElementById('brandInput').value = brand;
  document.getElementById('heroTitleInput').value = hero.title;
  document.getElementById('heroSubInput').value = hero.subtitle;
  document.getElementById('heroImgPreview').src = hero.image;

  // Ø§Ù„ÙÙˆØªØ± ÙˆØ§Ù„Ø³ÙˆØ´ÙŠØ§Ù„
  document.getElementById('footerInput').value = footerText || '';
  document.getElementById('linkFBInput').value = social.facebook || '';
  document.getElementById('linkIGInput').value = social.instagram || '';
  document.getElementById('linkTTInput').value = social.tiktok || '';
  document.getElementById('linkTGInput').value = social.telegram || '';

  switchTab('products'); fillCatSelect(); listCats(); listProds();
}
if (!isAdmin) openAdminBtn.classList.add('hidden');
openAdminBtn.onclick = () => { if (!isAdmin) { location.hash = '#/admin'; ensureAdmin(); return; } openAdminPanel(); };
if (document.getElementById('closeAdmin')) document.getElementById('closeAdmin').onclick = ()=> modal.classList.add('hidden');
if (document.getElementById('adminCloseBg')) document.getElementById('adminCloseBg').onclick = ()=> modal.classList.add('hidden');

document.querySelectorAll('.tab-btn').forEach(btn=> btn.addEventListener('click', ()=> switchTab(btn.dataset.tab)));
function switchTab(name){
  document.querySelectorAll('.tab-pane').forEach(p=>p.classList.add('hidden'));
  document.getElementById('tab-'+name).classList.remove('hidden');
  document.querySelectorAll('.tab-btn').forEach(b=>{
    const on = b.dataset.tab===name;
    b.classList.toggle('accent-bg', on);
    b.classList.toggle('text-white', on);
    b.classList.toggle('accent-border', on);
  });
}

/* Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø© */
if (document.getElementById('brandInput')) document.getElementById('brandInput').addEventListener('input', e=>{ brand = e.target.value || 'ZADORA'; lsSet(LS_KEYS.brand, brand); refreshAll(); });
if (document.getElementById('heroTitleInput')) document.getElementById('heroTitleInput').addEventListener('input', e=>{ hero.title = e.target.value; lsSet(LS_KEYS.hero, hero); refreshAll(); });
if (document.getElementById('heroSubInput')) document.getElementById('heroSubInput').addEventListener('input', e=>{ hero.subtitle = e.target.value; lsSet(LS_KEYS.hero, hero); refreshAll(); });
if (document.getElementById('heroImgInput')) document.getElementById('heroImgInput').addEventListener('change', e=>{
  const file = e.target.files[0]; if(!file) return;
  const r = new FileReader(); r.onload = ev =>{ hero.image = String(ev.target.result); lsSet(LS_KEYS.hero, hero); refreshAll(); };
  r.readAsDataURL(file);
});

/* Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„ÙÙˆØªØ± ÙˆØ§Ù„Ø³ÙˆØ´ÙŠØ§Ù„ Ù…Ù† Ø§Ù„Ù„ÙˆØ­Ø© */
if (document.getElementById('footerInput')) document.getElementById('footerInput').addEventListener('input', e=>{
  footerText = e.target.value; lsSet(LS_KEYS.footer, footerText); renderFooter();
});
[
  ['linkFBInput','facebook'],['linkIGInput','instagram'],
  ['linkTTInput','tiktok'], ['linkTGInput','telegram']
].forEach(([id,key])=>{
  const el = document.getElementById(id); if(!el) return;
  el.addEventListener('input', e=>{ social[key]=e.target.value.trim(); lsSet(LS_KEYS.social, social); renderFooter(); });
});

/* Ø£Ù‚Ø³Ø§Ù… */
let editingCat = null;
function listCats(){
  const wrap = document.getElementById('catsList');
  if(!wrap) return;
  wrap.innerHTML = categories.map(c=>`
    <div class="rounded-2xl border overflow-hidden bg-white">
      <div class="aspect-[4/3] w-full overflow-hidden">
        <img src="${c.image}" class="w-full h-full object-cover" />
      </div>
      <div class="p-3 flex items-center justify-between">
        <div class="font-semibold">${c.name}</div>
        <div class="flex gap-2">
          <button class="rounded-xl border px-3 py-1 hover:bg-gray-50" onclick='editCat("${c.name}")'>ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="rounded-xl border px-3 py-1 hover:bg-gray-50" onclick='deleteCat("${c.name}")'>Ø­Ø°Ù</button>
        </div>
      </div>
    </div>`).join('');
}
function editCat(name){
  const c = categories.find(x=>x.name===name); if(!c) return;
  editingCat = name;
  document.getElementById('catName').value = c.name;
  document.getElementById('catImgPreview').src = c.image;
}
function deleteCat(name){
  if(!confirm('Ù…Ø³Ø­ Ø§Ù„Ù‚Ø³Ù…ØŸ')) return;
  categories = categories.filter(c=>c.name!==name);
  lsSet(LS_KEYS.cats, categories); fillCatSelect(); listCats(); renderCategories(); renderRoute(); renderCatsDrawerList('');
}
if (document.getElementById('catImgInput')) document.getElementById('catImgInput').addEventListener('change', e=>{
  const f = e.target.files[0]; if(!f) return;
  const r = new FileReader(); r.onload = ev => document.getElementById('catImgPreview').src = String(ev.target.result);
  r.readAsDataURL(f);
});
if (document.getElementById('saveCat')) document.getElementById('saveCat').onclick = ()=>{
  const name = document.getElementById('catName').value.trim();
  const img = document.getElementById('catImgPreview').src;
  if(!name) return alert('Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù‚Ø³Ù…');
  if(editingCat){ categories = categories.map(c=> c.name===editingCat? {name, image:img}: c); }
  else{
    if(categories.some(c=>c.name===name)) return alert('Ø§Ù„Ù‚Ø³Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„');
    categories.push({name, image:img});
  }
  editingCat=null; document.getElementById('catName').value=''; document.getElementById('catImgPreview').src='';
  lsSet(LS_KEYS.cats, categories); fillCatSelect(); listCats(); renderCategories(); renderRoute(); renderCatsDrawerList('');
};
if (document.getElementById('resetCat')) document.getElementById('resetCat').onclick = ()=>{ editingCat=null; document.getElementById('catName').value=''; document.getElementById('catImgPreview').src=''; };
function fillCatSelect(){
  const sel = document.getElementById('pCategory');
  if(!sel) return;
  sel.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„Ù‚Ø³Ù…</option>' + categories.map(c=> `<option>${c.name}</option>`).join('');
}

/* Ù…Ù†ØªØ¬Ø§Øª */
let editingProd = null;
function listProds(){
  const wrap = document.getElementById('productsList');
  if(!wrap) return;
  wrap.innerHTML = products.map(p=>`
    <div class="rounded-2xl border bg-white overflow-hidden">
      <div class="aspect-[4/3] w-full overflow-hidden">
        <img src="${p.image}" class="w-full h-full object-cover"/>
      </div>
      <div class="p-3">
        <div class="font-semibold">${p.title}</div>
        <div class="text-sm text-gray-500 mt-1">${p.category||''}</div>
        <div class="flex items-baseline gap-2 mt-2">
          <span class="text-lg font-extrabold">${fmt(p.price)}</span>
          <span class="text-sm line-through text-gray-400">${fmt(p.oldPrice)}</span>
        </div>
        <div class="mt-3 flex items-center gap-2">
          <button class="rounded-xl border px-3 py-1 hover:bg-gray-50" onclick='editProd(${JSON.stringify(p.id)})'>ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="rounded-xl border px-3 py-1 hover:bg-gray-50" onclick='deleteProd(${JSON.stringify(p.id)})'>Ø­Ø°Ù</button>
        </div>
      </div>
    </div>`).join('');
}
function editProd(id){
  const p = products.find(x=>String(x.id)===String(id)); if(!p) return;
  editingProd = id;
  pTitle.value = p.title; pPrice.value=p.price; pOld.value=p.oldPrice;
  pRating.value=p.rating; pReviews.value=p.reviews; pMinQty.value=p.minQty;
  pBadge.value=p.badge||''; pCategory.value=p.category||''; pImgPreview.src=p.image;
}
function deleteProd(id){
  if(!confirm('Ù…Ø³Ø­ Ø§Ù„Ù…Ù†ØªØ¬ØŸ')) return;
  products = products.filter(p=>String(p.id)!==String(id));
  lsSet(LS_KEYS.prods, products); listProds(); renderProducts(); renderRoute();
}
if (document.getElementById('pImgInput')) document.getElementById('pImgInput').addEventListener('change', e=>{
  const f = e.target.files[0]; if(!f) return;
  const r = new FileReader(); r.onload = ev => pImgPreview.src = String(ev.target.result);
  r.readAsDataURL(f);
});
if (document.getElementById('saveProduct')) document.getElementById('saveProduct').onclick = ()=>{
  const form = {
    title: pTitle.value.trim(),
    price: Number(pPrice.value||0),
    oldPrice: Number(pOld.value||0),
    rating: Number(pRating.value||0),
    reviews: Number(pReviews.value||0),
    minQty: Number(pMinQty.value||0),
    badge: pBadge.value.trim(),
    category: pCategory.value,
    image: pImgPreview.src || ''
  };
  if(!form.title) return alert('Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬');
  if(editingProd){ products = products.map(p=> String(p.id)===String(editingProd)? {...form, id: editingProd}: p); }
  else{
    const nextId = products.length? Math.max(...products.map(p=>Number(p.id)||0))+1: 1;
    products.push({...form, id: nextId});
  }
  editingProd=null;
  ['pTitle','pPrice','pOld','pRating','pReviews','pMinQty','pBadge'].forEach(id=> document.getElementById(id).value='');
  pCategory.value=''; pImgPreview.src='';
  lsSet(LS_KEYS.prods, products); listProds(); renderProducts(); renderRoute();
};
if (document.getElementById('resetProduct')) document.getElementById('resetProduct').onclick = ()=>{
  editingProd=null; ['pTitle','pPrice','pOld','pRating','pReviews','pMinQty','pBadge'].forEach(id=> document.getElementById(id).value='');
  pCategory.value=''; pImgPreview.src='';
};

/* ØªØµØ¯ÙŠØ±/Ø§Ø³ØªÙŠØ±Ø§Ø¯/Ø¥Ø±Ø¬Ø§Ø¹ */
if (document.getElementById('exportJson')) document.getElementById('exportJson').onclick = ()=>{
  const data = { brand, hero, categories, products, social, footer: footerText };
  const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href = url; a.download = 'zadora_store_export.json'; a.click(); URL.revokeObjectURL(url);
};
if (document.getElementById('importJson')) document.getElementById('importJson').addEventListener('change', e=>{
  const f = e.target.files[0]; if(!f) return;
  const r = new FileReader(); r.onload = ev => {
    try{
      const data = JSON.parse(String(ev.target.result||'{}'));
      if(data.brand) brand = data.brand;
      if(data.hero) hero = data.hero;
      if(Array.isArray(data.categories)) categories = data.categories;
      if(Array.isArray(data.products)) products = data.products;
      if(data.social) social = data.social;
      if(typeof data.footer === 'string') footerText = data.footer;

      lsSet(LS_KEYS.brand, brand); lsSet(LS_KEYS.hero, hero);
      lsSet(LS_KEYS.cats, categories); lsSet(LS_KEYS.prods, products);
      lsSet(LS_KEYS.social, social); lsSet(LS_KEYS.footer, footerText);

      refreshAll(); fillCatSelect(); listCats(); listProds(); renderRoute();
    }catch{ alert('Ù…Ù„Ù ØºÙŠØ± ØµØ§Ù„Ø­'); }
  }; r.readAsText(f);
});
if (document.getElementById('resetAll')) document.getElementById('resetAll').onclick = ()=>{
  if(!confirm('Ø¥Ø±Ø¬Ø§Ø¹ ÙƒÙ„ Ø´ÙŠØ¡ Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØŸ')) return;
  brand = DEFAULT_BRAND; hero = DEFAULT_HERO; categories = DEFAULT_CATS.slice(); products = DEFAULT_PRODS.slice();
  social = DEFAULT_SOCIAL; footerText = DEFAULT_FOOTER;
  lsSet(LS_KEYS.brand, brand); lsSet(LS_KEYS.hero, hero);
  lsSet(LS_KEYS.cats, categories); lsSet(LS_KEYS.prods, products);
  lsSet(LS_KEYS.social, social); lsSet(LS_KEYS.footer, footerText);
  refreshAll(); fillCatSelect(); listCats(); listProds(); renderRoute();
};

/* =====================[ Router ]===================== */
function renderCategoryView(cat) {
  showHomeSections(false);
  const all = products.filter(p => (p.category || '') === cat);
  const list = applyFilters(all);
  const el = document.getElementById('productsSection');

  el.innerHTML = `
    <div class="flex items-center justify-between mb-3">
      <div class="text-lg md:text-xl font-bold">Ù‚Ø³Ù…: ${cat}</div>
      <div class="flex items-center gap-3">
        <select id="catSort" class="border rounded-xl px-2 py-1">
          <option value="default">Ø¨Ø¯ÙˆÙ† ØªØ±ØªÙŠØ¨</option>
          <option value="priceLow">Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ù‚Ù„ Ù„Ù„Ø£Ø¹Ù„Ù‰</option>
          <option value="priceHigh">Ø§Ù„Ø³Ø¹Ø±: Ù…Ù† Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù„Ø£Ù‚Ù„</option>
          <option value="ratingHigh">Ø§Ù„Ø£Ø¹Ù„Ù‰ ØªÙ‚ÙŠÙŠÙ…Ù‹Ø§</option>
        </select>
        <a href="#/" class="accent-text hover:underline">Ø¹ÙˆØ¯Ø© Ù„Ù„ÙƒÙ„</a>
      </div>
    </div>
    <div class="grid sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-3 gap-4">
      ${list.length ? list.map(productCard).join('') : `<div class="rounded-2xl border bg-white p-6">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„Ù‚Ø³Ù… Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†.</div>`}
    </div>`;
  const sel = document.getElementById('catSort');
  sel.value = currentSort;
  sel.onchange = (e)=> { currentSort = e.target.value; renderCategoryView(cat); };
}
function renderHome(){ showHomeSections(true); renderProducts(); }
function renderRoute(){
  const h = decodeURIComponent(location.hash || '#/');
  if (h.startsWith('#/c/')) renderCategoryView(h.slice(4));
  else renderHome();
}

/* =====================[ Ø§Ù„Ø¨Ø­Ø«: ÙƒØªØ§Ø¨Ø© + Enter + Ø²Ø± ğŸ” ]===================== */
function attachSearch(){
  const fields = [
    { input: document.getElementById('search'),  form: document.getElementById('searchForm') },
    { input: document.getElementById('search2'), form: document.getElementById('searchForm2') }
  ].filter(x => x.input && x.form);

  fields.forEach(({input, form})=>{
    input.value = currentQuery;

    // Ø¨Ø­Ø« Ù…Ø¨Ø§Ø´Ø± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ÙƒØªØ§Ø¨Ø©
    input.oninput = (e)=>{ currentQuery = e.target.value; renderRoute(); };

    // Esc ÙŠÙ…Ø³Ø­ Ø§Ù„Ø¨Ø­Ø«
    input.onkeydown = (e)=>{ if(e.key==='Escape'){ input.value=''; currentQuery=''; renderRoute(); } };

    // Enter Ø£Ùˆ Ø²Ø± ğŸ”
    form.onsubmit = (e)=>{
      e.preventDefault();
      currentQuery = input.value.trim();
      renderRoute();
    };
  });
}

/* =====================[ ÙˆÙŠØ¯Ø¬Øª Ø§Ù„Ø´Ø§Øª (Ø¨ÙˆØª Ø¨Ø³ÙŠØ·) ]===================== */
const chatPanel = document.getElementById('chatPanel');
const chatToggle = document.getElementById('chatToggle');
const chatClose  = document.getElementById('chatClose');
const chatBody   = document.getElementById('chatBody');
const chatInput  = document.getElementById('chatInput');
const chatSend   = document.getElementById('chatSend');

chatToggle.onclick = ()=> chatPanel.classList.toggle('hidden');
chatClose.onclick  = ()=> chatPanel.classList.add('hidden');
document.querySelectorAll('.quick').forEach(b=> b.onclick = ()=> { sendMsg(b.textContent); });

let chatHistory = lsGet(LS_KEYS.chat, []);
// Ù…Ù†Ø¹ Ø§Ù„ØªÙ‡Ù†ÙŠØ¬: Ø§Ø­ØªÙØ¸ Ø¨Ø¢Ø®Ø± 60 Ø±Ø³Ø§Ù„Ø© ÙÙ‚Ø·
if (Array.isArray(chatHistory) && chatHistory.length > 60) {
  chatHistory = chatHistory.slice(-60);
  lsSet(LS_KEYS.chat, chatHistory);
}
function renderChat(){
  chatBody.innerHTML = chatHistory.map(m => `
    <div class="flex ${m.role==='user'?'justify-start':'justify-end'}">
      <div class="max-w-[80%] rounded-2xl px-3 py-2 text-sm ${m.role==='user'?'bg-white border':'accent-bg'}">
        ${m.text}
      </div>
    </div>`).join('');
  chatBody.scrollTop = chatBody.scrollHeight;
}
function push(role,text){
  chatHistory.push({role,text,ts:Date.now()});
  // Ù‚ØµÙ‘ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ù„Ø£Ø­Ø¯Ø« 60
  if (chatHistory.length > 60) chatHistory = chatHistory.slice(-60);
  lsSet(LS_KEYS.chat, chatHistory); renderChat();
}
function replyBot(q){
  const t = q.trim(); const s = w => t.includes(w); let a = '';
  if (s('Ø´Ø­Ù†')||s('ØªÙˆØµÙŠÙ„')||s('Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©')||s('Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª')) a='Ø§Ù„Ø´Ø­Ù† Ø®Ù„Ø§Ù„ 24-72 Ø³Ø§Ø¹Ø© Ù„ÙƒÙ„ Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø§Øª. Ø§Ù„Ø³Ø¹Ø± Ø­Ø³Ø¨ Ø§Ù„ÙˆØ²Ù† ÙˆØ§Ù„Ù…Ø­Ø§ÙØ¸Ø©. Ù‡Ù†Ø¬Ù…Ø¹ Ø§Ù„Ø£ÙˆØ±Ø¯Ø± ÙˆÙ†ØªÙˆØ§ØµÙ„ Ù„Ù„ØªØ£ÙƒÙŠØ¯.';
  else if (s('Ø§Ø³ØªØ±Ø¬Ø§Ø¹')||s('Ø§Ø±Ø¬Ø§Ø¹')||s('Ø§Ø³ØªØ¨Ø¯Ø§Ù„')) a='Ø§Ù„Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø®Ù„Ø§Ù„ 7 Ø£ÙŠØ§Ù… Ù„Ù„Ù‚Ø·Ø¹ Ø§Ù„Ù…Ø¹ÙŠÙˆØ¨Ø©/Ø§Ù„Ù…ÙƒØ³ÙˆØ±Ø© â€“ Ø¨Ù†Ø¨Ø¯Ù„ ÙÙˆØ±Ù‹Ø§ Ø£Ùˆ Ù†Ø±Ø¬Ø¹ Ù‚ÙŠÙ…ØªÙ‡Ø§.';
  else if (s('Ø­Ø¯ Ø£Ø¯Ù†Ù‰')||s('Ø§Ù‚Ù„ ÙƒÙ…ÙŠØ©')||s('Ø£Ù‚Ù„ ÙƒÙ…ÙŠØ©')) a='Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø·Ù„Ø¨: 12 Ù‚Ø·Ø¹Ø© Ù„ÙƒÙ„ ØµÙ†Ù (Ø£Ùˆ ÙƒØ±ØªÙˆÙ†Ø© ÙƒØ§Ù…Ù„Ø© Ù„Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª).';
  else if (s('Ø¯ÙØ¹')||s('ØªØ­ÙˆÙŠÙ„')||s('ÙÙŠØ²Ø§')||s('ÙƒØ§Ø´')) a='Ø·Ø±Ù‚ Ø§Ù„Ø¯ÙØ¹: ÙƒØ§Ø´ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… (Ø§Ù„Ù‚Ø§Ù‡Ø±Ø©/Ø§Ù„Ø¬ÙŠØ²Ø©)ØŒ ØªØ­ÙˆÙŠÙ„ Ø¨Ù†ÙƒÙŠØŒ Ø£Ùˆ ÙÙˆØ¯Ø§ÙÙˆÙ† ÙƒØ§Ø´.';
  else if (s('Ø³Ø¹Ø±')||s('Ø³Ø¹Ø±Ù‡')||s('Ø«Ù…Ù†')) a='Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø¨Ø§Ù„Ø¬Ù…Ù„Ø© Ø¸Ø§Ù‡Ø±Ø© ØªØ­Øª ÙƒÙ„ Ù…Ù†ØªØ¬. Ù„Ø£Ø³Ø¹Ø§Ø± Ø¬Ù…Ù„Ø© ÙƒØ¨ÙŠØ±Ø© Ø§Ø¨Ø¹ØªÙ„Ù†Ø§ Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨.';
  else if (s('ØªÙˆØ§ØµÙ„')||s('ÙˆØ§ØªØ³Ø§Ø¨')||s('Ø±Ù‚Ù…')) a=`ØªÙ‚Ø¯Ø± ØªÙƒÙ„Ù… ÙØ±ÙŠÙ‚ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ù…Ø¨Ø§Ø´Ø±Ø©: ÙˆØ§ØªØ³Ø§Ø¨ ${WHATSAPP_PHONE} Ø£Ùˆ Ø¥ÙŠÙ…ÙŠÙ„ ${SUPPORT_EMAIL}.`;
  else a='Ù…ÙÙ‡ÙˆÙ…! ğŸ˜Š Ù„Ùˆ Ø³Ø¤Ø§Ù„Ùƒ Ø¹Ù† Ø§Ù„Ø´Ø­Ù†/Ø§Ù„Ø§Ø³ØªØ±Ø¬Ø§Ø¹/Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰/Ø§Ù„Ø¯ÙØ¹ Ø§ÙƒØªØ¨ Ø§Ù„ÙƒÙ„Ù…Ø©ØŒ Ø£Ùˆ ØªÙˆØ§ØµÙ„ Ø¹Ù„Ù‰ Ø²Ø± ÙˆØ§ØªØ³Ø§Ø¨ Ø¨Ø§Ù„Ø£Ø³ÙÙ„.';
  push('bot', a);
}
function sendMsg(text){
  const v = (text ?? chatInput.value).trim(); if(!v) return;
  push('user', v); chatInput.value=''; setTimeout(()=> replyBot(v), 300);
}
if (chatSend) chatSend.onclick = ()=> sendMsg();
if (chatInput) chatInput.addEventListener('keydown', (e)=> { if(e.key==='Enter') sendMsg(); });

/* =====================[ Ø§Ù„Ø­Ø³Ø§Ø¨ + Ø§Ù„ÙÙˆØ§ØªÙŠØ± ]===================== */
const accountBtn   = document.getElementById('accountBtn');
const accountMenu  = document.getElementById('accountMenu');
const accountHello = document.getElementById('accountHello');
const menuLogin    = document.getElementById('menuLogin');
const menuInvoices = document.getElementById('menuInvoices');
const menuLogout   = document.getElementById('menuLogout');

function updateAccountUI(){
  if(user){
    accountHello.textContent = `Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ ${user.name || user.email || 'Ø¹Ù…ÙŠÙ„Ù†Ø§'}`;
    menuLogin.classList.add('hidden');
    menuInvoices.classList.remove('hidden');
    menuLogout.classList.remove('hidden');
  }else{
    accountHello.textContent = 'Ù…Ø±Ø­Ø¨Ù‹Ø§ØŒ Ø¶ÙŠÙ';
    menuLogin.classList.remove('hidden');
    menuInvoices.classList.add('hidden');
    menuLogout.classList.add('hidden');
  }
}
if (accountBtn) accountBtn.addEventListener('click', ()=> accountMenu.classList.toggle('hidden'));
document.addEventListener('click', (e)=>{
  if(!e.target.closest('.dropdown')) accountMenu.classList.add('hidden');
});
if (menuLogin) menuLogin.onclick = ()=> openAuth();
if (menuInvoices) menuInvoices.onclick = ()=> openInvoices();
if (menuLogout) menuLogout.onclick = ()=> { user=null; lsSet(LS_KEYS.user, user); updateAccountUI(); };

const authModal = document.getElementById('authModal');
const authClose = document.getElementById('authClose');
const authCloseBg = document.getElementById('authCloseBg');
const authSave  = document.getElementById('authSave');

function openAuth(){
  document.getElementById('authName').value  = user?.name  || '';
  document.getElementById('authEmail').value = user?.email || '';
  document.getElementById('authPhone').value = user?.phone || '';
  // ØªÙØ¹ÙŠÙ„ Google Ù„Ùˆ ÙÙŠÙ‡ Client ID
  document.getElementById('googleArea').classList.toggle('hidden', !GOOGLE_CLIENT_ID);
  const g = document.getElementById('g_id_onload');
  if (g && GOOGLE_CLIENT_ID) g.setAttribute('data-client_id', GOOGLE_CLIENT_ID);
  authModal.classList.remove('hidden');
}
function closeAuth(){ authModal.classList.add('hidden'); }
if (authClose) authClose.onclick = closeAuth; if (authCloseBg) authCloseBg.onclick = closeAuth;
if (authSave) authSave.onclick = ()=>{
  const name  = document.getElementById('authName').value.trim();
  const email = document.getElementById('authEmail').value.trim();
  const phone = document.getElementById('authPhone').value.trim();
  if(!email && !phone){ alert('Ø§ÙƒØªØ¨ Ø¨Ø±ÙŠØ¯ Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ Ø±Ù‚Ù… Ù‡Ø§ØªÙ.'); return; }
  user = { name, email, phone, ts: Date.now() };
  lsSet(LS_KEYS.user, user);
  updateAccountUI(); closeAuth();
};
// Google callback
window.onGoogleCredential = (resp)=>{
  try{
    const token = resp.credential;
    const payload = JSON.parse(atob(token.split('.')[1].replace(/-/g,'+').replace(/_/g,'/')));
    user = { name: payload.name, email: payload.email, ts:Date.now(), google:true };
    lsSet(LS_KEYS.user, user);
    updateAccountUI(); closeAuth();
  }catch(e){ console.log(e); alert('ØªØ¹Ø°Ø± Ø¥ØªÙ…Ø§Ù… ØªØ³Ø¬ÙŠÙ„ Ø¬ÙˆØ¬Ù„.'); }
};

/* ÙÙˆØ§ØªÙŠØ±ÙŠ */
const invModal = document.getElementById('invModal');
const invBody  = document.getElementById('invBody');
if (document.getElementById('invClose')) document.getElementById('invClose').onclick = ()=> invModal.classList.add('hidden');
if (document.getElementById('invCloseBg')) document.getElementById('invCloseBg').onclick = ()=> invModal.classList.add('hidden');

function openInvoices(){
  renderInvoices(); invModal.classList.remove('hidden');
}
function renderInvoices(){
  if(!invoices.length){
    invBody.innerHTML = `<div class="rounded-2xl border bg-white p-6">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ± Ù…Ø­ÙÙˆØ¸Ø© Ø¨Ø¹Ø¯.</div>`;
    return;
  }
  invBody.innerHTML = invoices.slice().reverse().map(inv=>{
    const dt = new Date(inv.ts);
    const items = inv.items.map(i=> `${i.title} Ã— ${i.qty}`).join('ØŒ ');
    return `
    <div class="rounded-2xl border bg-white p-4 mb-3">
      <div class="flex flex-wrap items-center justify-between gap-2">
        <div class="font-semibold">#${inv.id}</div>
        <div class="text-sm text-gray-500">${dt.toLocaleString('ar-EG')}</div>
      </div>
      <div class="text-sm text-gray-600 mt-1">${items}</div>
      <div class="flex items-center justify-between mt-2">
        <div class="text-sm">Ø§Ù„Ø­Ø§Ù„Ø©: <span class="accent-text">${inv.status}</span></div>
        <div class="font-bold">${fmt(inv.total)}</div>
      </div>
    </div>`;
  }).join('');
}
function saveInvoice(channel){
  if(!cart.length) return null;
  const id  = Math.random().toString(36).slice(2,6).toUpperCase() + '-' + new Date().toISOString().slice(2,10).replace(/-/g,'');
  const items = cart.map(it=>{
    const p = getProd(it.id);
    return { id: it.id, title: p?.title || '', price: p?.price || 0, qty: it.qty };
  });
  const subtotal = cartSubtotal();
  const tier = customer.tier || 'wh';
  let discount = 0;
  if (tier==='retail') discount = Math.round(subtotal*0.10);
  const total = subtotal - discount;

  const inv = {
    id, ts: Date.now(), items, subtotal, discount, total,
    tier, channel, customer: {...customer}, status:'Ù‚ÙŠØ¯ Ø§Ù„ØªØ£ÙƒÙŠØ¯'
  };
  invoices.push(inv); lsSet(LS_KEYS.invoices, invoices);
  return inv;
}

/* Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨ / Ø¨Ø±ÙŠØ¯ */
function buildOrderText(inv){
  const lines = inv.items.map(i=>`â€¢ ${i.title} â€” ÙƒÙ…ÙŠØ©: ${i.qty} â€” ${i.price * i.qty} Ø¬.Ù…`).join('\n');
  const note =
    inv.tier==='retail' ? `Ø®ØµÙ… Ù‚Ø·Ø§Ø¹ÙŠ 10%: -${inv.discount} Ø¬.Ù…` :
    inv.tier==='wh'     ? `ÙƒØ§Ø´ Ø¨Ø§Ùƒ 2%: ${Math.round(inv.subtotal*0.02)} Ø¬.Ù…` :
                          'Ù‡Ø¯ÙŠØ©: Ø¨ÙˆÙƒØ³ Ù…Ù† ZADORA';
  return `Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ Ù…Ù† ${brand}:
Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: #${inv.id}
${lines}
----------------
Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±Ø¹ÙŠ: ${inv.subtotal} Ø¬.Ù…
${note}
Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: ${inv.total} Ø¬.Ù…
Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„: ${inv.tier==='wh'?'Ø¬Ù…Ù„Ø© Ø§Ù„Ø¬Ù…Ù„Ø©':inv.tier==='half'?'Ù†Øµ Ø¬Ù…Ù„Ø©':'Ù‚Ø·Ø§Ø¹ÙŠ'}
Ø§Ù„Ø§Ø³Ù…: ${inv.customer.name||'-'}
Ø§Ù„Ù‡Ø§ØªÙ: ${inv.customer.phone||'-'}
Ø§Ù„Ù…Ø­Ø§ÙØ¸Ø©/Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: ${inv.customer.city||'-'}`;
}
if (document.getElementById('cartCheckoutWA')) document.getElementById('cartCheckoutWA').onclick = ()=>{
  if(!cart.length) return;
  const inv = saveInvoice('whatsapp');
  const text = buildOrderText(inv);
  const url = 'https://wa.me/' + WHATSAPP_PHONE + '?text=' + encodeURIComponent(text);
  window.open(url, '_blank');
};
if (document.getElementById('cartCheckoutEmail')) document.getElementById('cartCheckoutEmail').onclick = ()=>{
  if(!cart.length) return;
  const inv = saveInvoice('email');
  const subject = encodeURIComponent(`Ø·Ù„Ø¨ Ø¬Ø¯ÙŠØ¯ - ${brand} - #${inv.id}`);
  const body = encodeURIComponent(buildOrderText(inv));
  window.location.href = `mailto:${SUPPORT_EMAIL}?subject=${subject}&body=${body}`;
};

/* =====================[ Ø¯Ø±Ø¬ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… ]===================== */
const catsDrawer = document.getElementById('catsDrawer');
const catsCloseBg = document.getElementById('catsCloseBg');
const catsClose = document.getElementById('catsClose');
const catsFilter = document.getElementById('catsFilter');
const catsDrawerList = document.getElementById('catsDrawerList');
const catsToggle = document.getElementById('catsToggle');
const catsToggleMobile = document.getElementById('catsToggleMobile');

function openCats(){ catsDrawer.classList.remove('hidden'); catsFilter.value=''; renderCatsDrawerList(''); catsFilter.focus(); }
function closeCats(){ catsDrawer.classList.add('hidden'); }
if (catsToggle) catsToggle.onclick = openCats;
if (catsToggleMobile) catsToggleMobile.onclick = openCats;
if (catsCloseBg) catsCloseBg.onclick = closeCats;
if (catsClose) catsClose.onclick = closeCats;
if (catsFilter) catsFilter.oninput = (e)=> renderCatsDrawerList(e.target.value);

function renderCatsDrawerList(filter){
  if(!catsDrawerList) return;
  const q = normalize(filter||'');
  const list = q ? categories.filter(c=> normalize(c.name).includes(q)) : categories;
  catsDrawerList.innerHTML = list.length ? list.map(c=>`
    <a href="#/c/${encodeURIComponent(c.name)}" class="flex items-center gap-3 rounded-xl border p-3 hover:bg-gray-50 cat-link">
      <img src="${c.image}" class="w-16 h-12 object-cover rounded-lg border"/>
      <div class="font-medium">${c.name}</div>
    </a>`).join('') : `<div class="rounded-xl border p-4 text-sm text-gray-500">Ù„Ø§ Ù†ØªØ§Ø¦Ø¬.</div>`;
  // ÙƒÙ„ Ù„ÙŠÙ†Ùƒ ÙŠØºÙ„Ù‚ Ø§Ù„Ø¯Ø±Ø¬ Ø¨Ø¹Ø¯ Ø§Ù„Ø¶ØºØ·
  catsDrawerList.querySelectorAll('.cat-link').forEach(a=>{
    a.addEventListener('click', ()=>{ closeCats(); setTimeout(()=>{ window.location.hash = a.getAttribute('href'); }, 0); });
  });
}

/* =====================[ Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø³Ù„Ø© + ÙØªØ­/ØºÙ„Ù‚ ]===================== */
if (document.getElementById('openCart')) document.getElementById('openCart').onclick = openCart;
if (document.getElementById('closeCart')) document.getElementById('closeCart').onclick = closeCart;
if (document.getElementById('cartCloseBg')) document.getElementById('cartCloseBg').onclick = closeCart;
if (document.getElementById('cartClear')) document.getElementById('cartClear').onclick = clearCart;

// Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„ + Ù†ÙˆØ¹ Ø§Ù„Ø¹Ù…ÙŠÙ„
['cusName','cusPhone','cusCity','cusTier'].forEach(id=>{
  const el = document.getElementById(id);
  if(!el) return;
  el.addEventListener('input', ()=>{
    customer = {
      name:  document.getElementById('cusName').value.trim(),
      phone: document.getElementById('cusPhone').value.trim(),
      city:  document.getElementById('cusCity').value.trim(),
      tier:  document.getElementById('cusTier').value
    };
    lsSet(LS_KEYS.customer, customer);
    renderCartPanel();
  });
});

// ØªÙÙˆÙŠØ¶ Ù†Ù‚Ø±Ø§Øª (Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø³Ù„Ø© + Ø£Ø¶Ù Ù„Ù„Ø³Ù„Ø©)
document.addEventListener('click', (e)=>{
  const add = e.target.closest('.btn-add'); if(add){ addToCart(add.dataset.id); return; }
  const inc = e.target.closest('.qty-inc'); if(inc){ changeQty(inc.dataset.id, +1); return; }
  const dec = e.target.closest('.qty-dec'); if(dec){ changeQty(dec.dataset.id, -1); return; }
  const rm  = e.target.closest('.item-remove'); if(rm){ removeItem(rm.dataset.id); return; }
});

/* =====================[ Ø¨Ø¯Ø¡ ]===================== */
refreshAll(); fillCatSelect(); listCats(); listProds();
renderRoute(); attachSearch(); renderChat(); renderCartIcon();

if (location.hash === '#/admin' && !isAdmin) ensureAdmin();
window.addEventListener('hashchange', () => {
  if (location.hash === '#/admin' && !isAdmin) ensureAdmin();
  renderRoute(); attachSearch();
});
</script>
</body>
</html>
